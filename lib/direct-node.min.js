!function(a){"use strict";function b(a,b){function c(){}c.prototype=a;var d=new c;for(var e in b)d[e]=b[e];return b.toString!==Object.prototype.toString&&(d.toString=b.toString),d}function c(a){return a instanceof Array?function(){return i.iter(a)}:"function"==typeof a.iterator?d(a,a.iterator):a.iterator}function d(a,b){if(null==b)return null;null==b.__id__&&(b.__id__=B++);var c;return null==a.hx__closures__?a.hx__closures__={}:c=a.hx__closures__[b.__id__],null==c&&(c=function(){return c.method.apply(c.scope,arguments)},c.scope=a,c.method=b,a.hx__closures__[b.__id__]=c),c}a.albero=a.albero||{};var e={},f=function(){return z.Boot.__string_rec(this,"")},g=a.DirectAPI=function(){this.eventEmitter=new D,z.Node.require("unorm")};e.DirectAPI=g,g.__name__=["DirectAPI"],g.getInstance=function(){return null==g.instance&&(g.instance=new g),g.instance},g.main=function(){},g.prototype={setOptions:function(a){null!=a?(C.host=a.host,C.endpoint=a.endpoint,C.accessToken=a.access_token,C.proxyURL=a.proxyURL,C.account=a.account):null!=console&&console.error(w.dateStr(),"Not enough parameters provided. I need a access token","","","","")},announce:function(a,b){var c,d=a.room;if(null!=d){var e=v.Int64Helper.idStrToInt64(d);if(null==e||null==b)return;var f=this.data.getTalk(e);if(null==f)return;c=f.domainId}else c=v.Int64Helper.idStrToInt64(a.id);null!=c&&this.sendQueue.sendAnnouncement(c,b)},send:function(a,b){var c=a.room,d=v.Int64Helper.idStrToInt64(c);null!=d&&null!=b&&this.sendQueue.sendMessage(d,b)},topic:function(a,b){var c=a.room,d=v.Int64Helper.idStrToInt64(c);this.facade.sendNotification("Talk",v.command.TalkAction.UPDATE(d,null,b))},download:function(a,b,c){var d,e=null,f=null;return"string"==typeof b?d=b:(d=b.url,e=b.path,f=b.name),null==d?void c(null):(null==f&&(f=z.Node.require("path").basename(d)),null==e&&(e=z.Node.require("path").join(z.Node.require("os").tmpdir(),f)),void this.facade.sendNotification("File",v.command.FileAction.DOWNLOAD_PATH(d,e,c)))},leave:function(a){var b=this,c=a.room,d=v.Int64Helper.idStrToInt64(c);y.Timer.delay(function(){b.facade.sendNotification("Talk",v.command.TalkAction.DELETE(d))},500)},userForId:function(a){return this.hubotObject.userObjectByIdStr(null,a)},userObjects:function(){return this.hubotObject.userObjects(null)},talkObjects:function(){return this.hubotObject.talkObjects()},domainObjects:function(){return this.hubotObject.domainObjects()},parseInt64:function(a){return v.Int64Helper.parse(a)},stringifyInt64:function(a){return a.toString()},listen:function(){this.facade=v.AppFacade.getInstance(),this.api=z.Boot.__cast(this.facade.retrieveProxy("api"),v.proxy.AlberoServiceProxy),this.data=z.Boot.__cast(this.facade.retrieveProxy("dataStore"),v.proxy.DataStoreProxy),this.hubotObject=z.Boot.__cast(this.facade.retrieveProxy("hubotObject"),x.proxy.HubotObjectProxy),this.sendQueue=z.Boot.__cast(this.facade.retrieveProxy("sendQueue"),x.proxy.SendQueueProxy),this.facade.startup()},emit:function(a,b,c,d){this.eventEmitter.emit(a,b,c,d)},on:function(a,b){return this.eventEmitter.on(a,b)},__class__:g};var h=function(a,b){b=b.split("u").join(""),this.r=new RegExp(a,b)};e.EReg=h,h.__name__=["EReg"],h.prototype={match:function(a){return this.r.global&&(this.r.lastIndex=0),this.r.m=this.r.exec(a),this.r.s=a,null!=this.r.m},matched:function(a){if(null!=this.r.m&&a>=0&&a<this.r.m.length)return this.r.m[a];throw"EReg::matched"},replace:function(a,b){return a.replace(this.r,b)},__class__:h};var i=function(){};e.HxOverrides=i,i.__name__=["HxOverrides"],i.dateStr=function(a){var b=a.getMonth()+1,c=a.getDate(),d=a.getHours(),e=a.getMinutes(),f=a.getSeconds();return a.getFullYear()+"-"+(10>b?"0"+b:""+b)+"-"+(10>c?"0"+c:""+c)+" "+(10>d?"0"+d:""+d)+":"+(10>e?"0"+e:""+e)+":"+(10>f?"0"+f:""+f)},i.cca=function(a,b){var c=a.charCodeAt(b);return c!=c?void 0:c},i.substr=function(a,b,c){return null!=b&&0!=b&&null!=c&&0>c?"":(null==c&&(c=a.length),0>b?(b=a.length+b,0>b&&(b=0)):0>c&&(c=a.length+c-b),a.substr(b,c))},i.indexOf=function(a,b,c){var d=a.length;for(0>c&&(c+=d,0>c&&(c=0));d>c;){if(a[c]===b)return c;c++}return-1},i.remove=function(a,b){var c=i.indexOf(a,b,0);return-1==c?!1:(a.splice(c,1),!0)},i.iter=function(a){return{cur:0,arr:a,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var j=function(){};e.Lambda=j,j.__name__=["Lambda"],j.exists=function(a,b){for(var d=c(a)();d.hasNext();){var e=d.next();if(b(e))return!0}return!1},j.count=function(a,b){var d=0;if(null==b)for(var e=c(a)();e.hasNext();){{e.next()}d++}else for(var f=c(a)();f.hasNext();){var g=f.next();b(g)&&d++}return d};var k=function(){this.length=0};e.List=k,k.__name__=["List"],k.prototype={add:function(a){var b=[a];null==this.h?this.h=b:this.q[1]=b,this.q=b,this.length++},isEmpty:function(){return null==this.h},remove:function(a){for(var b=null,c=this.h;null!=c;){if(c[0]==a)return null==b?this.h=c[1]:b[1]=c[1],this.q==c&&(this.q=b),this.length--,!0;b=c,c=c[1]}return!1},iterator:function(){return{h:this.h,hasNext:function(){return null!=this.h},next:function(){if(null==this.h)return null;var a=this.h[0];return this.h=this.h[1],a}}},__class__:k};var l=function(){};e.IMap=l,l.__name__=["IMap"],Math.__name__=["Math"];var m=function(){};e.ObjectHelper=m,m.__name__=["ObjectHelper"],m.deepCopy=function(a){return y.Json.parse(JSON.stringify(a,null,null))};var n=function(){};e.Reflect=n,n.__name__=["Reflect"],n.field=function(a,b){try{return a[b]}catch(c){return null}},n.setField=function(a,b,c){a[b]=c},n.fields=function(a){var b=[];if(null!=a){var c=Object.prototype.hasOwnProperty;for(var d in a)"__id__"!=d&&"hx__closures__"!=d&&c.call(a,d)&&b.push(d)}return b},n.isFunction=function(a){return"function"==typeof a&&!(a.__name__||a.__ename__)},n.isObject=function(a){if(null==a)return!1;var b=typeof a;return"string"==b||"object"==b&&null==a.__enum__||"function"==b&&null!=(a.__name__||a.__ename__)},n.deleteField=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)?(delete a[b],!0):!1};var o=function(){};e.Std=o,o.__name__=["Std"],o.string=function(a){return z.Boot.__string_rec(a,"")},o["int"]=function(a){return 0|a},o.parseInt=function(a){var b=parseInt(a,10);return 0!=b||120!=i.cca(a,1)&&88!=i.cca(a,1)||(b=parseInt(a)),isNaN(b)?null:b},o.parseFloat=function(a){return parseFloat(a)};var p=function(){this.b=""};e.StringBuf=p,p.__name__=["StringBuf"],p.prototype={__class__:p};var q=function(){};e.StringTools=q,q.__name__=["StringTools"],q.urlEncode=function(a){return encodeURIComponent(a)},q.startsWith=function(a,b){return a.length>=b.length&&i.substr(a,0,b.length)==b},q.endsWith=function(a,b){var c=b.length,d=a.length;return d>=c&&i.substr(a,d-c,c)==b},q.replace=function(a,b,c){return a.split(b).join(c)};var r=function(){};e.TextHelper=r,r.__name__=["TextHelper"],r.slice=function(a,b){for(var c=new Array,d=function(a){for(;a.length>b;)c.push(i.substr(a,0,b)),a=i.substr(a,b,null);a.length>0&&c.push(a)},e="",f=a.split("\n");f.length>0;){var g=f.shift();e.length+g.length>b&&(d(e),e=""),e.length>0&&(e+="\n"),e+=g}return d(e),c};var s={__ename__:!0,__constructs__:["TNull","TInt","TFloat","TBool","TObject","TFunction","TClass","TEnum","TUnknown"]};s.TNull=["TNull",0],s.TNull.toString=f,s.TNull.__enum__=s,s.TInt=["TInt",1],s.TInt.toString=f,s.TInt.__enum__=s,s.TFloat=["TFloat",2],s.TFloat.toString=f,s.TFloat.__enum__=s,s.TBool=["TBool",3],s.TBool.toString=f,s.TBool.__enum__=s,s.TObject=["TObject",4],s.TObject.toString=f,s.TObject.__enum__=s,s.TFunction=["TFunction",5],s.TFunction.toString=f,s.TFunction.__enum__=s,s.TClass=function(a){var b=["TClass",6,a];return b.__enum__=s,b.toString=f,b},s.TEnum=function(a){var b=["TEnum",7,a];return b.__enum__=s,b.toString=f,b},s.TUnknown=["TUnknown",8],s.TUnknown.toString=f,s.TUnknown.__enum__=s;var t=function(){};e.Type=t,t.__name__=["Type"],t.getClass=function(a){return null==a?null:a instanceof Array&&null==a.__enum__?Array:a.__class__},t.getClassName=function(a){var b=a.__name__;return b.join(".")},t.resolveClass=function(a){var b=e[a];return null!=b&&b.__name__?b:null},t.createInstance=function(a,b){var c=b.length;switch(c){case 0:return new a;case 1:return new a(b[0]);case 2:return new a(b[0],b[1]);case 3:return new a(b[0],b[1],b[2]);case 4:return new a(b[0],b[1],b[2],b[3]);case 5:return new a(b[0],b[1],b[2],b[3],b[4]);case 6:return new a(b[0],b[1],b[2],b[3],b[4],b[5]);case 7:return new a(b[0],b[1],b[2],b[3],b[4],b[5],b[6]);case 8:return new a(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7]);default:throw"Too many arguments"}return null},t["typeof"]=function(a){var b=typeof a;switch(b){case"boolean":return s.TBool;case"string":return s.TClass(String);case"number":return Math.ceil(a)==a%2147483648?s.TInt:s.TFloat;case"object":if(null==a)return s.TNull;var c=a.__enum__;if(null!=c)return s.TEnum(c);var d;return d=a instanceof Array&&null==a.__enum__?Array:a.__class__,null!=d?s.TClass(d):s.TObject;case"function":return a.__name__||a.__ename__?s.TObject:s.TFunction;case"undefined":return s.TNull;default:return s.TUnknown}},t.enumEq=function(a,b){if(a==b)return!0;try{if(a[0]!=b[0])return!1;for(var c=2,d=a.length;d>c;){var e=c++;if(!t.enumEq(a[e],b[e]))return!1}var f=a.__enum__;if(f!=b.__enum__||null==f)return!1}catch(g){return!1}return!0};var u={};u.interfaces={},u.interfaces.IFacade=function(){},e["puremvc.interfaces.IFacade"]=u.interfaces.IFacade,u.interfaces.IFacade.__name__=["puremvc","interfaces","IFacade"],u.interfaces.IFacade.prototype={__class__:u.interfaces.IFacade},u.patterns={},u.patterns.facade={},u.patterns.facade.Facade=function(){u.patterns.facade.Facade.instance=this,this.initializeFacade()},e["puremvc.patterns.facade.Facade"]=u.patterns.facade.Facade,u.patterns.facade.Facade.__name__=["puremvc","patterns","facade","Facade"],u.patterns.facade.Facade.__interfaces__=[u.interfaces.IFacade],u.patterns.facade.Facade.getInstance=function(){return null==u.patterns.facade.Facade.instance&&(u.patterns.facade.Facade.instance=new u.patterns.facade.Facade),u.patterns.facade.Facade.instance},u.patterns.facade.Facade.prototype={initializeFacade:function(){this.initializeModel(),this.initializeController(),this.initializeView()},initializeController:function(){null==this.controller&&(this.controller=u.core.Controller.getInstance())},initializeModel:function(){null==this.model&&(this.model=u.core.Model.getInstance())},initializeView:function(){null==this.view&&(this.view=u.core.View.getInstance())},registerCommand:function(a,b){this.controller.registerCommand(a,b)},removeCommand:function(a){this.controller.removeCommand(a)},hasCommand:function(a){return this.controller.hasCommand(a)},registerProxy:function(a){this.model.registerProxy(a)},retrieveProxy:function(a){return this.model.retrieveProxy(a)},removeProxy:function(a){var b=null;return null!=this.model&&(b=this.model.removeProxy(a)),b},hasProxy:function(a){return this.model.hasProxy(a)},registerMediator:function(a){null!=this.view&&this.view.registerMediator(a)},retrieveMediator:function(a){return this.view.retrieveMediator(a)},removeMediator:function(a){var b=null;return null!=this.view&&(b=this.view.removeMediator(a)),b},hasMediator:function(a){return this.view.hasMediator(a)},sendNotification:function(a,b,c){this.notifyObservers(new u.patterns.observer.Notification(a,b,c))},notifyObservers:function(a){null!=this.view&&this.view.notifyObservers(a)},__class__:u.patterns.facade.Facade};var v={};v.AppFacade=function(){u.patterns.facade.Facade.call(this)},e["albero.AppFacade"]=v.AppFacade,v.AppFacade.__name__=["albero","AppFacade"],v.AppFacade.getInstance=function(){return null==u.patterns.facade.Facade.instance&&(u.patterns.facade.Facade.instance=new v.AppFacade),z.Boot.__cast(u.patterns.facade.Facade.instance,v.AppFacade)},v.AppFacade.__super__=u.patterns.facade.Facade,v.AppFacade.prototype=b(u.patterns.facade.Facade.prototype,{initializeModel:function(){u.patterns.facade.Facade.prototype.initializeModel.call(this);var a=[new x.proxy.HubotObjectProxy,new x.proxy.SendQueueProxy,new x.proxy.MessageEventProxy,new v.proxy.AppStateProxy,new v.proxy.DataStoreProxy,new v.proxy.SettingsProxy,new v.proxy.MsgPackRpcProxy,new v.proxy.AlberoBroadcastProxy,new v.proxy.AlberoServiceProxy,new v.proxy.FileServiceProxy,new v.proxy.FormatterProxy,new v.proxy.RoutingProxy];a.push(v.proxy.AccountLoaderProxyFactory.newInstance());for(var b=0;b<a.length;){var c=a[b];++b,this.registerProxy(c)}for(var d=0;d<a.length;){var e=a[d];++d,this.autoBind(e)}},initializeView:function(){u.patterns.facade.Facade.prototype.initializeView.call(this);for(var a=[new x.mediator.CommandLineMediator],b=0;b<a.length;){var c=a[b];++b,this.registerMediator(c)}},initializeController:function(){u.patterns.facade.Facade.prototype.initializeController.call(this);for(var a=[v.command.DomainCommand,v.command.SignInCommand,v.command.SignOutCommand,v.command.ReloadDataCommand,v.command.SendCommand,v.command.TalkCommand,v.command.ManageFriendsCommand,v.command.ReadCommand,v.command.LoadStampSetCommand,v.command.FileCommand,v.command.SelectTalkCommand,v.command.UpdateUserCommand,v.command.UpdateProfileCommand,v.command.UrlCommand],b=0;b<a.length;){var c=a[b];++b;var d=q.replace(t.getClassName(c).split(".").pop(),"Command","");this.registerCommand(d,c)}},registerMediator:function(a){this.autoBind(a),u.patterns.facade.Facade.prototype.registerMediator.call(this,a)},autoBind:function(a){for(var b=y.rtti.Meta.getFields(t.getClass(a)),c=0,d=n.fields(b);c<d.length;){var e=d[c];++c;var f=n.field(b,e);if(Object.prototype.hasOwnProperty.call(f,"inject")){var g=this.retrieveProxy(e);null==g||(a[e]=g)}}},startup:function(){z.Boot.__cast(this.retrieveProxy("appState"),v.proxy.AppStateProxy).start()},__class__:v.AppFacade}),v.AppState={__ename__:!0,__constructs__:["Active","Inactive"]},v.AppState.Active=["Active",0],v.AppState.Active.toString=f,v.AppState.Active.__enum__=v.AppState,v.AppState.Inactive=["Inactive",1],v.AppState.Inactive.toString=f,v.AppState.Inactive.__enum__=v.AppState,v.ConnectionStatus={__ename__:!0,__constructs__:["Ok","Error","ConcurrentAccessError","ForcibliyClosedError"]},v.ConnectionStatus.Ok=["Ok",0],v.ConnectionStatus.Ok.toString=f,v.ConnectionStatus.Ok.__enum__=v.ConnectionStatus,v.ConnectionStatus.Error=["Error",1],v.ConnectionStatus.Error.toString=f,v.ConnectionStatus.Error.__enum__=v.ConnectionStatus,v.ConnectionStatus.ConcurrentAccessError=["ConcurrentAccessError",2],v.ConnectionStatus.ConcurrentAccessError.toString=f,v.ConnectionStatus.ConcurrentAccessError.__enum__=v.ConnectionStatus,v.ConnectionStatus.ForcibliyClosedError=["ForcibliyClosedError",3],v.ConnectionStatus.ForcibliyClosedError.toString=f,v.ConnectionStatus.ForcibliyClosedError.__enum__=v.ConnectionStatus,v.History=function(){},e["albero.History"]=v.History,v.History.__name__=["albero","History"],v.History.replaceState=function(a,b,c){return null!=window.history?(window.history.replaceState(a,b,c),!0):!1},v.Int64Helper=function(){},e["albero.Int64Helper"]=v.Int64Helper,v.Int64Helper.__name__=["albero","Int64Helper"],v.Int64Helper.parse=function(a){var b=new h("^\\d+$","");if(!b.match(a))return null;for(var c=new y.Int64(0,0),d=new y.Int64(0,10),e=0,f=a.length;f>e;){var g=e++;c=y.Int64.add(y.Int64.mul(c,d),y.Int64.make(0,o.parseInt(a.charAt(g))))}return c},v.Int64Helper.getHigh=function(a){return a.high},v.Int64Helper.getLow=function(a){return a.low},v.Int64Helper.idStr=function(a){return"_"+a.high+"_"+a.low},v.Int64Helper.makeFromIdStr=function(a){var b=new h("^_(-?\\d*)_(-?\\d*)$","");return b.match(a)?y.Int64.make(o.parseInt(b.matched(1)),o.parseInt(b.matched(2))):null},v.Int64Helper.eq=function(a,b){return null!=a&&null!=b&&a.high==b.high&&a.low==b.low},v.Int64Helper.toFloat=function(a){var b=4294967296,c=a.high,d=a.low;return c*b+(d>=0?d:d+b)},v.Int64Helper.idStrToInt64=function(a){var b=a.split("_");return b.length>2?y.Int64.make(o.parseInt(b[1]),o.parseInt(b[2])):null},v.Int64Helper.decrement=function(a){return null==a?null:y.Int64.sub(a,new y.Int64(0,1))},v.Int64Helper.contains=function(a,b){if(null==a)return!1;for(var c=0;c<a.length;){var d=a[c];if(++c,null!=d&&null!=b&&d.high==b.high&&d.low==b.low)return!0}return!1},v.Int64Helper.remove=function(a,b){if(null==a)return!1;for(var c=0;c<a.length;){var d=a[c];if(++c,null!=d&&null!=b&&d.high==b.high&&d.low==b.low)return i.remove(a,d),!0}return!1},v.Urls={__ename__:!0,__constructs__:["auto","domains","domain","members","talks","actions","console","settings","announcements","error","loading"]},v.Urls.auto=["auto",0],v.Urls.auto.toString=f,v.Urls.auto.__enum__=v.Urls,v.Urls.domains=["domains",1],v.Urls.domains.toString=f,v.Urls.domains.__enum__=v.Urls,v.Urls.domain=function(a){var b=["domain",2,a];return b.__enum__=v.Urls,b.toString=f,b},v.Urls.members=function(a){var b=["members",3,a];return b.__enum__=v.Urls,b.toString=f,b},v.Urls.talks=function(a){var b=["talks",4,a];return b.__enum__=v.Urls,b.toString=f,b},v.Urls.actions=function(a){var b=["actions",5,a];return b.__enum__=v.Urls,b.toString=f,b},v.Urls.console=function(a){var b=["console",6,a];return b.__enum__=v.Urls,b.toString=f,b},v.Urls.settings=function(a){var b=["settings",7,a];return b.__enum__=v.Urls,b.toString=f,b},v.Urls.announcements=["announcements",8],v.Urls.announcements.toString=f,v.Urls.announcements.__enum__=v.Urls,v.Urls.error=["error",9],v.Urls.error.toString=f,v.Urls.error.__enum__=v.Urls,v.Urls.loading=["loading",10],v.Urls.loading.toString=f,v.Urls.loading.__enum__=v.Urls,u.interfaces.INotifier=function(){},e["puremvc.interfaces.INotifier"]=u.interfaces.INotifier,u.interfaces.INotifier.__name__=["puremvc","interfaces","INotifier"],u.interfaces.INotifier.prototype={__class__:u.interfaces.INotifier},u.patterns.observer={},u.patterns.observer.Notifier=function(){this.facade=u.patterns.facade.Facade.getInstance()},e["puremvc.patterns.observer.Notifier"]=u.patterns.observer.Notifier,u.patterns.observer.Notifier.__name__=["puremvc","patterns","observer","Notifier"],u.patterns.observer.Notifier.__interfaces__=[u.interfaces.INotifier],u.patterns.observer.Notifier.prototype={sendNotification:function(a,b,c){this.facade.sendNotification(a,b,c)},__class__:u.patterns.observer.Notifier},u.interfaces.ICommand=function(){},e["puremvc.interfaces.ICommand"]=u.interfaces.ICommand,u.interfaces.ICommand.__name__=["puremvc","interfaces","ICommand"],u.interfaces.ICommand.prototype={__class__:u.interfaces.ICommand},u.patterns.command={},u.patterns.command.SimpleCommand=function(){u.patterns.observer.Notifier.call(this)},e["puremvc.patterns.command.SimpleCommand"]=u.patterns.command.SimpleCommand,u.patterns.command.SimpleCommand.__name__=["puremvc","patterns","command","SimpleCommand"],u.patterns.command.SimpleCommand.__interfaces__=[u.interfaces.ICommand],u.patterns.command.SimpleCommand.__super__=u.patterns.observer.Notifier,u.patterns.command.SimpleCommand.prototype=b(u.patterns.observer.Notifier.prototype,{execute:function(){},__class__:u.patterns.command.SimpleCommand}),v.command={},v.command.AutoBindCommand=function(){u.patterns.command.SimpleCommand.call(this),v.AppFacade.getInstance().autoBind(this)},e["albero.command.AutoBindCommand"]=v.command.AutoBindCommand,v.command.AutoBindCommand.__name__=["albero","command","AutoBindCommand"],v.command.AutoBindCommand.__super__=u.patterns.command.SimpleCommand,v.command.AutoBindCommand.prototype=b(u.patterns.command.SimpleCommand.prototype,{__class__:v.command.AutoBindCommand}),v.command.DomainCommand=function(){v.command.AutoBindCommand.call(this)},e["albero.command.DomainCommand"]=v.command.DomainCommand,v.command.DomainCommand.__name__=["albero","command","DomainCommand"],v.command.DomainCommand.__super__=v.command.AutoBindCommand,v.command.DomainCommand.prototype=b(v.command.AutoBindCommand.prototype,{execute:function(a){var b=a.getBody();switch(b[1]){case 0:var c=b[2];this.api.acceptDomainInvite(c);break;case 1:var d=b[2];this.api.deleteDomainInvite(d);break;case 2:var e=b[2];this.api.leaveDomain(e)}},__class__:v.command.DomainCommand}),v.command.DomainAction={__ename__:!0,__constructs__:["ACCEPT_INVITE","DELETE_INVITE","LEAVE"]},v.command.DomainAction.ACCEPT_INVITE=function(a){var b=["ACCEPT_INVITE",0,a];return b.__enum__=v.command.DomainAction,b.toString=f,b},v.command.DomainAction.DELETE_INVITE=function(a){var b=["DELETE_INVITE",1,a];return b.__enum__=v.command.DomainAction,b.toString=f,b},v.command.DomainAction.LEAVE=function(a){var b=["LEAVE",2,a];return b.__enum__=v.command.DomainAction,b.toString=f,b},v.command.FileCommand=function(){v.command.AutoBindCommand.call(this)},e["albero.command.FileCommand"]=v.command.FileCommand,v.command.FileCommand.__name__=["albero","command","FileCommand"],v.command.FileCommand.__super__=v.command.AutoBindCommand,v.command.FileCommand.prototype=b(v.command.AutoBindCommand.prototype,{execute:function(a){var b=a.getBody();switch(b[1]){case 0:var c=b[3],d=b[2];this.api.upload(d.domainId,d.id,c);break;case 1:var e=b[2];this.api.deleteAttachment(e.id,e.messageId);break;case 2:var f=b[6],g=b[5],h=b[4],i=b[3],j=b[2],k=this.fileService.createDummyFile(i);k.path=i,k.size=z.Node.require("fs").statSync(i).size,null!=h&&(k.name=h),null!=g&&(k.type=g);var l=this.dataStore.getTalk(j);this.api.upload(l.domainId,l.id,k,f);break;case 3:var m=b[4],n=b[3],o=b[2];this.fileService.download(o,n,m)}},__class__:v.command.FileCommand}),v.command.FileAction={__ename__:!0,__constructs__:["UPLOAD","DELETE","UPLOAD_PATH","DOWNLOAD_PATH"]},v.command.FileAction.UPLOAD=function(a,b){var c=["UPLOAD",0,a,b];return c.__enum__=v.command.FileAction,c.toString=f,c},v.command.FileAction.DELETE=function(a){var b=["DELETE",1,a];return b.__enum__=v.command.FileAction,b.toString=f,b},v.command.FileAction.UPLOAD_PATH=function(a,b,c,d,e){var g=["UPLOAD_PATH",2,a,b,c,d,e];return g.__enum__=v.command.FileAction,g.toString=f,g},v.command.FileAction.DOWNLOAD_PATH=function(a,b,c){var d=["DOWNLOAD_PATH",3,a,b,c];return d.__enum__=v.command.FileAction,d.toString=f,d},v.command.LoadStampSetCommand=function(){v.command.AutoBindCommand.call(this)},e["albero.command.LoadStampSetCommand"]=v.command.LoadStampSetCommand,v.command.LoadStampSetCommand.__name__=["albero","command","LoadStampSetCommand"],v.command.LoadStampSetCommand.__super__=v.command.AutoBindCommand,v.command.LoadStampSetCommand.prototype=b(v.command.AutoBindCommand.prototype,{execute:function(){new Array},__class__:v.command.LoadStampSetCommand}),v.command.ManageFriendsCommand=function(){v.command.AutoBindCommand.call(this)},e["albero.command.ManageFriendsCommand"]=v.command.ManageFriendsCommand,v.command.ManageFriendsCommand.__name__=["albero","command","ManageFriendsCommand"],v.command.ManageFriendsCommand.__super__=v.command.AutoBindCommand,v.command.ManageFriendsCommand.prototype=b(v.command.AutoBindCommand.prototype,{execute:function(a){var b=a.getBody(),c=b.action;switch(c[1]){case 0:for(var d=0,e=b.users;d<e.length;){var f=e[d];++d,this.api.addFriend(f)}break;case 1:for(var g=0,h=b.users;g<h.length;){var i=h[g];++g,this.api.deleteFriend(i)}}},__class__:v.command.ManageFriendsCommand}),v.command.ManageFriendsAction={__ename__:!0,__constructs__:["ADD","DELETE"]},v.command.ManageFriendsAction.ADD=["ADD",0],v.command.ManageFriendsAction.ADD.toString=f,v.command.ManageFriendsAction.ADD.__enum__=v.command.ManageFriendsAction,v.command.ManageFriendsAction.DELETE=["DELETE",1],v.command.ManageFriendsAction.DELETE.toString=f,v.command.ManageFriendsAction.DELETE.__enum__=v.command.ManageFriendsAction,v.command.ReadCommand=function(){v.command.AutoBindCommand.call(this)},e["albero.command.ReadCommand"]=v.command.ReadCommand,v.command.ReadCommand.__name__=["albero","command","ReadCommand"],v.command.ReadCommand.__super__=v.command.AutoBindCommand,v.command.ReadCommand.prototype=b(v.command.AutoBindCommand.prototype,{execute:function(a){var b=a.getBody();switch(b[1]){case 0:var c=b[3],d=b[2];this.api.updateReadStatuses(d,c);break;case 1:var e=b[2];this.api.updateAnnouncementReadStatus(e);break;case 2:var f=b[3],g=b[2];this.api.getReadStatus(g,f)}},__class__:v.command.ReadCommand}),v.command.ReadType={__ename__:!0,__constructs__:["TALK","ANNOUNCEMENT","READ_STATUS"]},v.command.ReadType.TALK=function(a,b){var c=["TALK",0,a,b];return c.__enum__=v.command.ReadType,c.toString=f,c},v.command.ReadType.ANNOUNCEMENT=function(a){var b=["ANNOUNCEMENT",1,a];return b.__enum__=v.command.ReadType,b.toString=f,b},v.command.ReadType.READ_STATUS=function(a,b){var c=["READ_STATUS",2,a,b];return c.__enum__=v.command.ReadType,c.toString=f,c},v.command.ReloadDataCommand=function(){v.command.AutoBindCommand.call(this)},e["albero.command.ReloadDataCommand"]=v.command.ReloadDataCommand,v.command.ReloadDataCommand.__name__=["albero","command","ReloadDataCommand"],v.command.ReloadDataCommand.__super__=v.command.AutoBindCommand,v.command.ReloadDataCommand.prototype=b(v.command.AutoBindCommand.prototype,{execute:function(a){var b=a.getBody();switch(b[1]){case 0:this.api.getDomains();break;case 1:this.api.getFriends(),this.api.getAcquaintances();break;case 2:this.api.getTalks();break;case 3:var c=b[3],d=b[2];this.api.getMessages(d,c);break;case 4:var e=b[2];this.api.getAllUsers(e);break;case 5:var f=b[3],g=b[2];this.api.getUsers(g,f);break;case 6:var h=b[3],i=b[2];this.api.getProfile(i,h);break;case 7:var j=b[3],k=b[2];this.api.searchDomainUsers(k,j);break;case 8:var l=b[2];this.api.getAnnouncements(l);break;case 9:var m=b[5],n=b[4],o=b[3],p=b[2];this.api.getQuestions(p,o,n,m);break;case 10:var q=b[3],r=b[2];this.api.getQuestion(r,q);break;case 11:var s=b[3],t=b[2];this.api.getAttachments(t,s)}},__class__:v.command.ReloadDataCommand}),v.command.ReloadDataType={__ename__:!0,__constructs__:["Domains","Friends","Talks","Messages","AllUsers","GetUsers","GetProfile","SearchDomainUsers","Announcements","Questions","Question","Files"]},v.command.ReloadDataType.Domains=["Domains",0],v.command.ReloadDataType.Domains.toString=f,v.command.ReloadDataType.Domains.__enum__=v.command.ReloadDataType,v.command.ReloadDataType.Friends=["Friends",1],v.command.ReloadDataType.Friends.toString=f,v.command.ReloadDataType.Friends.__enum__=v.command.ReloadDataType,v.command.ReloadDataType.Talks=["Talks",2],v.command.ReloadDataType.Talks.toString=f,v.command.ReloadDataType.Talks.__enum__=v.command.ReloadDataType,v.command.ReloadDataType.Messages=function(a,b){var c=["Messages",3,a,b];return c.__enum__=v.command.ReloadDataType,c.toString=f,c},v.command.ReloadDataType.AllUsers=function(a){var b=["AllUsers",4,a];return b.__enum__=v.command.ReloadDataType,b.toString=f,b},v.command.ReloadDataType.GetUsers=function(a,b){var c=["GetUsers",5,a,b];return c.__enum__=v.command.ReloadDataType,c.toString=f,c},v.command.ReloadDataType.GetProfile=function(a,b){var c=["GetProfile",6,a,b];return c.__enum__=v.command.ReloadDataType,c.toString=f,c},v.command.ReloadDataType.SearchDomainUsers=function(a,b){var c=["SearchDomainUsers",7,a,b];return c.__enum__=v.command.ReloadDataType,c.toString=f,c},v.command.ReloadDataType.Announcements=function(a){var b=["Announcements",8,a];return b.__enum__=v.command.ReloadDataType,b.toString=f,b},v.command.ReloadDataType.Questions=function(a,b,c,d){var e=["Questions",9,a,b,c,d];return e.__enum__=v.command.ReloadDataType,e.toString=f,e},v.command.ReloadDataType.Question=function(a,b){var c=["Question",10,a,b];return c.__enum__=v.command.ReloadDataType,c.toString=f,c},v.command.ReloadDataType.Files=function(a,b){var c=["Files",11,a,b];return c.__enum__=v.command.ReloadDataType,c.toString=f,c},v.command.SelectTalkCommand=function(){v.command.AutoBindCommand.call(this)},e["albero.command.SelectTalkCommand"]=v.command.SelectTalkCommand,v.command.SelectTalkCommand.__name__=["albero","command","SelectTalkCommand"],v.command.SelectTalkCommand.__super__=v.command.AutoBindCommand,v.command.SelectTalkCommand.prototype=b(v.command.AutoBindCommand.prototype,{execute:function(a){var b=a.getBody();this.settings.setSelectedTalk(b)},__class__:v.command.SelectTalkCommand}),v.command.SendCommand=function(){v.command.AutoBindCommand.call(this)},e["albero.command.SendCommand"]=v.command.SendCommand,v.command.SendCommand.__name__=["albero","command","SendCommand"],v.command.SendCommand.__super__=v.command.AutoBindCommand,v.command.SendCommand.prototype=b(v.command.AutoBindCommand.prototype,{execute:function(a){var b,c=a.getBody();b=null!=c.id?v.Int64Helper.idStr(c.id):null,null!=c.talkId?this.api.createMessage(c.talkId,c.type,c.content,b):this.api.createAnnouncement(c.domainId,c.type,c.content,b)},__class__:v.command.SendCommand}),v.command.SignInCommand=function(){v.command.AutoBindCommand.call(this)},e["albero.command.SignInCommand"]=v.command.SignInCommand,v.command.SignInCommand.__name__=["albero","command","SignInCommand"],v.command.SignInCommand.__super__=v.command.AutoBindCommand,v.command.SignInCommand.prototype=b(v.command.AutoBindCommand.prototype,{execute:function(a){var b=this.settings.getAccessToken();if(null!=b)return void this.api.createSession(b);var c=a.getBody();null==c&&(c=this.accountLoader.load()),null!=c&&this.api.createAccessToken(c.email,c.pass)},__class__:v.command.SignInCommand}),v.command.SignOutCommand=function(){v.command.AutoBindCommand.call(this)},e["albero.command.SignOutCommand"]=v.command.SignOutCommand,v.command.SignOutCommand.__name__=["albero","command","SignOutCommand"],v.command.SignOutCommand.__super__=v.command.AutoBindCommand,v.command.SignOutCommand.prototype=b(v.command.AutoBindCommand.prototype,{execute:function(){this.api.deleteSession(),this.settings.clearInputTextForAll(),null!=console&&console.error(w.dateStr(),"signout","","","",""),z.Node.process.exit(1)},__class__:v.command.SignOutCommand}),v.command.TalkCommand=function(){v.command.AutoBindCommand.call(this)},e["albero.command.TalkCommand"]=v.command.TalkCommand,v.command.TalkCommand.__name__=["albero","command","TalkCommand"],v.command.TalkCommand.__super__=v.command.AutoBindCommand,v.command.TalkCommand.prototype=b(v.command.AutoBindCommand.prototype,{execute:function(a){var b=a.getBody();switch(b[1]){case 0:var c=b[2];this.api.createTalk(c);break;case 1:var d=b[3],e=b[2];this.api.addTalkers(e,d);break;case 2:var f=b[3],g=b[2];null==f&&(f=this.dataStore.getTalk(g)),this.api.deleteTalker(f,this.dataStore.me.id);break;case 3:var h=b[6],i=b[5],j=b[4],k=b[3],l=b[2];null==k&&(k=this.dataStore.getTalk(l)),this.api.updateGroupTalk(k,j,i,h)}},__class__:v.command.TalkCommand}),v.command.TalkAction={__ename__:!0,__constructs__:["NEW","ADD","DELETE","UPDATE"]},v.command.TalkAction.NEW=function(a){var b=["NEW",0,a];return b.__enum__=v.command.TalkAction,b.toString=f,b},v.command.TalkAction.ADD=function(a,b){var c=["ADD",1,a,b];return c.__enum__=v.command.TalkAction,c.toString=f,c},v.command.TalkAction.DELETE=function(a,b){var c=["DELETE",2,a,b];return c.__enum__=v.command.TalkAction,c.toString=f,c},v.command.TalkAction.UPDATE=function(a,b,c,d,e){var g=["UPDATE",3,a,b,c,d,e];return g.__enum__=v.command.TalkAction,g.toString=f,g},v.command.UpdateProfileCommand=function(){v.command.AutoBindCommand.call(this)},e["albero.command.UpdateProfileCommand"]=v.command.UpdateProfileCommand,v.command.UpdateProfileCommand.__name__=["albero","command","UpdateProfileCommand"],v.command.UpdateProfileCommand.__super__=v.command.AutoBindCommand,v.command.UpdateProfileCommand.prototype=b(v.command.AutoBindCommand.prototype,{execute:function(a){var b=a.getBody().domainId,c=a.getBody().profileItemValues,d=a.getBody().copyToAllDomains,e=this.dataStore.getDomain(b);if(null!=e&&null!=e.profileDefinition.itemDefinitions){var f=new Array;if(d){for(var g=new Array,h=0;h<c.length;){var j=c[h];++h;var k=v.entity.ProfileItemDefinition.findById(e.profileDefinition.itemDefinitions,j.profileItemId);null!=k&&g.push({name:k.name,value:j.value})}for(var l=0,m=this.dataStore.getDomains();l<m.length;){var n=m[l];if(++l,!n.frozen){for(var o=new Array,p=0,q=n.profileDefinition.itemDefinitions;p<q.length;){var r=q[p];if(++p,r.visible&&!r.locked)for(var s=0;s<g.length;){var t=g[s];
if(++s,t.name==r.name){var u=new v.entity.ProfileItemValue;u.profileItemId=r.profileItemId,u.value=t.value,o.push(u);break}}}o.length>0&&f.push({domainId:n.id,profileItemValues:o})}}}else{for(var w=new Array,x=(i.iter(c),0);x<c.length;){var y=c[x];++x;var z=v.entity.ProfileItemDefinition.findById(e.profileDefinition.itemDefinitions,y.profileItemId);null!=z&&z.visible&&!z.locked&&w.push(y)}w.length>0&&f.push({domainId:e.id,profileItemValues:w})}0==f.length?this.sendNotification("update_profile_responsed",this.dataStore.me):this.api.updateProfile(f)}},__class__:v.command.UpdateProfileCommand}),v.command.UpdateUserCommand=function(){v.command.AutoBindCommand.call(this)},e["albero.command.UpdateUserCommand"]=v.command.UpdateUserCommand,v.command.UpdateUserCommand.__name__=["albero","command","UpdateUserCommand"],v.command.UpdateUserCommand.__super__=v.command.AutoBindCommand,v.command.UpdateUserCommand.prototype=b(v.command.AutoBindCommand.prototype,{execute:function(a){var b=a.getBody();(null==b.profileImage||q.startsWith(b.profileImage.type,"image/"))&&this.api.updateUser(b.displayName,b.profileImage,b.profileImageUrl,b.phoneticDisplayName)},__class__:v.command.UpdateUserCommand}),v.command.UrlCommand=function(){v.command.AutoBindCommand.call(this)},e["albero.command.UrlCommand"]=v.command.UrlCommand,v.command.UrlCommand.__name__=["albero","command","UrlCommand"],v.command.UrlCommand.__super__=v.command.AutoBindCommand,v.command.UrlCommand.prototype=b(v.command.AutoBindCommand.prototype,{execute:function(a){var b=a.getBody();switch(b[1]){case 0:var c=b[2];this.routing.forward(c);break;case 1:var d=b[2];this.routing.redirect(d);break;case 2:this.routing.back()}},__class__:v.command.UrlCommand}),v.command.UrlAction={__ename__:!0,__constructs__:["FORWARD","REDIRECT","BACK"]},v.command.UrlAction.FORWARD=function(a){var b=["FORWARD",0,a];return b.__enum__=v.command.UrlAction,b.toString=f,b},v.command.UrlAction.REDIRECT=function(a){var b=["REDIRECT",1,a];return b.__enum__=v.command.UrlAction,b.toString=f,b},v.command.UrlAction.BACK=["BACK",2],v.command.UrlAction.BACK.toString=f,v.command.UrlAction.BACK.__enum__=v.command.UrlAction,v.entity={},v.entity.Account=function(a,b){this.email=a,this.pass=b},e["albero.entity.Account"]=v.entity.Account,v.entity.Account.__name__=["albero","entity","Account"],v.entity.Account.prototype={__class__:v.entity.Account},v.entity.Announcement=function(a){null!=a&&(this.id=a.announcement_id,this.domainId=a.domain_id,this.groupId=a.group_id,this.groupName=a.group_name,this.type=v.entity.Message.typeOf(a.type),this.content=a.content,this.userId=a.user_id,this.userName=a.user_name,this.createdAt=a.created_at)},e["albero.entity.Announcement"]=v.entity.Announcement,v.entity.Announcement.__name__=["albero","entity","Announcement"],v.entity.Announcement.prototype={__class__:v.entity.Announcement},v.entity.AnnouncementStatus=function(a){null!=a&&(this.domainId=a.domain_id,this.unreadCount=null!=a.unread_count?a.unread_count:0,this.maxAnnouncementId=a.max_announcement_id,this.maxReadAnnouncementId=a.max_read_announcement_id)},e["albero.entity.AnnouncementStatus"]=v.entity.AnnouncementStatus,v.entity.AnnouncementStatus.__name__=["albero","entity","AnnouncementStatus"],v.entity.AnnouncementStatus.prototype={__class__:v.entity.AnnouncementStatus},v.entity.Configuration=function(){},e["albero.entity.Configuration"]=v.entity.Configuration,v.entity.Configuration.__name__=["albero","entity","Configuration"],v.entity.Configuration.prototype={__class__:v.entity.Configuration},v.entity.Domain=function(a){null!=a&&(this.id=a.domain_id,this.name=a.domain_name,this.role=new v.entity.DomainRole(a.role),this.frozen=a.frozen,this.updatedAt=a.updated_at,this.plan=new v.entity.Plan(a.plan),this.closed=!1,this.profileDefinition=new v.entity.ProfileDefinition(a.profile_definition))},e["albero.entity.Domain"]=v.entity.Domain,v.entity.Domain.__name__=["albero","entity","Domain"],v.entity.Domain.prototype={__class__:v.entity.Domain},v.entity.DomainRole=function(a){null!=a&&(this.type=this.typeOf(a.type),this.allowGuests=this.def(a.allow_guests,!0),this.allowCreateAttachments=this.def(a.allow_create_attachments,!0),this.allowReadAttachments=this.def(a.allow_read_attachments,!0),this.allowCreateAnnouncement=this.def(a.allow_create_announcement,!1),this.allowReadAnnouncements=a.allow_read_announcements,null==this.allowReadAnnouncements&&(this.allowReadAnnouncements=!0),this.allowListUsers=a.allow_list_users,null==this.allowListUsers&&(this.allowListUsers=!0))},e["albero.entity.DomainRole"]=v.entity.DomainRole,v.entity.DomainRole.__name__=["albero","entity","DomainRole"],v.entity.DomainRole.prototype={def:function(a,b){return a?a:b},typeOf:function(a){switch(a){case 10:return v.entity.DomainRoleType.owner;case 20:return v.entity.DomainRoleType.manager;case 30:return v.entity.DomainRoleType.user;default:return v.entity.DomainRoleType.guest}},__class__:v.entity.DomainRole},v.entity.DomainRoleType={__ename__:!0,__constructs__:["owner","manager","user","guest"]},v.entity.DomainRoleType.owner=["owner",0],v.entity.DomainRoleType.owner.toString=f,v.entity.DomainRoleType.owner.__enum__=v.entity.DomainRoleType,v.entity.DomainRoleType.manager=["manager",1],v.entity.DomainRoleType.manager.toString=f,v.entity.DomainRoleType.manager.__enum__=v.entity.DomainRoleType,v.entity.DomainRoleType.user=["user",2],v.entity.DomainRoleType.user.toString=f,v.entity.DomainRoleType.user.__enum__=v.entity.DomainRoleType,v.entity.DomainRoleType.guest=["guest",3],v.entity.DomainRoleType.guest.toString=f,v.entity.DomainRoleType.guest.__enum__=v.entity.DomainRoleType,v.entity.DomainInvite=function(a){null!=a&&(this.id=a.domain_id,this.name=a.domain_name,this.updatedAt=a.updated_at)},e["albero.entity.DomainInvite"]=v.entity.DomainInvite,v.entity.DomainInvite.__name__=["albero","entity","DomainInvite"],v.entity.DomainInvite.prototype={__class__:v.entity.DomainInvite},v.entity.User=function(a){null!=a&&(this.id=a.user_id,this.displayName=a.display_name,this.canonicalDisplayName=a.canonical_display_name,this.phoneticDisplayName=a.phonetic_display_name,this.canonicalPhoneticDisplayName=a.canonical_phonetic_display_name,this.profileImageUrl=a.profile_image_url,this.updatedAt=a.updated_at)},e["albero.entity.User"]=v.entity.User,v.entity.User.__name__=["albero","entity","User"],v.entity.User.prototype={__class__:v.entity.User},v.entity.DomainUser=function(a){if(v.entity.User.call(this,a),null!=a&&(this.domainId=a.domain_id,null!=a.profile_contact)){this.profileContact=new Array;var b,c=0;for(b=z.Boot.__cast(a.profile_contact,Array);c<b.length;){var d=b[c];++c,this.profileContact.push(new v.entity.ProfileItemValue(d))}}},e["albero.entity.DomainUser"]=v.entity.DomainUser,v.entity.DomainUser.__name__=["albero","entity","DomainUser"],v.entity.DomainUser.__super__=v.entity.User,v.entity.DomainUser.prototype=b(v.entity.User.prototype,{match:function(a,b){if(null==a||0==a.length)return!0;if((null==this.canonicalDisplayName||0==this.canonicalDisplayName.length)&&(this.canonicalDisplayName=v.js.TextCanonicalizer.canonicalize(this.displayName)),this.canonicalDisplayName.indexOf(a)>-1)return!0;if(null!=this.canonicalPhoneticDisplayName&&this.canonicalPhoneticDisplayName.indexOf(a)>-1)return!0;if(null!=this.profileContact&&null!=b.profileDefinition.itemDefinitions)for(var c=0,d=this.profileContact;c<d.length;){var e=d[c];++c;for(var f=0,g=b.profileDefinition.itemDefinitions;f<g.length;){var h=g[f];if(++f,h.profileItemId==e.profileItemId){if(h.visible&&10==h.group&&e.canonicalValue.indexOf(a)>-1)return!0;break}}}return!1},__class__:v.entity.DomainUser}),v.entity.FileInfo=function(a){null!=a&&(this.messageId=a.message_id,this.talkId=a.talk_id,this.id=a.file_id,this.userId=a.user_id,this.name=a.name,this.contentType=a.content_type,this.contentSize=a.content_size,this.url=a.url,this.thumbUrl=a.thumbnail_url,this.updatedAt=a.updated_at,this.file=a.file,this.thumbFile=a.thumbnail_file)},e["albero.entity.FileInfo"]=v.entity.FileInfo,v.entity.FileInfo.__name__=["albero","entity","FileInfo"],v.entity.FileInfo.prototype={__class__:v.entity.FileInfo},v.entity.FileInfoDeletion=function(a){null!=a&&(this.messageId=a[0],this.talkId=a[1],this.fileId=a[2])},e["albero.entity.FileInfoDeletion"]=v.entity.FileInfoDeletion,v.entity.FileInfoDeletion.__name__=["albero","entity","FileInfoDeletion"],v.entity.FileInfoDeletion.prototype={__class__:v.entity.FileInfoDeletion},v.entity.Me=function(a){if(v.entity.User.call(this,a),null!=a&&(this.email=a.email,null!=a.profiles)){this.profiles=new Array;var b,c=0;for(b=z.Boot.__cast(a.profiles,Array);c<b.length;){var d=b[c];++c,this.profiles.push(new v.entity.Profile(d))}}},e["albero.entity.Me"]=v.entity.Me,v.entity.Me.__name__=["albero","entity","Me"],v.entity.Me.__super__=v.entity.User,v.entity.Me.prototype=b(v.entity.User.prototype,{toDomainUser:function(a){var b=new v.entity.DomainUser;if(b.id=this.id,b.domainId=a,b.displayName=this.displayName,b.canonicalDisplayName=this.canonicalDisplayName,b.phoneticDisplayName=this.phoneticDisplayName,b.canonicalPhoneticDisplayName=this.canonicalPhoneticDisplayName,b.profileImageUrl=this.profileImageUrl,b.updatedAt=this.updatedAt,b.email=this.email,null!=this.profiles)for(var c=0,d=this.profiles;c<d.length;){var e=d[c];if(++c,v.Int64Helper.eq(e.domainId,a)){b.profileContact=e.itemValues;break}}return b},__class__:v.entity.Me}),v.entity.Message=function(a){null!=a&&(this.id=a.message_id,this.talkId=a.talk_id,this.userId=a.user_id,this.type=v.entity.Message.typeOf(a.type),this.content=a.content,this.createdAt=a.created_at,this.readCount=a.read_count,this.readUserIds=a.read_user_ids,this.isUnreadCountTarget=null==a.is_unread_count_target?!0:a.is_unread_count_target)},e["albero.entity.Message"]=v.entity.Message,v.entity.Message.__name__=["albero","entity","Message"],v.entity.Message.typeOf=function(a){switch(a){case 0:return v.entity.MessageType.system;case 1:return v.entity.MessageType.text;case 2:return v.entity.MessageType.stamp;case 3:return v.entity.MessageType.geo;case 4:return v.entity.MessageType.file;case 500:return v.entity.MessageType.yesOrNo;case 501:return v.entity.MessageType.yesOrNoReply;case 502:return v.entity.MessageType.selectOne;case 503:return v.entity.MessageType.selectOneReply;case 504:return v.entity.MessageType.todo;case 505:return v.entity.MessageType.todoDone;case 506:return v.entity.MessageType.yesOrNoClosed;case 507:return v.entity.MessageType.selectOneClosed;case 508:return v.entity.MessageType.todoClosed;case 600:return v.entity.MessageType.phoneCall;case 601:return v.entity.MessageType.phoneReceive;default:return v.entity.MessageType.unknown}},v.entity.Message.enumIndex=function(a){switch(a[1]){case 0:case 1:case 2:case 3:case 4:return a[1];case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:return 500+a[1]-5;case 14:case 15:return 600+a[1]-14;default:return-1}},v.entity.Message.prototype={__class__:v.entity.Message},v.entity.MessageType={__ename__:!0,__constructs__:["system","text","stamp","geo","file","yesOrNo","yesOrNoReply","selectOne","selectOneReply","todo","todoDone","yesOrNoClosed","selectOneClosed","todoClosed","phoneCall","phoneReceive","unknown"]},v.entity.MessageType.system=["system",0],v.entity.MessageType.system.toString=f,v.entity.MessageType.system.__enum__=v.entity.MessageType,v.entity.MessageType.text=["text",1],v.entity.MessageType.text.toString=f,v.entity.MessageType.text.__enum__=v.entity.MessageType,v.entity.MessageType.stamp=["stamp",2],v.entity.MessageType.stamp.toString=f,v.entity.MessageType.stamp.__enum__=v.entity.MessageType,v.entity.MessageType.geo=["geo",3],v.entity.MessageType.geo.toString=f,v.entity.MessageType.geo.__enum__=v.entity.MessageType,v.entity.MessageType.file=["file",4],v.entity.MessageType.file.toString=f,v.entity.MessageType.file.__enum__=v.entity.MessageType,v.entity.MessageType.yesOrNo=["yesOrNo",5],v.entity.MessageType.yesOrNo.toString=f,v.entity.MessageType.yesOrNo.__enum__=v.entity.MessageType,v.entity.MessageType.yesOrNoReply=["yesOrNoReply",6],v.entity.MessageType.yesOrNoReply.toString=f,v.entity.MessageType.yesOrNoReply.__enum__=v.entity.MessageType,v.entity.MessageType.selectOne=["selectOne",7],v.entity.MessageType.selectOne.toString=f,v.entity.MessageType.selectOne.__enum__=v.entity.MessageType,v.entity.MessageType.selectOneReply=["selectOneReply",8],v.entity.MessageType.selectOneReply.toString=f,v.entity.MessageType.selectOneReply.__enum__=v.entity.MessageType,v.entity.MessageType.todo=["todo",9],v.entity.MessageType.todo.toString=f,v.entity.MessageType.todo.__enum__=v.entity.MessageType,v.entity.MessageType.todoDone=["todoDone",10],v.entity.MessageType.todoDone.toString=f,v.entity.MessageType.todoDone.__enum__=v.entity.MessageType,v.entity.MessageType.yesOrNoClosed=["yesOrNoClosed",11],v.entity.MessageType.yesOrNoClosed.toString=f,v.entity.MessageType.yesOrNoClosed.__enum__=v.entity.MessageType,v.entity.MessageType.selectOneClosed=["selectOneClosed",12],v.entity.MessageType.selectOneClosed.toString=f,v.entity.MessageType.selectOneClosed.__enum__=v.entity.MessageType,v.entity.MessageType.todoClosed=["todoClosed",13],v.entity.MessageType.todoClosed.toString=f,v.entity.MessageType.todoClosed.__enum__=v.entity.MessageType,v.entity.MessageType.phoneCall=["phoneCall",14],v.entity.MessageType.phoneCall.toString=f,v.entity.MessageType.phoneCall.__enum__=v.entity.MessageType,v.entity.MessageType.phoneReceive=["phoneReceive",15],v.entity.MessageType.phoneReceive.toString=f,v.entity.MessageType.phoneReceive.__enum__=v.entity.MessageType,v.entity.MessageType.unknown=["unknown",16],v.entity.MessageType.unknown.toString=f,v.entity.MessageType.unknown.__enum__=v.entity.MessageType,v.entity.MessageReadStatus=function(a){null!=a&&(this.id=a.message_id,this.talkId=a.talk_id,this.readUserIds=a.read_user_ids,this.unreadUserIds=a.unread_user_ids)},e["albero.entity.MessageReadStatus"]=v.entity.MessageReadStatus,v.entity.MessageReadStatus.__name__=["albero","entity","MessageReadStatus"],v.entity.MessageReadStatus.prototype={__class__:v.entity.MessageReadStatus},v.entity.MessageReadStatusesUpdate=function(a){null!=a&&(this.talkId=a.talk_id,this.messageIds=a.message_ids,this.readUserIds=a.read_user_ids,this.messageIdsExcludingUnreadCountTargets=a.message_ids_excluding_unread_count_targets,null==this.messageIdsExcludingUnreadCountTargets&&(this.messageIdsExcludingUnreadCountTargets=new Array))},e["albero.entity.MessageReadStatusesUpdate"]=v.entity.MessageReadStatusesUpdate,v.entity.MessageReadStatusesUpdate.__name__=["albero","entity","MessageReadStatusesUpdate"],v.entity.MessageReadStatusesUpdate.prototype={__class__:v.entity.MessageReadStatusesUpdate},v.entity.Plan=function(a){null!=a&&(this.name=a.plan_name,this.trial=a.trial)},e["albero.entity.Plan"]=v.entity.Plan,v.entity.Plan.__name__=["albero","entity","Plan"],v.entity.Plan.prototype={__class__:v.entity.Plan},v.entity.Profile=function(a){if(null!=a&&(this.domainId=a.domain_id,this.userId=a.user_id,null!=a.item_values)){this.itemValues=new Array;var b,c=0;for(b=z.Boot.__cast(a.item_values,Array);c<b.length;){var d=b[c];++c,this.itemValues.push(new v.entity.ProfileItemValue(d))}}},e["albero.entity.Profile"]=v.entity.Profile,v.entity.Profile.__name__=["albero","entity","Profile"],v.entity.Profile.prototype={__class__:v.entity.Profile},v.entity.ProfileDefinition=function(a){if(null!=a&&(this.domainId=a.domain_id,null!=a.item_definitions)){this.itemDefinitions=new Array;var b,c=0;for(b=z.Boot.__cast(a.item_definitions,Array);c<b.length;){var d=b[c];++c,this.itemDefinitions.push(new v.entity.ProfileItemDefinition(d))}}},e["albero.entity.ProfileDefinition"]=v.entity.ProfileDefinition,v.entity.ProfileDefinition.__name__=["albero","entity","ProfileDefinition"],v.entity.ProfileDefinition.isSameProfileItemDefinitions=function(a,b){if(b.length!=a.length)return!1;for(var c=0,d=b.length;d>c;){var e=c++;if(b[e].profileItemId!=a[e].profileItemId)return!1}return!0},v.entity.ProfileDefinition.prototype={getVisibleItemDefinition:function(a){null==a&&(a=!1);var b=new Array;if(null!=this.itemDefinitions)for(var c=0,d=this.itemDefinitions;c<d.length;){var e=d[c];++c,e.visible&&(a||10==e.group)&&b.push(e)}return b},__class__:v.entity.ProfileDefinition},v.entity.ProfileItemDefinition=function(a){this.locked=!1,this.visible=!0,null!=a&&(this.profileItemId=a.profile_item_id,this.group=a.group,this.name=a.name,this.valueType=a.value_type,null!=a.visible&&(this.visible=a.visible),null!=a.locked&&(this.locked=a.locked))},e["albero.entity.ProfileItemDefinition"]=v.entity.ProfileItemDefinition,v.entity.ProfileItemDefinition.__name__=["albero","entity","ProfileItemDefinition"],v.entity.ProfileItemDefinition.findById=function(a,b){for(var c=0;c<a.length;){var d=a[c];if(++c,d.profileItemId==b)return d}return null},v.entity.ProfileItemDefinition.prototype={__class__:v.entity.ProfileItemDefinition},v.entity.ProfileItemValue=function(a){null!=a&&(this.profileItemId=a.profile_item_id,this.value=a.value,this.canonicalValue=a.canonical_value)},e["albero.entity.ProfileItemValue"]=v.entity.ProfileItemValue,v.entity.ProfileItemValue.__name__=["albero","entity","ProfileItemValue"],v.entity.ProfileItemValue.findById=function(a,b){for(var c=0;c<a.length;){var d=a[c];if(++c,d.profileItemId==b)return d}return null},v.entity.ProfileItemValue.prototype={__class__:v.entity.ProfileItemValue},v.entity.Question=function(a){null!=a&&(this.id=a.message_id,this.talkId=a.talk_id,this.type=v.entity.Message.typeOf(a.type),this.content=a.content,this.userId=a.user_id,this.recipientIds=a.assigned_user_ids,this.responses=this.createResponses(a.responses),this.listing=a.listing,this.closingType=v.entity.Question.typeOf(a.closing_type),this.maxResponseId=a.max_response_id,this.lastResponse=a.last_response,this.lastResponseUserId=a.last_response_user_id,this.createdAt=a.created_at,this.updatedAt=a.updated_at,this.responded=a.responded,this.closed=a.closed)},e["albero.entity.Question"]=v.entity.Question,v.entity.Question.__name__=["albero","entity","Question"],v.entity.Question.typeOf=function(a){switch(a){case 0:return v.entity.QuestionClosingType.any;case 1:return v.entity.QuestionClosingType.all;default:return v.entity.QuestionClosingType.unknown}},v.entity.Question.prototype={createResponses:function(a){var b=[];if(null!=a)for(var c=0;c<a.length;){var d=a[c];++c,b.push(new v.entity.QuestionResponse(d))}return b},isCompleted:function(a){if(t.enumEq(this.type,v.entity.MessageType.todo)){if(t.enumEq(this.closingType,v.entity.QuestionClosingType.any)){if(null!=this.lastResponse&&"DONE"==this.responses[this.lastResponse].content)return!0}else{if(!this.responded)return!1;for(var b=0,c=this.responses;b<c.length;){var d=c[b];if(++b,v.Int64Helper.contains(d.userIds,a))return"DONE"==d.content?!0:!1}}return!1}return t.enumEq(this.closingType,v.entity.QuestionClosingType.any)?null!=this.lastResponse:this.responded},__class__:v.entity.Question},v.entity.QuestionResponse=function(a){null!=a&&(this.content=a.content,this.count=a.count,this.userIds=a.user_ids)},e["albero.entity.QuestionResponse"]=v.entity.QuestionResponse,v.entity.QuestionResponse.__name__=["albero","entity","QuestionResponse"],v.entity.QuestionResponse.prototype={__class__:v.entity.QuestionResponse},v.entity.QuestionClosingType={__ename__:!0,__constructs__:["any","all","unknown"]},v.entity.QuestionClosingType.any=["any",0],v.entity.QuestionClosingType.any.toString=f,v.entity.QuestionClosingType.any.__enum__=v.entity.QuestionClosingType,v.entity.QuestionClosingType.all=["all",1],v.entity.QuestionClosingType.all.toString=f,v.entity.QuestionClosingType.all.__enum__=v.entity.QuestionClosingType,v.entity.QuestionClosingType.unknown=["unknown",2],v.entity.QuestionClosingType.unknown.toString=f,v.entity.QuestionClosingType.unknown.__enum__=v.entity.QuestionClosingType,v.entity.QuestionFromType={__ename__:!0,__constructs__:["fromSelf","fromOther"]},v.entity.QuestionFromType.fromSelf=["fromSelf",0],v.entity.QuestionFromType.fromSelf.toString=f,v.entity.QuestionFromType.fromSelf.__enum__=v.entity.QuestionFromType,v.entity.QuestionFromType.fromOther=["fromOther",1],v.entity.QuestionFromType.fromOther.toString=f,v.entity.QuestionFromType.fromOther.__enum__=v.entity.QuestionFromType,v.entity.QuestionFilter={__ename__:!0,__constructs__:["onlyClosed","onlyUnclosed","noFilter"]},v.entity.QuestionFilter.onlyClosed=["onlyClosed",0],v.entity.QuestionFilter.onlyClosed.toString=f,v.entity.QuestionFilter.onlyClosed.__enum__=v.entity.QuestionFilter,v.entity.QuestionFilter.onlyUnclosed=["onlyUnclosed",1],v.entity.QuestionFilter.onlyUnclosed.toString=f,v.entity.QuestionFilter.onlyUnclosed.__enum__=v.entity.QuestionFilter,v.entity.QuestionFilter.noFilter=["noFilter",2],v.entity.QuestionFilter.noFilter.toString=f,v.entity.QuestionFilter.noFilter.__enum__=v.entity.QuestionFilter,v.entity.StampSet=function(){},e["albero.entity.StampSet"]=v.entity.StampSet,v.entity.StampSet.__name__=["albero","entity","StampSet"],v.entity.StampSet.prototype={__class__:v.entity.StampSet},v.entity.Talk=function(a){null!=a&&(this.id=a.talk_id,this.domainId=a.domain_id,this.type=this.typeOf(a.type),this.name=a.talk_name,this.iconUrl=a.icon_url,this.userIds=a.user_ids,this.guestIds=a.inviting_guest_ids,this.updatedAt=a.updated_at,this.leftUsers=this.getUsers(a.left_users))},e["albero.entity.Talk"]=v.entity.Talk,v.entity.Talk.__name__=["albero","entity","Talk"],v.entity.Talk.prototype={typeOf:function(a){switch(a){case 1:return v.entity.TalkType.PairTalk;case 2:return v.entity.TalkType.GroupTalk;default:return v.entity.TalkType.Unknown}},getUsers:function(a){if(null==a)return null;for(var b=new Array,c=0;c<a.length;){var d=a[c];++c,b.push(new v.entity.DomainUser(d))}return b},__class__:v.entity.Talk},v.entity.TalkType={__ename__:!0,__constructs__:["Unknown","PairTalk","GroupTalk"]},v.entity.TalkType.Unknown=["Unknown",0],v.entity.TalkType.Unknown.toString=f,v.entity.TalkType.Unknown.__enum__=v.entity.TalkType,v.entity.TalkType.PairTalk=["PairTalk",1],v.entity.TalkType.PairTalk.toString=f,v.entity.TalkType.PairTalk.__enum__=v.entity.TalkType,v.entity.TalkType.GroupTalk=["GroupTalk",2],v.entity.TalkType.GroupTalk.toString=f,v.entity.TalkType.GroupTalk.__enum__=v.entity.TalkType,v.entity.TalkStatus=function(a){this.unreadCount=0,null!=a&&(this.id=a.talk_id,this.unreadCount=null!=a.unread_count?a.unread_count:0,this.maxMessageId=a.max_message_id,this.maxMessage=null!=a.max_message?new v.entity.Message(a.max_message):null,this.maxReadMessageId=a.max_read_message_id,this.maxEveryoneReadMessageId=a.max_everyone_read_message_id)},e["albero.entity.TalkStatus"]=v.entity.TalkStatus,v.entity.TalkStatus.__name__=["albero","entity","TalkStatus"],v.entity.TalkStatus.prototype={__class__:v.entity.TalkStatus},v.entity.TalkStatusUpdate=function(a){null!=a&&(this.talkId=a.talk_id,this.maxEveryoneReadMessageId=a.max_everyone_read_message_id)},e["albero.entity.TalkStatusUpdate"]=v.entity.TalkStatusUpdate,v.entity.TalkStatusUpdate.__name__=["albero","entity","TalkStatusUpdate"],v.entity.TalkStatusUpdate.prototype={__class__:v.entity.TalkStatusUpdate};var w=a.AlberoLog=function(){};e.AlberoLog=w,w.__name__=["AlberoLog"],w.dateStr=function(){return"["+function(){var a,b=new Date;return a=i.dateStr(b)}(this)+"] "},v.js={},v.js.TextCanonicalizer=function(){},e["albero.js.TextCanonicalizer"]=v.js.TextCanonicalizer,v.js.TextCanonicalizer.__name__=["albero","js","TextCanonicalizer"],v.js.TextCanonicalizer.canonicalize=function(a){return v.js.TextCanonicalizer.basicLatinAlphabetToUpperCase(v.js.TextCanonicalizer.hiraganaToKatakana(v.js.TextCanonicalizer.normalize(v.js.TextCanonicalizer.eraseInvisible(a))))},v.js.TextCanonicalizer.basicLatinAlphabetToUpperCase=function(a){return a.toUpperCase()},v.js.TextCanonicalizer.hiraganaToKatakana=function(a){for(var b=0,c="",d=0,e=a.length;e>d;){var f=d++,g=i.cca(a,f);g>=v.js.TextCanonicalizer.HIRAGANA_SMALL_A&&g<=v.js.TextCanonicalizer.HIRAGANA_NN&&(c+=a.substring(b,f),c+=String.fromCharCode(g+(v.js.TextCanonicalizer.KATAKANA_SMALL_A-v.js.TextCanonicalizer.HIRAGANA_SMALL_A)),b=f+1)}return c+=a.substring(b,a.length)},v.js.TextCanonicalizer.normalize=function(a){return a.normalize("NFKC")},v.js.TextCanonicalizer.eraseInvisible=function(a){var b=new h("[\\u0000-\\u0020　]","g");return b.replace(a,"")},v.js.WebSocket=function(a){var b=this,c=z.Node.require("websocket").client;this.ws=new c,this.ws.on("connectFailed",d(this,this.onError)),this.ws.on("connect",function(a){b.connection=a,a.on("error",d(b,b.onError)),a.on("close",d(b,b.onConnectionClose)),a.on("message",d(b,b.onMessage)),b.onOpen(null)});var e=null;if(null!=C.proxyURL){var f=z.Node.require("url").parse(C.proxyURL),g={host:f.hostname};null!=f.port&&(g.port=o.parseInt(f.port)),null!=f.auth&&(g.proxyAuth=f.auth);var h,i=z.Node.require("tunnel-agent");h="https:"==f.protocol?i.httpsOverHttps:i.httpsOverHttp,e={agent:h({proxy:g})}}this.ws.connect(a,null,null,null,e)},e["albero.js.WebSocket"]=v.js.WebSocket,v.js.WebSocket.__name__=["albero","js","WebSocket"],v.js.WebSocket.prototype={onOpen:function(){null!=console&&console.info(w.dateStr(),"WebSocket opened.","","","",""),null!=this.onopen&&this.onopen()},onMessage:function(a){if(null!=this.onmessage){var b=null,c=a;b=y.io.Bytes.ofData(c.binaryData),this.onmessage(b)}},onError:function(a){null!=console&&console.error(w.dateStr(),"WebSocket error. event:",a,"","",""),null!=this.onerror&&this.onerror()},onClose:function(a){this.ws=null,this.connection=null,null!=console&&console.info(w.dateStr(),"WebSocket closed. event:%s reason:%s wasClean:%s",a.code,a.reason,a.wasClean,""),null!=this.onclose&&this.onclose(a.code,a.reason,a.wasClean)},onConnectionClose:function(a,b){this.onClose({code:a,reason:b})},close:function(){this.isClosed()||this.connection.close()},send:function(a){this.isClosed()||this.connection.sendBytes(a.b)},isClosed:function(){return null==this.ws||null==this.connection||!this.connection.connected},__class__:v.js.WebSocket},u.interfaces.IProxy=function(){},e["puremvc.interfaces.IProxy"]=u.interfaces.IProxy,u.interfaces.IProxy.__name__=["puremvc","interfaces","IProxy"],u.interfaces.IProxy.prototype={__class__:u.interfaces.IProxy},v.proxy={},v.proxy.AccountLoaderProxy=function(){},e["albero.proxy.AccountLoaderProxy"]=v.proxy.AccountLoaderProxy,v.proxy.AccountLoaderProxy.__name__=["albero","proxy","AccountLoaderProxy"],v.proxy.AccountLoaderProxy.__interfaces__=[u.interfaces.IProxy],v.proxy.AccountLoaderProxy.prototype={__class__:v.proxy.AccountLoaderProxy},v.proxy.AccountLoaderProxyFactory=function(){},e["albero.proxy.AccountLoaderProxyFactory"]=v.proxy.AccountLoaderProxyFactory,v.proxy.AccountLoaderProxyFactory.__name__=["albero","proxy","AccountLoaderProxyFactory"],v.proxy.AccountLoaderProxyFactory.newInstance=function(){var a=t.resolveClass("albero.debug.proxy.AccountLoaderProxyImpl");return null!=a?t.createInstance(a,["accountLoader"]):new v.proxy._AccountLoaderProxy.DefaultTestAccountLoaderProxy("accountLoader")},u.patterns.proxy={},u.patterns.proxy.Proxy=function(a,b){u.patterns.observer.Notifier.call(this),this.proxyName=null!=a?a:u.patterns.proxy.Proxy.NAME,null!=b&&this.setData(b)},e["puremvc.patterns.proxy.Proxy"]=u.patterns.proxy.Proxy,u.patterns.proxy.Proxy.__name__=["puremvc","patterns","proxy","Proxy"],u.patterns.proxy.Proxy.__interfaces__=[u.interfaces.IProxy],u.patterns.proxy.Proxy.__super__=u.patterns.observer.Notifier,u.patterns.proxy.Proxy.prototype=b(u.patterns.observer.Notifier.prototype,{getProxyName:function(){return this.proxyName},setData:function(a){this.data=a},getData:function(){return this.data},onRegister:function(){},onRemove:function(){},__class__:u.patterns.proxy.Proxy}),v.proxy._AccountLoaderProxy={},v.proxy._AccountLoaderProxy.DefaultTestAccountLoaderProxy=function(a){u.patterns.proxy.Proxy.call(this,a)},e["albero.proxy._AccountLoaderProxy.DefaultTestAccountLoaderProxy"]=v.proxy._AccountLoaderProxy.DefaultTestAccountLoaderProxy,v.proxy._AccountLoaderProxy.DefaultTestAccountLoaderProxy.__name__=["albero","proxy","_AccountLoaderProxy","DefaultTestAccountLoaderProxy"],v.proxy._AccountLoaderProxy.DefaultTestAccountLoaderProxy.__interfaces__=[v.proxy.AccountLoaderProxy],v.proxy._AccountLoaderProxy.DefaultTestAccountLoaderProxy.__super__=u.patterns.proxy.Proxy,v.proxy._AccountLoaderProxy.DefaultTestAccountLoaderProxy.prototype=b(u.patterns.proxy.Proxy.prototype,{load:function(){var a=this,b=z.Node.require("read");return b({prompt:"Email: "},function(c,d){b({prompt:"Password: ",silent:!0},function(b,c){a.sendNotification("SignIn",new v.entity.Account(d,c))})}),null},__class__:v.proxy._AccountLoaderProxy.DefaultTestAccountLoaderProxy}),v.proxy.AlberoBroadcastProxy=function(){u.patterns.proxy.Proxy.call(this,"broadcast")},e["albero.proxy.AlberoBroadcastProxy"]=v.proxy.AlberoBroadcastProxy,v.proxy.AlberoBroadcastProxy.__name__=["albero","proxy","AlberoBroadcastProxy"],v.proxy.AlberoBroadcastProxy.__super__=u.patterns.proxy.Proxy,v.proxy.AlberoBroadcastProxy.prototype=b(u.patterns.proxy.Proxy.prototype,{handleNotification:function(a,b,c){var d=this;switch(a){case"notify_update_user":if(b instanceof Array&&null==b.__enum__){var e=new v.entity.DomainUser(b[1]);this.dataStore.setUserIfLatest(null,e)}else{var f=new v.entity.Me(b);w.DEBUG&&null!=console&&console.log(w.dateStr(),"Current user updated. user:",f,"","",""),this.dataStore.setMe(f)}c();break;case"notify_add_friend":var g=new v.entity.DomainUser(b[1]);this.dataStore.addFriend(g),this.sendNotification(a,g),c();break;case"notify_add_acquaintance":var h=new v.entity.DomainUser(b[1]);this.dataStore.addAcquaintance(h),this.sendNotification(a,h),c();break;case"notify_join_domain":var i=new v.entity.Domain(b);this.dataStore.setDomain(i),this.sendNotification(a,[null,i]),c();break;case"notify_update_domain":var j=new v.entity.Domain(b),k=this.dataStore.getDomain(j.id);if(this.dataStore.setDomain(j),null!=k&&k.role.allowReadAnnouncements&&!j.role.allowReadAnnouncements){this.dataStore.removeAnnouncementStatus(k.id);var l=new v.entity.AnnouncementStatus;l.domainId=j.id,this.sendNotification("notify_update_announcement_status",l)}this.sendNotification(a,[k,j]),c();break;case"notify_add_domain_invite":var m=new v.entity.DomainInvite(b);this.dataStore.setDomainInvite(m),this.sendNotification(a,m),c();break;case"notify_create_pair_talk":case"notify_create_group_talk":case"notify_update_group_talk":case"notify_add_talkers":case"notify_delete_talker":var n=new v.entity.Talk(b);this.dataStore.setTalk(n),this.sendNotification(a,n),c();break;case"notify_create_message":var o=new v.entity.Message(b),p=this.newTalkStatusByMessage(o);null!=p&&this.sendNotification("notify_update_local_talk_status",p);var q=o.type;switch(q[1]){case 15:this.sendNotification("phone_call_connected",o.content),this.sendNotification(a,o),c();break;case 5:case 7:case 9:y.Timer.delay(function(){d.sendNotification("ReloadData",v.command.ReloadDataType.Question(o.id,function(){d.sendNotification(a,o),c()}))},500);break;case 6:case 8:case 10:case 11:case 12:case 13:y.Timer.delay(function(){d.sendNotification("ReloadData",v.command.ReloadDataType.Question(o.content.in_reply_to,function(){d.sendNotification(a,o),c()}))},500);break;case 4:if(null!=o.content.file_id){var r=new v.entity.FileInfo;r.messageId=o.id,r.talkId=o.talkId,r.userId=o.userId,r.updatedAt=o.createdAt,r.id=o.content.file_id,r.name=o.content.name,r.contentType=o.content.content_type,r.contentSize=o.content.content_size,r.url=o.content.url,this.sendNotification("notify_create_attachment",r)}this.sendNotification(a,o),c();break;case 0:var s=o.content,t=null,u=s.type;switch(u){case"delete_talker":t=s.deleted_user_id;break;case"hide_pair_talk":t=s.user_id}if(null==t)return;for(var x=o.talkId,z=this.dataStore.getQuestions(x,t),A=0;A<z.length;){var B=z[A];++A,B.closed=!0,this.sendNotification("notify_update_question",B)}this.sendNotification(a,o),c();break;default:this.sendNotification(a,o),c()}break;case"notify_update_read_statuses":var C=new v.entity.MessageReadStatusesUpdate(b),D=this.updateTalkStatus(C);
null!=D&&this.sendNotification("notify_update_local_talk_status",D),this.sendNotification(a,C),c();break;case"notify_update_talk_status":var E=new v.entity.TalkStatusUpdate(b),F=this.dataStore.getTalkStatus(E.talkId);null!=F&&(null==F.maxEveryoneReadMessageId||y.Int64.compare(F.maxEveryoneReadMessageId,E.maxEveryoneReadMessageId)<0)&&(F.maxEveryoneReadMessageId=E.maxEveryoneReadMessageId,this.dataStore.setTalkStatus(F),this.sendNotification("notify_update_local_talk_status",F)),this.sendNotification(a,E),c();break;case"notify_create_announcement":var G=new v.entity.Announcement(b);this.sendNotification("notify_update_announcement_status",this.newAnnouncementStatus(G)),this.sendNotification(a,G),c();break;case"notify_update_announcement_status":var H=new v.entity.AnnouncementStatus(b),I=this.dataStore.getAnnouncementStatus(H.domainId);null==I?this.dataStore.setAnnouncementStatus(H):null==I.maxReadAnnouncementId||y.Int64.compare(I.maxReadAnnouncementId,H.maxReadAnnouncementId)<0?this.dataStore.setAnnouncementStatus(H):(w.DEBUG&&null!=console&&console.log(w.dateStr(),"notified announcement status is older than current status. notified:%o, current:%o",H,I,"",""),H.maxReadAnnouncementId=I.maxReadAnnouncementId,H.maxAnnouncementId=I.maxAnnouncementId,H.unreadCount=I.unreadCount),this.sendNotification(a,H),c();break;case"notify_delete_attachment":var J=new v.entity.FileInfoDeletion(b);this.sendNotification(a,J),c();break;case"notify_leave_domain":var K=b;this.dataStore.removeDomain(K),this.sendNotification(a,K),c();break;case"notify_delete_domain_invite":var L=b;this.dataStore.removeDomainInvite(L),this.sendNotification(a,L),c();break;case"notify_delete_friend":this.dataStore.removeFriend(b[0],b[1]),this.sendNotification(a,b),c();break;case"notify_delete_acquaintance":this.dataStore.removeAcquaintance(b[0],b[1]),this.sendNotification(a,b),c();break;case"notify_delete_talk":this.dataStore.removeTalk(b),this.dataStore.removeTalkStatus(b),this.sendNotification("SelectTalk",null),this.sendNotification(a,b),c();break;default:this.sendNotification(a,b),c()}},newTalkStatusByMessage:function(a){var b=this.dataStore.getTalkStatus(a.talkId);return null==b&&(b=new v.entity.TalkStatus,b.id=a.talkId),(null==b.maxMessageId||y.Int64.compare(b.maxMessageId,a.id)<0)&&(b.maxMessageId=a.id,b.maxMessage=a),!this.dataStore.isMe(a.userId)&&a.isUnreadCountTarget&&b.unreadCount++,this.dataStore.setTalkStatus(b),b},updateTalkStatus:function(a){var b=this;if(!j.exists(a.readUserIds,function(a){return b.dataStore.isMe(a)}))return null;for(var c=this.dataStore.getTalkStatus(a.talkId),d=a.messageIds[0],e=0,f=a.messageIds;e<f.length;){var g=f[e];++e,(null==c.maxReadMessageId||y.Int64.compare(c.maxReadMessageId,g)<0)&&(y.Int64.compare(d,g)<0&&(d=g),v.Int64Helper.contains(a.messageIdsExcludingUnreadCountTargets,g)||c.unreadCount--)}return(null==c.maxReadMessageId||y.Int64.compare(c.maxReadMessageId,d)<0)&&(c.maxReadMessageId=d,this.dataStore.setTalkStatus(c)),c},newAnnouncementStatus:function(a){var b=this.dataStore.getAnnouncementStatus(a.domainId);return null==b&&(b=new v.entity.AnnouncementStatus,b.domainId=a.domainId),(null==b.maxAnnouncementId||y.Int64.compare(b.maxAnnouncementId,a.id)<0)&&(b.maxAnnouncementId=a.id),null==b.unreadCount&&(b.unreadCount=0),b.unreadCount++,this.dataStore.setAnnouncementStatus(b),b},__class__:v.proxy.AlberoBroadcastProxy}),v.proxy.AlberoServiceProxy=function(){this.mockMsgId=new y.Int64(-1,-1),u.patterns.proxy.Proxy.call(this,"api"),this.updateReadStatusesTimers=new y.ds.StringMap,this.updateReadAnnouncementStatusesTimers=new y.ds.StringMap},e["albero.proxy.AlberoServiceProxy"]=v.proxy.AlberoServiceProxy,v.proxy.AlberoServiceProxy.__name__=["albero","proxy","AlberoServiceProxy"],v.proxy.AlberoServiceProxy.__super__=u.patterns.proxy.Proxy,v.proxy.AlberoServiceProxy.prototype=b(u.patterns.proxy.Proxy.prototype,{createAccessToken:function(a,b){var c=this,d="pc";d="bot";var e="";this.rpc.call("create_access_token",[a,b,e,d,""],function(a){c.settings.setAccessToken(a),c.createSession(a)},function(){c.sendNotification("Url",v.command.UrlAction.FORWARD(v.Urls.error))})},createSession:function(a){var b=this;this.rpc.call("create_session",[a,"1.35"],function(a){b.dataStore.setMe(new v.entity.Me(a.user)),b.settings.setConfiguration(new v.entity.Configuration(a.configuration));var c=function(){b.dataRecoverd=!0;var c=a.configuration.bot_expired_version;if(w.DEBUG&&null!=console&&console.log(w.dateStr(),"bot_expired_version",c,"","",""),null!=c){var d=z.Node.require("../../package.json").version;if(w.DEBUG&&null!=console&&console.log(w.dateStr(),"current",d,"","",""),null!=d){var e=c.split("."),f=d.split(".");3==e.length&&3==f.length&&1e4*(o.parseFloat(e[0])-o.parseFloat(f[0]))+100*(o.parseFloat(e[1])-o.parseFloat(f[1]))+(o.parseFloat(e[2])-o.parseFloat(f[2]))>=0&&z.Node.process.stderr.write("-----------------------------------------\nCurrent version is expired! (current: "+d+")\nRun 'npm update hubot' to update\n-----------------------------------------\n")}}b.sendNotification("data_recovered"),b.rpc.call("start_notification",[],function(a){var b=a;b||(null!=console&&console.error(w.dateStr(),"start_notification failed.","","","",""),z.Node.process.exit(1))})};return b.dataRecoverd?void c():void b.recoverData(c)},function(){b.settings.clearAccessToken(),b.sendNotification("Url",v.command.UrlAction.FORWARD(v.Urls.error))})},recoverData:function(a){var b=this;this.rpc.call("reset_notification",[],function(){var c=0,d=function(){c++,4==c&&b.getAllUserEmails(a)};b.getDomains(function(){var a=b.dataStore.getDomains(),c=0,e=function(){c++,c==a.length&&d()};if(a.length>0)for(var f=0;f<a.length;){var g=a[f];++f,b.getAnnouncementStatuses(g.id,e)}else d();var h=0,i=function(){h++,2==h&&(b.getTalks(d),b.getTalkInvites(d))};b.getFriends(i),b.getAcquaintances(i)}),b.getDomainInvites(d)})},deleteSession:function(){this.settings.clearSelectedStampTabId(),this.settings.clearDomainSelection(),this.settings.clearAccessToken(),this.rpc.restart()},updateUser:function(a,b,c,d){var e=this,f=function(b){e.rpc.call("update_user",[a,b,d],function(a){e.sendNotification("update_user_responsed",new v.entity.Me(a))})};null!=c?f(c):null!=b?this.uploadFile(b,null,v.proxy._AlberoServiceProxy.UploadUseType.PROFILE_IMAGE,function(a){f(a.get_url)}):f()},updateProfile:function(a){for(var b=this,c=new Array,d=0;d<a.length;){var e=a[d];++d;var f=new Array;f.push(e.domainId);for(var g=new Array,h=0,i=e.profileItemValues;h<i.length;){var j=i[h];++h,g.push({profile_item_id:j.profileItemId,value:j.value})}f.push(g),c.push(f)}this.rpc.call("update_profile",[c],function(a){b.sendNotification("update_profile_responsed",a)})},addFriend:function(a){var b=this.settings.getSelectedDomainId();this.rpc.call("add_friend",[b,a.id])},deleteFriend:function(a){var b=this.settings.getSelectedDomainId();this.rpc.call("delete_friend",[b,a.id])},getFriends:function(a){var b=this;this.rpc.call("get_friends",[],function(c){for(var d=0;d<c.length;){var e=c[d];++d;for(var f=e[1],g=0;g<f.length;){var h=f[g];++g;var i=new v.entity.DomainUser(h);b.dataStore.addFriend(i),b.sendNotification("notify_add_friend",i)}}null!=a&&a()})},getAcquaintances:function(a){var b=this;this.rpc.call("get_acquaintances",[],function(c){for(var d=0;d<c.length;){var e=c[d];++d;for(var f=e[1],g=0;g<f.length;){var h=f[g];++g;var i=new v.entity.DomainUser(h);b.dataStore.addAcquaintance(i),b.sendNotification("notify_add_acquaintance",i)}}null!=a&&a()})},getAllUsers:function(a){var b=this,c=this.settings.getSelectedDomainId(),d=40,e=14;this.rpc.call("get_domain_users",[c,e,d,a],function(a){var d,e=new Array,f=0;for(d=z.Boot.__cast(a.contents,Array);f<d.length;){var g=d[f];++f,e.push(new v.entity.DomainUser(g))}b.dataStore.setUsersIfLatest(c,e),b.sendNotification("get_domain_users_responsed",[c,a.marker,a.next_marker,e])})},getUsers:function(a,b){var c=this;this.rpc.call("get_users",[a,b],function(b){var d,e=new Array,f=0;for(d=z.Boot.__cast(b,Array);f<d.length;){var g=d[f];++f,e.push(new v.entity.DomainUser(g))}c.dataStore.setUsersIfLatest(a,e),c.sendNotification("get_users_responsed",[a,e])})},getProfile:function(a,b){var c=this;this.rpc.call("get_profile",[a,b],function(a){var b=new v.entity.Profile(a);c.sendNotification("get_profile_responsed",b)})},searchDomainUsers:function(a,b){var c=this,d=this.settings.getSelectedDomainId(),e=40,f=14;this.rpc.call("search_domain_users",[d,a,f,e,b],function(b){var e,f=new Array,g=0;for(e=z.Boot.__cast(b.contents,Array);g<e.length;){var h=e[g];++g,f.push(new v.entity.DomainUser(h))}c.dataStore.setUsersIfLatest(d,f),c.sendNotification("get_domain_users_responsed",[d,b.marker,b.next_marker,f,a])})},getUserEmails:function(a,b,c){var d=this;this.rpc.call("get_user_emails",[a,b],function(e){for(var f=0,g=b.length;g>f;){var h=f++,i=d.dataStore.getUser(a,b[h]);null!=i&&(i.email=e[h])}null!=c&&c()})},getAllUserEmails:function(a){for(var b=this,c=null,d=0,e=this.dataStore.getUsers();d<e.length;){var f=e[d];if(++d,null==f.email){var g=v.Int64Helper.idStr(f.domainId);null==c&&(c=new y.ds.StringMap);var h=c.get(g);null==h&&(h=new Array,c.set(g,h)),h.push(f.id)}}if(null==c)a();else{var i=c.keys(),j=null;j=function(){if(i.hasNext()){var d=i.next();b.getUserEmails(v.Int64Helper.makeFromIdStr(d),c.get(d),j)}else a()},j()}},getDomains:function(a){var b=this,c=function(a){a.reverse();for(var c=0;c<a.length;){var d=a[c];++c,b.sendNotification("notify_update_domain",[null,d])}};this.rpc.call("get_domains",[],function(d){for(var e=0;e<d.length;){var f=d[e];++e,b.newDomain(f)}c(b.dataStore.getDomains()),null!=a&&a()})},leaveDomain:function(a){var b=this;this.rpc.call("leave_domain",[a.id],function(a){b.dataStore.removeDomain(a)})},getDomainInvites:function(a){var b=this;this.rpc.call("get_domain_invites",[],function(c){for(var d=0;d<c.length;){var e=c[d];++d,b.sendNotification("notify_add_domain_invite",b.newDomainInvite(e))}null!=a&&a()})},acceptDomainInvite:function(a){this.rpc.call("accept_domain_invite",[a],function(){})},deleteDomainInvite:function(a){this.rpc.call("delete_domain_invite",[a],function(){})},getTalks:function(a){var b=this,c=function(a){var c;c=a.type==v.entity.TalkType.PairTalk?"notify_create_pair_talk":"notify_create_group_talk",b.sendNotification(c,a)},d=function(a){a.sort(function(a,c){var d,e=b.dataStore.getTalkStatus(a.id);d=null!=e?e.maxMessage:null;var f;f=null!=d?d.createdAt:null,(null==f||y.Int64.compare(f,a.updatedAt)<0)&&(f=a.updatedAt);var g,h=b.dataStore.getTalkStatus(c.id);g=null!=h?h.maxMessage:null;var i;return i=null!=g?g.createdAt:null,(null==i||y.Int64.compare(i,c.updatedAt)<0)&&(i=c.updatedAt),y.Int64.compare(f,i)});for(var d=0;d<a.length;){var e=a[d];++d,c(e)}},e=function(a){for(var c=0;c<a.length;){var d=a[c];++c,b.sendNotification("notify_update_local_talk_status",d)}};this.rpc.call("get_talks",[],function(c){for(var f=0;f<c.length;){var g=c[f];++f,b.newTalk(g)}b.rpc.call("get_talk_statuses",[],function(c){for(var f=0;f<c.length;){var g=c[f];++f,b.newTalkStatus(g)}d(b.dataStore.getTalks()),e(b.dataStore.getTalkStatuses()),null!=a&&a()})})},getTalkStatuses:function(){var a=this,b=function(b){var c=a.dataStore.getTalk(b.id);null!=c&&a.sendNotification("notify_update_local_talk_status",b)};this.rpc.call("get_talk_statuses",[],function(c){for(var d=0;d<c.length;){var e=c[d];++d,b(a.newTalkStatus(e))}})},getReadStatus:function(a,b){var c=this;this.rpc.call("get_read_status",[a,b],function(a){c.sendNotification("notify_get_message_status",new v.entity.MessageReadStatus(a))})},createTalk:function(a){var b=this,c=this.settings.getSelectedDomainId();if(0!=a.length){var d,e=1==a.length;d=e?"create_pair_talk":"create_group_talk";var f;f=e?[c,a.pop()]:[c,a],this.rpc.call(d,f,function(a){var c,d=b.newTalk(a);c=e?"notify_create_pair_talk":"notify_create_group_talk",b.sendNotification(c,d),b.settings.setSelectedTalk(d)})}},updateGroupTalk:function(a,b,c,d){var e=this;if(a.type==v.entity.TalkType.GroupTalk){var f=function(c){e.rpc.call("update_group_talk",[a.id,b,c],function(a){e.sendNotification("notify_update_group_talk",e.newTalk(a))})};null!=d?f(d):null!=c?this.uploadFile(c,a.domainId,v.proxy._AlberoServiceProxy.UploadUseType.TALK_ICON,function(a){f(a.get_url)}):f()}},addTalkers:function(a,b){var c=this;if(a.type==v.entity.TalkType.PairTalk){var d=a.userIds.concat(b);return v.Int64Helper.remove(d,this.dataStore.me.id),void this.createTalk(d)}0!=b.length&&this.rpc.call("add_talkers",[a.id,b],function(a){c.sendNotification("notify_add_talkers",c.newTalk(a))})},deleteTalker:function(a,b){var c=this;this.rpc.call("delete_talker",[a.id,b],function(){v.Int64Helper.remove(a.userIds,b),c.sendNotification("notify_delete_talker",c.dataStore.setTalk(a))})},inviteTalker:function(a,b){this.rpc.call("add_talk_invite",[a.id,b],function(){})},getTalkInvites:function(a){var b=this;this.rpc.call("get_talk_invites",[],function(c){for(var d=0;d<c.length;){var e=c[d];++d,b.acceptTalkInvite(e.talk_id)}null!=a&&a()})},acceptTalkInvite:function(a){this.rpc.call("accept_talk_invite",[a],function(){})},deleteTalkInvite:function(a){this.rpc.call("delete_talk_invite",[a],function(){})},getMessages:function(a,b){var c=this,d=20;null==b&&(b={sinceId:null,maxId:null}),this.rpc.call("get_messages",[a.id,d,b.sinceId,b.maxId],function(b){for(var d=new Array,e=0;e<b.length;){var f=b[e];++e,d.push(c.newMessage(f))}c.sendNotification("notify_get_messages",{talkId:a.id,messages:d})})},createMessage:function(a,b,c,d){var e=this,f=this.newDummyMessage(a,b,c);this.sendNotification("create_message_start",f),this.rpc.call("create_message",[a,v.entity.Message.enumIndex(b),c],function(a){e.sendNotification("create_message_complete",[e.newMessage(a),f.id],d)},function(a){e.sendNotification("create_message_fail",f),e.sendNotification("error_occurred",a)})},updateReadStatuses:function(a,b){var c=this,d=this.dataStore.getTalkStatus(a);if(null!=d){if(null==b){if(0==d.unreadCount)return;b=d.maxMessageId}else if(null!=d.maxReadMessageId&&y.Int64.compare(d.maxReadMessageId,b)>=0)return;d.unreadCount=0,d.maxReadMessageId=b,this.dataStore.setTalkStatus(d),this.sendNotification("notify_update_local_talk_status",d);var e="_"+a.high+"_"+a.low,f=this.updateReadStatusesTimers.get(e);null!=f&&f.stop(),f=y.Timer.delay(function(){c.updateReadStatusesTimers.remove(e);var d=c.dataStore.getTalkStatus(a);null!=d&&c.rpc.call("update_read_statuses",[a,b],function(){})},1e3),this.updateReadStatusesTimers.set(e,f)}},upload:function(a,b,c,d){var e=this,f=c.name.normalize("NFKC"),g={content_type:c.type,content_size:c.size,name:f,file:c},h=this.newDummyMessage(b,v.entity.MessageType.file,g);this.uploadThumbnail(c,a,b,h,function(g){e.uploadFile(c,a,v.proxy._AlberoServiceProxy.UploadUseType.MESSAGE,function(a){var i={url:a.get_url,content_type:c.type,content_size:c.size,name:f,file_id:a.file_id};null!=g&&(i.thumbnail_url=g.get_url),e.rpc.call("create_message",[b,v.entity.Message.enumIndex(v.entity.MessageType.file),i],function(a){e.sendNotification("create_message_complete",[e.newMessage(a),h.id],d)},function(a){e.sendNotification("create_message_fail",h),e.sendNotification("error_occurred",a)})})})},uploadThumbnail:function(a,b,c,d,e){var f=this;this.fileService.createThumbnail(a,function(a){d.content.thumbnail_file=a,f.sendNotification("create_message_start",d),null!=a?f.uploadFile(a,b,v.proxy._AlberoServiceProxy.UploadUseType.THUMBNAIL,e):e(null)})},uploadFile:function(a,b,c,d){var e,f=this;switch(c[1]){case 0:e=0;break;case 1:e=1;break;case 2:e=2;break;case 3:e=4}var g=a.name.normalize("NFKC");this.rpc.call("create_upload_auth",[g,a.type,a.size,b,e],function(b){f.fileService.upload(b,a.type,a,function(){d(b)})})},deleteAttachment:function(a,b){this.rpc.call("delete_attachment",[a,b])},getAttachments:function(a,b){var c=this,d=20;null==b&&(b={sinceId:null,maxId:null}),this.rpc.call("get_attachments",[a.id,d,b.sinceId,b.maxId],function(b){for(var d=new Array,e=0;e<b.length;){var f=b[e];++e,d.push(c.newFileInfo(f))}c.sendNotification("get_file_responsed",{talkId:a.id,files:d})})},createAnnouncement:function(a,b,c,d){var e=this;(null!=a||(a=this.settings.getSelectedDomainId(),null!=a))&&this.rpc.call("create_announcement",[a,v.entity.Message.enumIndex(b),c],function(a){e.sendNotification("notify_create_announcement",e.newAnnouncement(a),d)})},getAnnouncements:function(a,b){var c=this,d=20,e=this.settings.getSelectedDomainId();return null==e?void(null!=b&&b()):(null==a&&(a={sinceId:null,maxId:null}),void this.rpc.call("get_announcements",[e,d,a.sinceId,a.maxId],function(a){for(var b=new Array,d=0;d<a.length;){var f=a[d];++d,b.push(new v.entity.Announcement(f))}c.sendNotification("notify_get_announcements",{domainId:e,announcements:b})}))},getAnnouncementStatuses:function(a,b){var c=this;this.rpc.call("get_announcement_status",[a],function(a){c.sendNotification("notify_update_announcement_status",c.newAnnouncementStatus(a)),null!=b&&b()})},updateAnnouncementReadStatus:function(a){var b=this,c=this.dataStore.getAnnouncementStatus(a);if(null!=c&&0!=c.unreadCount){c.unreadCount=0,c.maxReadAnnouncementId=c.maxAnnouncementId,this.dataStore.setAnnouncementStatus(c),this.sendNotification("notify_update_announcement_status",c);var d="_"+a.high+"_"+a.low,e=this.updateReadAnnouncementStatusesTimers.get(d);null!=e&&e.stop(),e=y.Timer.delay(function(){b.updateReadAnnouncementStatusesTimers.remove(d),b.rpc.call("update_announcement_status",[a,c.maxAnnouncementId],function(){})},1e3),this.updateReadAnnouncementStatusesTimers.set(d,e)}},getQuestions:function(a,b,c,d){var e=this,f=20,g=this.settings.getSelectedDomainId(),h=null;null!=a&&(g=a.domainId,h=a.id);var i;switch(b[1]){case 0:i=0;break;case 1:i=1}var j;switch(c[1]){case 0:j=!0;break;case 1:j=!1;break;case 2:j=null}null==d&&(d={sinceId:null,maxId:null}),this.rpc.call("get_actions",[g,h,i,j,f,d.sinceId,d.maxId],function(a){for(var d=new Array,f=0;f<a.length;){var i=a[f];++f,d.push(e.newQuestion(i))}e.sendNotification("get_questions_responsed",{domainId:g,talkId:h,questions:d,fromType:b,filter:c})})},getQuestion:function(a,b){var c=this;this.rpc.call("get_action",[a],function(a){c.sendNotification("notify_update_question",c.newQuestion(a)),null!=b&&b()})},newDomain:function(a){return this.dataStore.setDomain(new v.entity.Domain(a))},newDomainInvite:function(a){return this.dataStore.setDomainInvite(new v.entity.DomainInvite(a))},newTalk:function(a){return this.dataStore.setTalk(new v.entity.Talk(a))},newTalkStatus:function(a){return this.dataStore.setTalkStatus(new v.entity.TalkStatus(a))},newMessage:function(a){return new v.entity.Message(a)},newDummyMessage:function(a,b,c){var d=new v.entity.Message;return d.id=this.mockMsgId,d.userId=this.dataStore.me.id,d.talkId=a,d.type=b,d.content=c,this.mockMsgId=v.Int64Helper.decrement(this.mockMsgId),d},newQuestion:function(a){return this.dataStore.setQuestion(new v.entity.Question(a))},newFileInfo:function(a){return new v.entity.FileInfo(a)},newAnnouncement:function(a){return new v.entity.Announcement(a)},newAnnouncementStatus:function(a){return this.dataStore.setAnnouncementStatus(new v.entity.AnnouncementStatus(a))},createdAtNow:function(){var a=(new Date).getTime(),b=4294967296;return new y.Int64(a/b|0,a%b|0)},__class__:v.proxy.AlberoServiceProxy}),v.proxy._AlberoServiceProxy={},v.proxy._AlberoServiceProxy.UploadUseType={__ename__:!0,__constructs__:["PROFILE_IMAGE","MESSAGE","TALK_ICON","THUMBNAIL"]},v.proxy._AlberoServiceProxy.UploadUseType.PROFILE_IMAGE=["PROFILE_IMAGE",0],v.proxy._AlberoServiceProxy.UploadUseType.PROFILE_IMAGE.toString=f,v.proxy._AlberoServiceProxy.UploadUseType.PROFILE_IMAGE.__enum__=v.proxy._AlberoServiceProxy.UploadUseType,v.proxy._AlberoServiceProxy.UploadUseType.MESSAGE=["MESSAGE",1],v.proxy._AlberoServiceProxy.UploadUseType.MESSAGE.toString=f,v.proxy._AlberoServiceProxy.UploadUseType.MESSAGE.__enum__=v.proxy._AlberoServiceProxy.UploadUseType,v.proxy._AlberoServiceProxy.UploadUseType.TALK_ICON=["TALK_ICON",2],v.proxy._AlberoServiceProxy.UploadUseType.TALK_ICON.toString=f,v.proxy._AlberoServiceProxy.UploadUseType.TALK_ICON.__enum__=v.proxy._AlberoServiceProxy.UploadUseType,v.proxy._AlberoServiceProxy.UploadUseType.THUMBNAIL=["THUMBNAIL",3],v.proxy._AlberoServiceProxy.UploadUseType.THUMBNAIL.toString=f,v.proxy._AlberoServiceProxy.UploadUseType.THUMBNAIL.__enum__=v.proxy._AlberoServiceProxy.UploadUseType,v.proxy.AppStateProxy=function(){u.patterns.proxy.Proxy.call(this,"appState")},e["albero.proxy.AppStateProxy"]=v.proxy.AppStateProxy,v.proxy.AppStateProxy.__name__=["albero","proxy","AppStateProxy"],v.proxy.AppStateProxy.__super__=u.patterns.proxy.Proxy,v.proxy.AppStateProxy.prototype=b(u.patterns.proxy.Proxy.prototype,{start:function(){this.updateLastActivityAt(),this.checkInactiveInterval()},setAppState:function(a){"APP_STATE_CHANGED: "+o.string(a);this.appState=a,this.sendNotification("app_state_changed",this.appState)},updateLastActivityAt:function(){this.lastActivityAt=new Date},checkInactiveInterval:function(){var a=this;this.checkInactive(),y.Timer.delay(function(){a.checkInactiveInterval()},500)},checkInactive:function(){if(this.appState!=v.AppState.Inactive){var a=(new Date).getTime()-this.lastActivityAt.getTime();2e3>a||this.setAppState(v.AppState.Inactive)}},__class__:v.proxy.AppStateProxy}),v.proxy.DataStoreProxy=function(){u.patterns.proxy.Proxy.call(this,"dataStore"),this.clear()},e["albero.proxy.DataStoreProxy"]=v.proxy.DataStoreProxy,v.proxy.DataStoreProxy.__name__=["albero","proxy","DataStoreProxy"],v.proxy.DataStoreProxy.__super__=u.patterns.proxy.Proxy,v.proxy.DataStoreProxy.prototype=b(u.patterns.proxy.Proxy.prototype,{setMe:function(a){this.me=a;for(var b=0,c=this.getDomains();b<c.length;){var d=c[b];++b,this.sendNotification("notify_update_user",this.me.toDomainUser(d.id))}this.sendNotification("current_user_changed",a)},getMe:function(){return this.me},isMe:function(a){return null!=this.me&&v.Int64Helper.eq(this.me.id,a)},getFriends:function(a){var b=this.users.get("_"+a.high+"_"+a.low),c=[];if(null!=b)for(var d=b.iterator();d.hasNext();){var e=d.next();0==e.type&&c.push(e.user)}return c},isFriend:function(a,b){var c=this.users.get("_"+a.high+"_"+a.low);if(null!=c){var d=c.get("_"+b.high+"_"+b.low);return null!=d&&0==d.type}return!1},addFriend:function(a){var b=this.ensureDomainUserMap(a.domainId),c=v.Int64Helper.idStr(a.id);return b.set(c,{type:0,user:a}),a},addAcquaintance:function(a){var b=this.ensureDomainUserMap(a.domainId),c=v.Int64Helper.idStr(a.id);return b.set(c,{type:1,user:a}),a},ensureDomainUserMap:function(a){var b="_"+a.high+"_"+a.low,c=this.users.get(b);return null==c&&(c=new y.ds.StringMap,this.users.set(b,c)),c},setUserIfLatest:function(a,b){if(null==a){var c=v.Int64Helper.idStr(b.domainId);if(a=this.users.get(c),null==a)return}var d,e=v.Int64Helper.idStr(b.id);if(d=a.get(e),null!=d)(2==d.type||y.Int64.compare(b.updatedAt,d.user.updatedAt)>1)&&(d.user=b,this.sendNotification("notify_update_user",b));else{var f=v.Int64Helper.idStr(b.id);a.set(f,{type:2,user:b})}},setUsersIfLatest:function(a,b){var c=this.users.get("_"+a.high+"_"+a.low);if(null!=c)for(var d=0;d<b.length;){var e=b[d];++d,this.setUserIfLatest(c,e)}},removeFriend:function(a,b){var c=this.users.get("_"+a.high+"_"+a.low);if(null!=c){var d=c.get("_"+b.high+"_"+b.low);d.type=2}},removeAcquaintance:function(a,b){this.removeFriend(a,b)},getUser:function(a,b){if(0==(b.high|b.low))return null;if(v.Int64Helper.eq(this.me.id,b))return this.me.toDomainUser(a);var c=this.users.get("_"+a.high+"_"+a.low);if(null!=c){var d=c.get("_"+b.high+"_"+b.low);if(null!=d)return d.user}return null},getUsers:function(a,b){var c=this,d=function(a,b){var d=c.users.get("_"+a.high+"_"+a.low);if(null!=d){if(null!=b)return b.map(function(b){if(0==(b.high|b.low))return null;if(v.Int64Helper.eq(c.me.id,b))return c.me.toDomainUser(a);var e=d.get("_"+b.high+"_"+b.low);return null!=e?e.user:null});for(var e=new Array,f=d.iterator();f.hasNext();)e.push(f.next().user);return e}return new Array};if(null!=a)return d(a,b);for(var e=this.domains.iterator(),f=null;e.hasNext();)f=null==f?d(e.next().id,b):f.concat(d(e.next().id,b));return f},getTalk:function(a){return this.talks.get("_"+a.high+"_"+a.low)},setTalk:function(a){var b=v.Int64Helper.idStr(a.id);if(this.talks.set(b,a),null!=a.leftUsers)for(var c=this.ensureDomainUserMap(a.domainId),d=0,e=a.leftUsers;d<e.length;){var f=e[d];++d;var g=v.Int64Helper.idStr(f.id),h=c.get(g);null!=h?2==h.type&&y.Int64.compare(f.updatedAt,h.user.updatedAt)>0&&(h.user=f,this.sendNotification("notify_update_user",f)):(c.set(g,{type:2,user:f}),this.sendNotification("notify_update_user",f))}return a},getTalks:function(){for(var a=new Array,b=this.talks.keys();b.hasNext();){var c=b.next();a.push(this.talks.get(c))}return a},setTalks:function(a){for(var b=0;b<a.length;){var c=a[b];++b,this.setTalk(c)}},removeTalk:function(a){this.talks.remove("_"+a.high+"_"+a.low)},getTalkStatuses:function(){for(var a=new Array,b=this.talkStatuses.keys();b.hasNext();){var c=b.next();this.talks.exists(c)&&a.push(this.talkStatuses.get(c))}return a},getTalkStatus:function(a){return this.talkStatuses.get("_"+a.high+"_"+a.low)},setTalkStatus:function(a){var b=v.Int64Helper.idStr(a.id);if(null!=this.domainUnreadCounts){var c=this.talks.get(b),d=v.Int64Helper.idStr(c.domainId);this.domainUnreadCounts.remove(d)}return this.talkStatuses.set(b,a),this.sendNotification("brand_badge_changed"),a},removeTalkStatus:function(a){this.talkStatuses.remove("_"+a.high+"_"+a.low)},getDomains:function(){for(var a=new Array,b=this.domains.iterator();b.hasNext();){var c=b.next();a.push(c)}return a},getDomain:function(a){return this.domains.get("_"+a.high+"_"+a.low)},setDomain:function(a){var b=v.Int64Helper.idStr(a.id);return this.domains.set(b,a),a},removeDomain:function(a){this.domains.remove("_"+a.high+"_"+a.low)},getUnreadCount:function(){for(var a=0,b=this.domains.keys();b.hasNext();){var c=b.next();a+=this._getDomainUnreadCount(c)}for(var d=this.domainInvites.iterator();d.hasNext();){{d.next()}a++}return a},_getDomainUnreadCount:function(a){if(null!=this.domainUnreadCounts&&this.domainUnreadCounts.exists(a))return this.domainUnreadCounts.get(a);null==this.domainUnreadCounts&&(this.domainUnreadCounts=new y.ds.StringMap);for(var b=0,c=this.talkStatuses.iterator();c.hasNext();){var d=c.next();if(null!=d.unreadCount&&0!=d.unreadCount){var e,f=v.Int64Helper.idStr(d.id);e=this.talks.get(f),null!=e&&v.Int64Helper.idStr(e.domainId)==a&&(b+=d.unreadCount)}}var g=this.announcementStatuses.get(a);return null!=g&&null!=g.unreadCount&&(b+=g.unreadCount),this.domainUnreadCounts.set(a,b),b},getDomainUnreadCount:function(a){return this._getDomainUnreadCount("_"+a.high+"_"+a.low)},getDomainInvites:function(){for(var a=new Array,b=this.domainInvites.keys();b.hasNext();){var c=b.next();a.push(this.domainInvites.get(c))}return a},getDomainInvite:function(a){return this.domainInvites.get("_"+a.high+"_"+a.low)},setDomainInvite:function(a){var b=v.Int64Helper.idStr(a.id);return this.domainInvites.set(b,a),this.sendNotification("brand_badge_changed"),a},removeDomainInvite:function(a){this.domainInvites.remove("_"+a.high+"_"+a.low),this.sendNotification("brand_badge_changed")},getQuestions:function(a,b){var c=[];if(null!=this.questions)for(var d=this.questions.iterator();d.hasNext();){var e=d.next();v.Int64Helper.eq(e.talkId,a)&&v.Int64Helper.eq(e.userId,b)&&c.push(e)}return c},getQuestion:function(a){return this.questions.get("_"+a.high+"_"+a.low)},setQuestion:function(a){var b=v.Int64Helper.idStr(a.id);return this.questions.set(b,a),a},getAnnouncementStatus:function(a){return this.announcementStatuses.get("_"+a.high+"_"+a.low)},setAnnouncementStatus:function(a){var b=v.Int64Helper.idStr(a.domainId);return this.announcementStatuses.set(b,a),null!=this.domainUnreadCounts&&this.domainUnreadCounts.remove(b),this.sendNotification("brand_badge_changed"),a},removeAnnouncementStatus:function(a){var b="_"+a.high+"_"+a.low;this.announcementStatuses.remove(b),null!=this.domainUnreadCounts&&this.domainUnreadCounts.remove(b),this.sendNotification("brand_badge_changed")},clear:function(){this.users=new y.ds.StringMap,this.talks=new y.ds.StringMap,this.talkStatuses=new y.ds.StringMap,this.domains=new y.ds.StringMap,this.domainInvites=new y.ds.StringMap,this.questions=new y.ds.StringMap,this.announcementStatuses=new y.ds.StringMap},__class__:v.proxy.DataStoreProxy}),v.proxy.FileServiceProxy=function(){u.patterns.proxy.Proxy.call(this,"fileService"),this.validHost=this.getValidHost()},e["albero.proxy.FileServiceProxy"]=v.proxy.FileServiceProxy,v.proxy.FileServiceProxy.__name__=["albero","proxy","FileServiceProxy"],v.proxy.FileServiceProxy.__super__=u.patterns.proxy.Proxy,v.proxy.FileServiceProxy.prototype=b(u.patterns.proxy.Proxy.prototype,{getValidHost:function(){return"https://"+C.host},downloadUrl:function(a,b){if(null==b&&(b=!1),null==a||0==a.length)return"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";if(q.startsWith(a,this.validHost)){var c=this.settings.getAccessToken(),d=a;return d+=-1!=a.indexOf("?")?"&":"?",d+="Authorization=ALB%20"+c,b&&(d+="&download=true"),d}return a},download:function(a,b,c){var d=this;if(a=this.downloadUrl(a),q.startsWith(a,"data:"))return void c(null);var e=z.Node.require("https").request(a,function(a){var e=a.headers.location;if(null!=e)return void d.download(e,b,c);if(2!=Math.floor(a.statusCode/100))return void c(null);var f=z.Node.require("fs").createWriteStream(b);a.on("data",function(a){f.write(a)}),a.on("end",function(){f.end(),f.on("finish",function(){c(b)})}),a.on("error",function(){c(null)}),f.on("error",function(){c(null)})});e.on("error",function(){c(null)}),e.end()},upload:function(a,b,c,d){var e=this,f=z.Node.require("url").parse(a.put_url);f.method="PUT",f.headers={},f.headers["Content-Length"]=c.size,f.headers["Content-Type"]=a.post_form["Content-Type"],f.headers["Content-Disposition"]=a.post_form["Content-Disposition"];var g=z.Node.require("https").request(f,function(a){if(2!=Math.floor(a.statusCode/100)){var b="";return a.on("data",function(a){b+=a}),void a.on("end",function(){e.uploadFailed({responseText:a.statusCode+": "+b})})}d()});g.on("error",function(a){e.uploadFailed({responseText:a.message})});var h=z.Node.require("fs").createReadStream(c.path);h.on("data",function(a){g.write(a)}),h.on("end",function(){g.end()}),h.on("error",function(){g.end()})},uploadFailed:function(){this.sendNotification("error_occurred",{message:"ファイルの送信に失敗しました。"})},createDummyFile:function(a){var b=a.split("\\");if(0==b.length)return null;var c=b[b.length-1];if(0==c.length)return null;var d="application/octet-stream",e=c.split(".");if(e.length>1){var f=e[e.length-1];switch(f){case"txt":d="text/plain";break;case"htm":case"html":d="text/html";break;case"xml":d="text/xml";break;case"gif":d="image/gif";break;case"jpg":case"jpeg":d="image/jpeg";break;case"png":d="image/png";break;case"pdf":d="application/pdf"}}return{name:c,size:1,type:d}},createThumbnail:function(a,b){b(q.startsWith(a.type,"video/")?null:null)},createVideoThumbnail:function(a,b){var c=this;w.DEBUG&&null!=console&&console.log(w.dateStr(),"createVideoThumbnail","","","","");var d=window.document.getElementById("thumb-video");d.pause();var e=URL.createObjectURL(a),f=null,g=null,h=function(a){URL.revokeObjectURL(e),d.removeEventListener("playing",f,!1),d.removeEventListener("error",g,!1),b(a)},i=!1;f=function(){w.DEBUG&&null!=console&&console.log(w.dateStr(),"video playing","","","",""),i||(i=!0,y.Timer.delay(function(){c.captureVideo(d,function(a){d.pause(),h(a)})},100))},d.addEventListener("playing",f,!1),g=function(a){w.DEBUG&&null!=console&&console.log(w.dateStr(),"video error",a,"","",""),h(null)},d.addEventListener("error",g,!1),d.src=e},captureVideo:function(a,b){var c=a.width,d=a.height,e=a.videoWidth,f=a.videoHeight;f>e?(f*=c/e,e=c):(e*=d/f,f=d);var g=(c-e)/2,h=(d-f)/2,i=window.document.getElementById("thumb-canvas");i.getContext("2d").drawImage(a,g,h,e,f),i.toBlob(function(a){w.DEBUG&&null!=console&&console.log(w.dateStr(),"captureVideo blob callback","","","","");
var c={name:"thumb.jpeg",type:"image/jpeg",file:"thumb.jpeg",blob:a,size:a.size};b(c)})},__class__:v.proxy.FileServiceProxy}),v.proxy.FormatterProxy=function(){u.patterns.proxy.Proxy.call(this,"formatter"),v.proxy._FormatterProxy.ExternalUserIconListener.formatterProxy=this},e["albero.proxy.FormatterProxy"]=v.proxy.FormatterProxy,v.proxy.FormatterProxy.__name__=["albero","proxy","FormatterProxy"],v.proxy.FormatterProxy.__super__=u.patterns.proxy.Proxy,v.proxy.FormatterProxy.prototype=b(u.patterns.proxy.Proxy.prototype,{dayOfWeekString:function(a){var b=a.getDay();switch(b){case 0:return"日";case 1:return"月";case 2:return"火";case 3:return"水";case 4:return"木";case 5:return"金";default:return"土"}},dateString:function(a,b){var c=new Date,d="";return a.getFullYear()!=c.getFullYear()&&(d+=a.getFullYear()+"/"),d+=a.getMonth()+1+"/"+a.getDate(),b&&(d+=" ("+this.dayOfWeekString(a)+")"),d},abbreviateDatetimeString:function(a){if(null==a)return"";var b,c=new Date,d=v.Int64Helper.toFloat(a),e=new Date;e.setTime(d),b=e;var f="";return f=c.getFullYear()==b.getFullYear()&&c.getMonth()==b.getMonth()&&c.getDate()==b.getDate()?b.getHours()+":"+(b.getMinutes()<10?"0":"")+b.getMinutes():this.dateString(b,!1)},timeString:function(a){if(null==a)return"";var b,c=v.Int64Helper.toFloat(a),d=new Date;return d.setTime(c),b=d,b.getHours()+":"+(b.getMinutes()<10?"0":"")+b.getMinutes()},datetimeString:function(a){if(null==a)return"";var b,c=o.parseFloat(o.string(a)),d=new Date;return d.setTime(c),b=d,b.getFullYear()+"/"+(b.getMonth()+1)+"/"+b.getDate()+" "+b.getHours()+":"+(b.getMinutes()<10?"0":"")+b.getMinutes()},messageString:function(a,b){var c;c=b.type==v.entity.MessageType.system?null:this.dataStore.getUser(a,b.userId);var d;d=null!=c?c.displayName:"";var e=b.type;switch(e[1]){case 0:return this.systemMessageString(a,b.content);case 1:return d+":"+o.string(b.content);case 2:return d+":スタンプを送信しました。";case 5:case 7:return d+":[質問] "+o.string(b.content.question);case 6:case 8:return d+":質問に回答しました";case 9:return d+":[タスク] "+o.string(b.content.title);case 10:return d+":[タスク完了] "+o.string(b.content.title);case 11:case 12:case 13:return d+"が回答を締め切りました。";default:return d+"がメッセージを送信しました。"}},announcementString:function(a){var b,c=this.dataStore.getUser(a.domainId,a.userId);b=null!=c?c.displayName:a.userName,null==b&&(b="");var d=a.type;switch(d[1]){case 1:return b+":"+o.string(a.content);default:return null!=console&&console.error(w.dateStr(),"announcement.type is not text. announcment:%o",a,"","",""),b+"がメッセージを送信しました。"}},systemMessageString:function(a,b){var c=b.type;switch(c){case"add_talkers":for(var d="",e=b.added_user_ids,f=0;f<e.length;){var g=e[f];++f;var h=this.dataStore.getUser(a,g);null!=h&&(""!=d&&(d+="と"),d+=h.displayName)}var i=null;if(null!=b.added_by){var j=this.dataStore.getUser(a,b.added_by);null!=j&&(i=j.displayName)}return null==i?d+"を追加しました":i+"が"+d+"を追加しました";case"delete_talker":var k="",l=this.dataStore.getUser(a,b.deleted_user_id);return null!=l&&(k+=l.displayName),k+"が退出しました。関連するアクションは締め切られました。";case"add_talk_invite":var m=b.email;return m+"が招待されました";case"delete_talk_invite":var n=b.email;return n+"の招待が取り消されました";case"hide_pair_talk":var o="",p=this.dataStore.getUser(a,b.user_id);return null!=p&&(o+=p.displayName),o+"はメッセージ履歴を削除しました。相手にこれ以前のメッセージは表示されません。関連するアクションは締め切られました。";default:return""}},createText:function(a){if(null==a)return null;var b=this.emoji(this.linking(a));return q.endsWith(b,"\n")&&(b+="\n"),b},emoji:function(a){var b=new h("\\{p:(\\d+)\\}","g"),c=b.replace(a,"<img class='emoji' src='images/emoji/$1.gif'>");return c},linking:function(a){return twttr.txt.autoLinkUrlsCustom(a,{targetBlank:!0,htmlEscapeNonEntities:!0})},__class__:v.proxy.FormatterProxy}),v.proxy._FormatterProxy={},v.proxy._FormatterProxy.ExternalUserIconListener=a.albero.ExternalUserIconListener=function(){},e["albero.proxy._FormatterProxy.ExternalUserIconListener"]=v.proxy._FormatterProxy.ExternalUserIconListener,v.proxy._FormatterProxy.ExternalUserIconListener.__name__=["albero","proxy","_FormatterProxy","ExternalUserIconListener"],v.proxy.MsgPackRpcProxy=function(){this.connectionStatus=v.ConnectionStatus.Ok,u.patterns.proxy.Proxy.call(this,"rpc"),this.responseHandlers=new y.ds.IntMap,this.errorHandler=d(this,this.onServerError),this.connectionKeeper=new v.proxy._MsgPackRpcProxy.ConnectionKeeper(d(this,this.ping))},e["albero.proxy.MsgPackRpcProxy"]=v.proxy.MsgPackRpcProxy,v.proxy.MsgPackRpcProxy.__name__=["albero","proxy","MsgPackRpcProxy"],v.proxy.MsgPackRpcProxy.__super__=u.patterns.proxy.Proxy,v.proxy.MsgPackRpcProxy.prototype=b(u.patterns.proxy.Proxy.prototype,{initWebSocket:function(){null==this.ws&&(this.ws=new v.js.WebSocket(C.endpoint),this.ws.onopen=d(this,this.onOpen),this.ws.onmessage=d(this,this.onMessage),this.ws.onclose=d(this,this.onClose))},finishWebSocket:function(){null!=this.ws&&(this.ws.onopen=null,this.ws.onmessage=null,this.ws.onerror=null,this.ws.onclose=null,this.ws.close(),this.ws=null)},onRegister:function(){this.initWebSocket(),this.connectionKeeper.start()},onRemove:function(){this.connectionKeeper.stop(),this.finishWebSocket()},onOpen:function(){this.connectionKeeper.setConnected(!0),this.sendNotification("SignIn")},onMessage:function(a){var b,c=this,d=new A.Decoder(a,!0).getResult();if(b=z.Boot.__cast(d[0],E),1==b&&4==d.length){var e;e=z.Boot.__cast(d[1],E);var f=d[2],g=d[3],h=this.responseHandlers.get(e);if(null==h)return void(null!=console&&console.error(w.dateStr(),"No ResponseHandler prepared. msgId:%s error:%s result:",e,f,g,""));if(null==f){var i=h.onSuccess;null!=i&&i(g)}else{null!=console&&console.error(w.dateStr(),"Receive Error Response. method:",h.method," error:",f,"");var j=h.onError;null!=j?j(f):null!=this.errorHandler&&this.errorHandler(h.method,f)}this.responseHandlers.remove(e)}else if(0==b&&4==d.length){var k;k=z.Boot.__cast(d[1],E);var l;l=z.Boot.__cast(d[2],String);var m;m=z.Boot.__cast(d[3],Array);for(var n=0;n<m.length;){var o=m[n];++n,this.broadcast.handleNotification(l,o,function(){c.ws.send(new A.Encoder([1,k,null,!0]).getBytes())})}}},onClose:function(a,b,c){null!=console&&console.info(w.dateStr(),"onClose. code:"+a+", reason:"+b+", wasClean:"+(null==c?"null":""+c),"","","",""),1001==a&&c||(this.connectionStatus=1e3!=a&&1005!=a||"concurrent access"!=b?1e3!=a&&1005!=a||"forcibly closed"!=b?v.ConnectionStatus.Error:v.ConnectionStatus.ForcibliyClosedError:v.ConnectionStatus.ConcurrentAccessError,this.connectionStatus==v.ConnectionStatus.ForcibliyClosedError?this.sendNotification("SignOut"):this.sendNotification("Url",v.command.UrlAction.FORWARD(v.Urls.error))),this.finishWebSocket(),this.connectionKeeper.setConnected(!1)},restart:function(){var a=this;this.finishWebSocket();for(var b=this.responseHandlers.keys();b.hasNext();){var c=b.next();this.responseHandlers.remove(c)}y.Timer.delay(function(){a.initWebSocket()},500)},call:function(a,b,c,d){if(null==this.ws)return void(null!=console&&console.error(w.dateStr(),"disconnected. data:",this.data,"","",""));null==b&&(b=[]);var e=v.proxy.MsgPackRpcProxy.lastMsgId++,f=new v.proxy._MsgPackRpcProxy.ResponseHandler(a,c,d);this.responseHandlers.set(e,f);var g=[0,e,a,b],h=new A.Encoder(g).getBytes();this.ws.send(h)},ping:function(){var a=this.connectionStatus;switch(a[1]){case 2:case 3:return}null==this.ws||this.ws.isClosed()?this.restart():this.ws.send(y.io.Bytes.alloc(0))},onServerError:function(a,b){this.sendNotification("error_occurred",b)},__class__:v.proxy.MsgPackRpcProxy}),v.proxy._MsgPackRpcProxy={},v.proxy._MsgPackRpcProxy.ConnectionKeeper=function(a){this.connected=!1,this.ping=a},e["albero.proxy._MsgPackRpcProxy.ConnectionKeeper"]=v.proxy._MsgPackRpcProxy.ConnectionKeeper,v.proxy._MsgPackRpcProxy.ConnectionKeeper.__name__=["albero","proxy","_MsgPackRpcProxy","ConnectionKeeper"],v.proxy._MsgPackRpcProxy.ConnectionKeeper.prototype={start:function(){},stop:function(){this.deleteTimer()},setConnected:function(a){(this.connected!=a||null==this.timer)&&(this.connected=a,this.resetTimer())},resetTimer:function(){var a=this;if(this.deleteTimer(),this.connected)this.timer=new y.Timer(45e3),this.timer.run=this.ping;else{var b=null;b=function(c){var d=o["int"](Math.min(2*c,45e3));return function(){a.ping(),a.timer=y.Timer.delay(b(d),c)}},b(3e3)()}},deleteTimer:function(){null!=this.timer&&(this.timer.stop(),this.timer=null)},__class__:v.proxy._MsgPackRpcProxy.ConnectionKeeper},v.proxy._MsgPackRpcProxy.ResponseHandler=function(a,b,c){this.method=a,this.onSuccess=b,this.onError=c},e["albero.proxy._MsgPackRpcProxy.ResponseHandler"]=v.proxy._MsgPackRpcProxy.ResponseHandler,v.proxy._MsgPackRpcProxy.ResponseHandler.__name__=["albero","proxy","_MsgPackRpcProxy","ResponseHandler"],v.proxy._MsgPackRpcProxy.ResponseHandler.prototype={__class__:v.proxy._MsgPackRpcProxy.ResponseHandler},v.proxy.Error=function(a){this.code=a.code,this.message=a.message,this.detail=a.detail},e["albero.proxy.Error"]=v.proxy.Error,v.proxy.Error.__name__=["albero","proxy","Error"],v.proxy.Error.prototype={__class__:v.proxy.Error},v.proxy.RoutingProxy=function(){u.patterns.proxy.Proxy.call(this,"routing")},e["albero.proxy.RoutingProxy"]=v.proxy.RoutingProxy,v.proxy.RoutingProxy.__name__=["albero","proxy","RoutingProxy"],v.proxy.RoutingProxy.__super__=u.patterns.proxy.Proxy,v.proxy.RoutingProxy.prototype=b(u.patterns.proxy.Proxy.prototype,{init:function(){null==this.router&&(this.router=new v.proxy._RoutingProxy.LocalRouter(this,this.settings,this.dataStore),this.router.start())},forward:function(a){this.init(),this.router.forward(a)},redirect:function(a,b){this.init(),this.router.redirect(a,b)},back:function(){null!=this.router&&this.router.back()},stop:function(){null!=this.router&&this.router.started&&this.router.stop()},__class__:v.proxy.RoutingProxy}),v.proxy._RoutingProxy={},v.proxy._RoutingProxy.LocalRouter=function(a,b,c){this.proxy=a,this.settings=b,this.dataStore=c,this.started=!1},e["albero.proxy._RoutingProxy.LocalRouter"]=v.proxy._RoutingProxy.LocalRouter,v.proxy._RoutingProxy.LocalRouter.__name__=["albero","proxy","_RoutingProxy","LocalRouter"],v.proxy._RoutingProxy.LocalRouter.prototype={notify:function(a){var b=this.getDomainId(a);this.settings.setSelectedDomainId(b),this.proxy.sendNotification("current_page_changed",a)},start:function(){this.started=!0},forward:function(a){switch(a[1]){case 0:break;default:this.notify(a)}},redirect:function(){},redirectWithHash:function(){},back:function(){this.notify(this.prev)},stop:function(){this.started=!1},getDomainId:function(a){switch(a[1]){case 2:var b=a[2];return b;case 3:var c=a[2];return c;case 4:var d=a[2];return d;case 5:var e=a[2];return e;case 6:var f=a[2];return f;case 7:var g=a[2];return g;default:return null}},parseFragment:function(a){if(null==a)return null;var b=a.split("/");if(""!=b[0])return null;if(2==b.length){if(""==b[1])return v.Urls.domains;if("settings"==b[1]){var c=this.settings.getLastSelectedDomainId();if(null!=c&&null!=this.dataStore.getDomain(c))return v.History.replaceState("settings",null,"#"+this.toFragment(v.Urls.settings(c))),v.Urls.settings(c);var d=this.dataStore.getDomains();if(d.length>0){for(var e=null,f=0;f<d.length;){var g=d[f];++f,(null==e||y.Int64.compare(e.id,g.id)>0)&&(e=g)}return v.History.replaceState("settings",null,"#"+this.toFragment(v.Urls.settings(e.id))),v.Urls.settings(e.id)}return v.Urls.settings(null)}if(b[1]==o.string(v.Urls.error))return v.Urls.error;if(b[1]==o.string(v.Urls.loading))return v.Urls.loading}else if(3==b.length){var h=v.Int64Helper.parse(b[1]);if(null!=h){if(""==b[2])return v.Urls.domain(h);if("members"==b[2])return v.Urls.members(h);if("talks"==b[2])return v.Urls.talks(h);if("actions"==b[2])return v.Urls.actions(h);if("console"==b[2])return v.Urls.console(h);if("settings"==b[2])return v.Urls.settings(h)}}return null},toFragment:function(a){switch(a[1]){case 1:return"/";case 9:case 10:return"/"+o.string(a);case 2:var b=a[2];return"/"+b.toString()+"/";case 3:var c=a[2];return"/"+c.toString()+"/members";case 4:var d=a[2];return"/"+d.toString()+"/talks";case 5:var e=a[2];return"/"+e.toString()+"/actions";case 6:var f=a[2];return"/"+f.toString()+"/console";case 7:var g=a[2];return null==g&&(g=this.settings.getLastSelectedDomainId()),null!=g?"/"+g.toString()+"/settings":"/settings";default:return null}},__class__:v.proxy._RoutingProxy.LocalRouter},v.proxy.SettingsProxy=function(){this.selectedDomainId=null,this.remember=!0,u.patterns.proxy.Proxy.call(this,"settings")},e["albero.proxy.SettingsProxy"]=v.proxy.SettingsProxy,v.proxy.SettingsProxy.__name__=["albero","proxy","SettingsProxy"],v.proxy.SettingsProxy.__super__=u.patterns.proxy.Proxy,v.proxy.SettingsProxy.prototype=b(u.patterns.proxy.Proxy.prototype,{setAccessTokenRemember:function(a){this.remember=a},setAccessToken:function(a){this.remember&&(this.accessToken=a,this.sendNotification("access_token_changed",a))},getAccessToken:function(){return null==this.accessToken&&(this.accessToken=C.accessToken),this.accessToken},clearAccessToken:function(){this.accessToken=null},setConfiguration:function(a){this.configuration=a,this.sendNotification("configuration_changed",a)},getConfiguration:function(){return this.configuration},setSelectedDomainId:function(a){v.Int64Helper.eq(this.selectedDomainId,a)||(this.selectedDomainId=a,this.sendNotification("domain_selection_changed",a))},getLastSelectedDomainId:function(){var a,b=null,c=null;return a=null!=b&&null!=c?new y.Int64(b,c):null},getSelectedDomainId:function(){return this.selectedDomainId},clearDomainSelection:function(){this.selectedDomainId=null},clearSelectedTalk:function(){if(this.hasSelectedTalk()){var a=v.Int64Helper.idStr(this.selectedDomainId);this.selectedTalkIds.remove(a)}},setSelectedTalk:function(a){if(w.DEBUG&&null!=console&&console.log(w.dateStr(),"talk selected. talk:",a,"","",""),null==this.selectedTalkIds&&(this.selectedTalkIds=new y.ds.StringMap),null==a){if(null!=this.selectedDomainId){var b=v.Int64Helper.idStr(this.selectedDomainId);this.selectedTalkIds.set(b,null)}this.sendNotification("talk_selection_changed")}else{var c=v.Int64Helper.idStr(a.domainId);if(this.selectedTalkIds.set(c,a.id),!v.Int64Helper.eq(a.domainId,this.selectedDomainId))return!1;this.sendNotification("talk_selection_changed",a)}return!0},hasSelectedTalk:function(){return null!=this.selectedTalkIds&&function(a){var b,c=v.Int64Helper.idStr(a.selectedDomainId);return b=a.selectedTalkIds.exists(c)}(this)},getSelectedTalkId:function(){if(null==this.selectedTalkIds)return null;var a=v.Int64Helper.idStr(this.selectedDomainId);return this.selectedTalkIds.get(a)},isSendByEnter:function(){return null==this.sendByEnter&&(this.sendByEnter=!0),this.sendByEnter},setSendByEnter:function(a){this.sendByEnter=a},setSelectedStampTabId:function(){},getSelectedStampTabId:function(){var a=0;return a},clearSelectedStampTabId:function(){},setInputTextForTalkId:function(a,b){null==a||0==a.length?this.clearInputTextForTalkId(b):(this.loadInputTextForAll(),this.inputTexts["_"+b.high+"_"+b.low]=a)},getInputTextForTalkId:function(a){this.loadInputTextForAll();var b=this.inputTexts["_"+a.high+"_"+a.low];return null!=b?b:""},clearInputTextForTalkId:function(a){this.loadInputTextForAll(),delete this.inputTexts["_"+a.high+"_"+a.low]},loadInputTextForAll:function(){if(null==this.inputTexts){try{}catch(a){}null==this.inputTexts&&(this.inputTexts={})}},saveInputTextForAll:function(){if(null!=this.inputTexts){JSON.stringify(this.inputTexts,null,null)}},clearInputTextForAll:function(){z.Browser.getLocalStorage().removeItem("input_text"),this.inputTexts=null},setCopyProfileToAllDomains:function(a){a?z.Browser.getLocalStorage().setItem("copy_profile_to_all_domains","true"):z.Browser.getLocalStorage().removeItem("copy_profile_to_all_domains")},isCopyProfileToAllDomains:function(){return null!=z.Browser.getLocalStorage().getItem("copy_profile_to_all_domains")},__class__:v.proxy.SettingsProxy}),u.interfaces.IMediator=function(){},e["puremvc.interfaces.IMediator"]=u.interfaces.IMediator,u.interfaces.IMediator.__name__=["puremvc","interfaces","IMediator"],u.interfaces.IMediator.prototype={__class__:u.interfaces.IMediator},u.patterns.mediator={},u.patterns.mediator.Mediator=function(a,b){u.patterns.observer.Notifier.call(this),this.mediatorName=null!=a?a:u.patterns.mediator.Mediator.NAME,null!=b&&(this.viewComponent=b)},e["puremvc.patterns.mediator.Mediator"]=u.patterns.mediator.Mediator,u.patterns.mediator.Mediator.__name__=["puremvc","patterns","mediator","Mediator"],u.patterns.mediator.Mediator.__interfaces__=[u.interfaces.IMediator],u.patterns.mediator.Mediator.__super__=u.patterns.observer.Notifier,u.patterns.mediator.Mediator.prototype=b(u.patterns.observer.Notifier.prototype,{getMediatorName:function(){return this.mediatorName},setViewComponent:function(a){this.viewComponent=a},getViewComponent:function(){return this.viewComponent},listNotificationInterests:function(){return[]},handleNotification:function(){},onRegister:function(){},onRemove:function(){},__class__:u.patterns.mediator.Mediator});var x={};x.mediator={},x.mediator.CommandLineMediator=function(){u.patterns.mediator.Mediator.call(this,"commandline",null)},e["albero_cli.mediator.CommandLineMediator"]=x.mediator.CommandLineMediator,x.mediator.CommandLineMediator.__name__=["albero_cli","mediator","CommandLineMediator"],x.mediator.CommandLineMediator.__super__=u.patterns.mediator.Mediator,x.mediator.CommandLineMediator.prototype=b(u.patterns.mediator.Mediator.prototype,{onRegister:function(){this.getViewComponent();this.eventEmitter=g.getInstance(),this.dataRecovered=!1},listNotificationInterests:function(){return["app_state_changed","access_token_changed","current_user_changed","configuration_changed","domain_selection_changed","talk_selection_changed","user_selection_needed","user_selection_changed","friend_selection_needed","stamp_set_changed","stamp_selection_changed","phone_call_started","phone_call_accepted","phone_call_connected","phone_call_hangued_up","action_selection_changed","current_page_changed","fileinfo_selection_changed","error_occurred","brand_badge_changed","send_form_top_changed","data_recovered","notify_update_user","notify_add_friend","notify_add_acquaintance","notify_delete_friend","notify_delete_acquaintance","notify_update_domain_users","get_domain_users_responsed","get_users_responsed","get_profile_responsed","update_user_responsed","update_profile_responsed","notify_add_domain_invite","notify_accept_domain_invite","notify_delete_domain_invite","notify_join_domain","notify_update_domain","notify_leave_domain","notify_create_pair_talk","notify_create_group_talk","notify_update_group_talk","notify_add_talkers","notify_delete_talker","notify_add_talk_invite","notify_accept_talk_invite","notify_delete_talk_invite","notify_delete_talk","notify_create_message","notify_update_read_statuses","notify_update_talk_status","notify_update_local_talk_status","notify_get_messages","notify_get_message_status","create_message_start","create_message_complete","create_message_fail","notify_create_announcement","notify_update_announcement_status","notify_get_announcements","notify_update_question","get_questions_responsed","notify_create_attachment","notify_delete_attachment","get_file_responsed"]},handleNotification:function(a){var b=this,c=a.getName();switch(c){case"data_recovered":if(this.dataRecovered)return;this.dataRecovered=!0,this.eventEmitter.emit(a.getName());break;case"error_occurred":this.eventEmitter.emit(a.getName(),new Error("AdapterError"),a.getBody());break;default:this.eventEmitter.emit(a.getName(),a.getBody())}var d=(this.getViewComponent(),a.getName());switch(d){case"access_token_changed":z.Node.console.log(a.getBody()),z.Node.process.exit(0);break;case"current_user_changed":{a.getBody()}break;case"notify_add_domain_invite":{a.getBody()}break;case"notify_create_pair_talk":case"notify_create_group_talk":if(!this.dataRecovered)return;var e=a.getBody();y.Timer.delay(function(){b.emit(e,"JoinMessage",b.dataStore.me)},500);break;case"notify_update_group_talk":if(!this.dataRecovered)return;var f,g=a.getBody();f=null!=g.name?g.name:"",y.Timer.delay(function(){b.emit(g,"TopicChangeMessage",b.dataStore.me,f)},500);break;case"create_message_complete":{var h=a.getBody(),i=h[0];h[1]}if(this.dataStore.isMe(i.userId))return void this.messageEvent.messageCreated(i,a.getType());break;case"notify_create_message":var j=a.getBody();if(this.dataStore.isMe(j.userId))return;var k=this.dataStore.getTalkStatus(j.talkId);if(null!=k&&null!=k.maxReadMessageId&&y.Int64.compare(k.maxReadMessageId,j.id)>=0)return;y.Timer.delay(function(){b.sendNotification("Read",v.command.ReadType.TALK(j.talkId,j.id)),b.dispatch(j)},200);break;case"notify_update_read_statuses":for(var l=a.getBody(),m=0,n=l.messageIds;m<n.length;){var o=n[m];++m,this.messageEvent.messageRead(l.talkId,o,l.readUserIds)}break;case"notify_get_message_status":var p=a.getBody();this.messageEvent.messageRead(p.talkId,p.id,p.readUserIds,p.unreadUserIds)}},emit:function(a,b,c,d){var e=this;null!=b&&null!=a&&null!=c&&this.api.getAllUserEmails(function(){e.eventEmitter.emit(b,{room:v.Int64Helper.idStr(a.id),rooms:e.hubotObject.talkObjects()},e.hubotObject.userObject(c),d)})},dispatch:function(a){var b=this,c=a.content,d=this.dataStore.getTalk(a.talkId),e=function(c,e,f){b.emit(d,c,b.dataStore.getUser(d.domainId,e),{id:v.Int64Helper.idStr(a.id),content:f})};if(a.type==v.entity.MessageType.system){var f=c.type;if("add_talkers"==f){var g=c.added_user_ids,h=this.dataStore.me.id;if(v.Int64Helper.contains(g,h))return void e("JoinMessage",h);for(var i=0;i<g.length;){var j=g[i];++i,e("EnterMessage",j)}}else"delete_talker"==f?(e("LeaveMessage",c.deleted_user_id),c.user_ids.length<=1&&y.Timer.delay(function(){b.sendNotification("Talk",v.command.TalkAction.DELETE(null,d))},500)):"hide_pair_talk"==f&&(e("LeaveMessage",c.user_id),y.Timer.delay(function(){b.sendNotification("Talk",v.command.TalkAction.DELETE(null,d))},500))}else{var k=null,l=a.type;switch(l[1]){case 1:k=c;break;default:for(var p=m.deepCopy(a.content),r=0,s=n.fields(p);r<s.length;){var t=s[r];++r;var u=n.field(p,t);if(n.isObject(p)&&null!=u.high&&null!=u.low){var w=y.Int64.make(u.high,u.low);n.setField(p,t,"stamp_index"==t?w.toString():"_"+w.high+"_"+w.low)}else"stamp_set"==t&&n.setField(p,t,o.string(u))}k=JSON.stringify(p)}if(null!=k){if(k=q.replace(k,"　"," "),d.type==v.entity.TalkType.PairTalk){var x="Hubot";q.startsWith(k,x)||(k=x+" "+k)}e("TextMessage",a.userId,k)}}},__class__:x.mediator.CommandLineMediator}),x.proxy={},x.proxy.HubotObjectProxy=function(){u.patterns.proxy.Proxy.call(this,"hubotObject")},e["albero_cli.proxy.HubotObjectProxy"]=x.proxy.HubotObjectProxy,x.proxy.HubotObjectProxy.__name__=["albero_cli","proxy","HubotObjectProxy"],x.proxy.HubotObjectProxy.__super__=u.patterns.proxy.Proxy,x.proxy.HubotObjectProxy.prototype=b(u.patterns.proxy.Proxy.prototype,{userObject:function(a){var b=m.deepCopy(a);return b.id_i64=a.id,b.id=v.Int64Helper.idStr(a.id),b.name=a.displayName,b.profile_url=a.profileImageUrl,b},userObjectByIdStr:function(a,b){var c=this.userObjectsByIds(a,[v.Int64Helper.idStrToInt64(b)]);return c.length>0?c[0]:null},userObjectsByIds:function(a,b){for(var c=[],d=0,e=this.dataStore.getUsers(a,b);d<e.length;){var f=e[d];++d,null!=f&&c.push(this.userObject(f))}return c},userObjects:function(a){for(var b={},c=0,d=this.dataStore.getUsers(a);c<d.length;){var e=d[c];++c,b[v.Int64Helper.idStr(e.id)]=this.userObject(e)}return b},talkObject:function(a){var b=m.deepCopy(a);return b.id_i64=a.id,b.id=v.Int64Helper.idStr(a.id),b.topic=a.name,b.type=a.type==v.entity.TalkType.Unknown?0:a.type==v.entity.TalkType.PairTalk?1:2,b.users=this.userObjectsByIds(a.domainId,a.userIds),b.domain=this.domainObjectById(a.domainId),b.domainId_i64=a.domainId,b.domainId=v.Int64Helper.idStr(a.domainId),b},talkObjects:function(a){for(var b={},c=0,d=this.dataStore.getTalks();c<d.length;){var e=d[c];++c,(null==a||v.Int64Helper.eq(a,e.domainId))&&(b[v.Int64Helper.idStr(e.id)]=this.talkObject(e))}return b},domainObjectById:function(a){return this.domainObject(this.dataStore.getDomain(a))},domainObject:function(a,b){null==b&&(b=!1);var c=m.deepCopy(a);return c.id_i64=a.id,c.id=v.Int64Helper.idStr(a.id),b&&(c.talks=this.talkObjects(a.id)),c},domainObjects:function(){for(var a={},b=0,c=this.dataStore.getDomains();b<c.length;){var d=c[b];++b,a[v.Int64Helper.idStr(d.id)]=this.domainObject(d)}return a},__class__:x.proxy.HubotObjectProxy}),x.proxy.MessageEventProxy=function(){u.patterns.proxy.Proxy.call(this,"messageEvent"),this.emitters=new y.ds.StringMap},e["albero_cli.proxy.MessageEventProxy"]=x.proxy.MessageEventProxy,x.proxy.MessageEventProxy.__name__=["albero_cli","proxy","MessageEventProxy"],x.proxy.MessageEventProxy.__super__=u.patterns.proxy.Proxy,x.proxy.MessageEventProxy.prototype=b(u.patterns.proxy.Proxy.prototype,{registEmitter:function(a,b){for(var c=null,d=n.fields(b),e=0;e<d.length;){var f=d[e];if(++e,q.startsWith(f,"on")){var g=n.field(b,f);n.isFunction(g)&&(n.deleteField(b,f),null==c&&(c={context:b}),n.setField(c,i.substr(f,2,null),g))}}null!=c&&(w.DEBUG&&null!=console&&console.log(w.dateStr(),"regist emitter",a,c,"",""),this.emitters.set(a,c))},unregisterEmitter:function(a,b){for(var c=0,d=0,e=n.fields(a);d<e.length;){var f=e[d];++d,n.isFunction(n.field(a,f))&&c++}0==c&&(w.DEBUG&&null!=console&&console.log(w.dateStr(),"unregist emitter",b,a,"",""),this.emitters.remove(b))},off:function(a,b){null!=b&&Object.prototype.hasOwnProperty.call(a,b)&&n.deleteField(a,b)},emit:function(a,b,c){var d=n.field(a,b);null!=d&&(w.DEBUG&&null!=console&&console.log(w.dateStr(),"emit '"+b+"'",c,"","",""),d.apply(a,c))},messageCreated:function(a,b){var c=this.emitters.get(b);if(null!=c){this.emitters.remove(b);var d=v.Int64Helper.idStr(a.id),e=c;this.emitters.set(d,e);var f=this.dataStore.getTalk(a.talkId),g=this.dataStore.me.id;c.__readerIds=[g],c.__unreadIds=f.userIds.slice(),v.Int64Helper.remove(c.__unreadIds,g),c.readUsers=this.hubotObject.userObjectsByIds(f.domainId,c.__readerIds),c.unreadUsers=this.hubotObject.userObjectsByIds(f.domainId,c.__unreadIds),this.emit(c,"send",[c,a]),this.off(c,"send")}},messageRead:function(a,b,c,d){var e=this,f=this.emitters.get("_"+b.high+"_"+b.low);if(null!=f){w.DEBUG&&null!=console&&console.log(w.dateStr(),"CALL messageREAD",c,d,"","");var g=f.__readerIds,h=f.__unreadIds,i=[];null!=d&&(h=f.__unreadIds=d);for(var j=0;j<c.length;){var k=c[j];++j,v.Int64Helper.contains(g,k)||(g.push(k),i.push(k)),v.Int64Helper.remove(h,k),w.DEBUG&&null!=console&&console.log(w.dateStr(),"UNREAD REMOVE",h,k,"","")}if(w.DEBUG&&null!=console&&console.log(w.dateStr(),"DIFF",i,g,h,""),i.length>0){var l,m=this.dataStore.getTalk(a);l=null!=m?m.domainId:null,f.readUsers=this.hubotObject.userObjectsByIds(l,g),f.unreadUsers=this.hubotObject.userObjectsByIds(l,h),this.emit(f,"read",[this.hubotObject.userObjectsByIds(l,i),f.readUsers,f.unreadUsers])}if(g.length<16);else if(null==f.__readerTimer){var n=new y.Timer(6e4);n.run=function(){e.sendNotification("Read",v.command.ReadType.READ_STATUS(a,b))},f.__readerTimer=n}0==h.length&&this.messageReadEveryone(a,b)}},messageReadEveryone:function(a,b){var c=this.emitters.get("_"+b.high+"_"+b.low);if(null!=c){var d=c.__readerTimer;null!=d&&(d.stop(),n.deleteField(c,"__readerTimer")),this.off(c,"read"),this.unregisterEmitter(c,"_"+b.high+"_"+b.low)}},__class__:x.proxy.MessageEventProxy}),x.proxy.SendQueueProxy=function(){u.patterns.proxy.Proxy.call(this,"sendQueue"),this.sendQueue=new Array,this.sending=!1,this.sendCount=0;var a=new Date;a.setTime(0),this.lastSendTime=a},e["albero_cli.proxy.SendQueueProxy"]=x.proxy.SendQueueProxy,x.proxy.SendQueueProxy.__name__=["albero_cli","proxy","SendQueueProxy"],x.proxy.SendQueueProxy.__super__=u.patterns.proxy.Proxy,x.proxy.SendQueueProxy.prototype=b(u.patterns.proxy.Proxy.prototype,{sendAnnouncement:function(a,b){this.send(a,null,b)},sendMessage:function(a,b){this.send(null,a,b)},send:function(a,b,c){if("string"!=typeof c){var d=y.Int64.make(0,this.sendCount++);this.messageEvent.registEmitter("_"+d.high+"_"+d.low,c);var e=new v.entity.Message;if(e.id=d,e.domainId=a,e.talkId=b,e.content=this.parseContent(c),e.type=this.detectType(e.content),e.type==v.entity.MessageType.unknown)return;if(e.type==v.entity.MessageType.file&&null!=e.content.path)return void this.sendFile(b,e.content,"_"+d.high+"_"+d.low);e.type!=v.entity.MessageType.yesOrNo&&e.type!=v.entity.MessageType.selectOne||null!=e.content.listing||(e.content.listing=!1),this.pushQueue(e)}else for(var f=c,g=0,h=r.slice(f,1024);g<h.length;){var i=h[g];++g;var j=new v.entity.Message;j.domainId=a,j.talkId=b,j.type=v.entity.MessageType.text,j.content=i,this.pushQueue(j)}},sendFile:function(a,b,c){var d,e=null,f=null;"string"==typeof b?d=b:(d=b.path,e=b.name,f=b.type),null!=d&&z.Node.require("fs").existsSync(d)&&this.sendNotification("File",v.command.FileAction.UPLOAD_PATH(a,d,e,f,c))},pushQueue:function(a){if(this.sendQueue.push(a),!this.sending){this.sending=!0;var b=(new Date).getTime()-this.lastSendTime.getTime(),c=o["int"](Math.max(500-b,100));y.Timer.delay(d(this,this.startSendTimer),c)}},startSendTimer:function(){this.sendNotification("Send",this.sendQueue.shift()),0==this.sendQueue.length?(this.lastSendTime=new Date,this.sending=!1):y.Timer.delay(d(this,this.startSendTimer),500)},parseContent:function(a){if(null==a)return null;for(var b=n.fields(a),c=0;c<b.length;){var d=b[c];++c;var e=n.field(a,d);if("string"==typeof e){var f=null;"stamp_set"==d?f=o.parseInt(e):"stamp_index"==d?f=v.Int64Helper.parse(e):("file_id"==d||"in_reply_to"==d)&&(f=v.Int64Helper.idStrToInt64(e)),null!=f&&(a[d]=f)}else n.isObject(a)&&null!=e.high&&null!=e.low&&n.setField(a,d,y.Int64.make(e.high,e.low))}return 1==b.length&&null!=a.text?a.text:a},detectType:function(a){return null==a?v.entity.MessageType.unknown:"string"==typeof a?v.entity.MessageType.text:null!=a.stamp_set?v.entity.MessageType.stamp:null!=a.lat?v.entity.MessageType.geo:null!=a.file_id||null!=a.path?v.entity.MessageType.file:null!=a.question?null==a.in_reply_to?null==a.options?v.entity.MessageType.yesOrNo:v.entity.MessageType.selectOne:null==a.options?v.entity.MessageType.yesOrNoReply:v.entity.MessageType.selectOneReply:null!=a.title?null==a.in_reply_to?v.entity.MessageType.todo:v.entity.MessageType.todoDone:v.entity.MessageType.unknown},__class__:x.proxy.SendQueueProxy});var y={};y.Http=function(a){this.url=a,this.headers=new y.ds.StringMap,this.params=new y.ds.StringMap,this.async=!0},e["haxe.Http"]=y.Http,y.Http.__name__=["haxe","Http"],y.Http.requestUrl=function(a){var b=new y.Http(a);b.async=!1;var c=null;return b.onData=function(a){c=a},b.onError=function(a){throw a},b.request(!1),c},y.Http.prototype={setHeader:function(a,b){this.headers.set(a,b)},setParameter:function(a,b){this.params.set(a,b)},setPostData:function(a){this.postData=a},request:function(a){var b=this,c=this,d={},e=this.postData,f="https://"==this.url.substring(0,8);"http://"==this.url.substring(0,7)?this.url=i.substr(this.url,7,null):f&&(this.url=i.substr(this.url,8,null));var g=this.url.split("/"),h=g.shift();d.path=g.length>0?"/"+g.join("/"):"/";var j=h.split(":");if(null!=j&&j.length>1?(d.host=j[0],d.port=o.parseInt(j[1])):d.host=h,null!=e)a=!0;else for(var k=this.params.keys();k.hasNext();){var l=k.next();null==e?e="":e+="&",e+=encodeURIComponent(l)+"="+q.urlEncode(this.params.get(l))}if(null!=e){var m=this.url.split("?").length<=1;d.path+=(m?"?":"&")+e,e=null}if(d.method=a?"POST":"GET",null==this.headers.get("Content-Type")&&a&&null==this.postData&&this.headers.set("Content-Type","application/x-www-form-urlencoded"),this.headers.iterator().hasNext()){null==d.headers&&(d.headers={});for(var p=this.headers.keys();p.hasNext();){var r=p.next();n.setField(d.headers,r,this.headers.get(r))}}var s=null;s=z.Node.require(f?"https":"http");var t=s.request(d,function(a){var d="";a.setEncoding("utf8");var e;try{e=a.statusCode}catch(f){e=0}if(null!=a.statusCode&&c.onStatus(a.statusCode),null!=a.statusCode&&a.statusCode>=200&&a.statusCode<400);else switch(e){case 0:c.onError("Failed to connect or resolve host");
break;case 12029:c.onError("Failed to connect to host");break;case 12007:c.onError("Unknown host");break;default:c.onError("Http Error #"+a.statusCode)}a.on("data",function(a){d+=a}),a.once("end",function(){a.removeAllListeners("data"),a.removeAllListeners("end"),null!=d&&b.onData(d),d=null}),a.once("close",function(){null!=d&&b.onData(d),d=null}),a.once("error",function(a){c.onError("Http Response Error: "+o.string(a))})});t.on("error",function(a){c.onError("Http Request Error: "+o.string(a))}),t.end()},onData:function(){},onError:function(){},onStatus:function(){},__class__:y.Http},y.Int64=function(a,b){this.high=0|a,this.low=0|b},e["haxe.Int64"]=y.Int64,y.Int64.__name__=["haxe","Int64"],y.Int64.make=function(a,b){return new y.Int64(a,b)},y.Int64.getLow=function(a){return a.low},y.Int64.getHigh=function(a){return a.high},y.Int64.add=function(a,b){var c=a.high+b.high|0,d=a.low+b.low|0;return y.Int64.uicompare(d,a.low)<0&&c++,new y.Int64(c,d)},y.Int64.sub=function(a,b){var c=a.high-b.high|0,d=a.low-b.low|0;return y.Int64.uicompare(a.low,b.low)<0&&c--,new y.Int64(c,d)},y.Int64.mul=function(a,b){var c=65535,d=a.low&c,e=a.low>>>16,f=b.low&c,g=b.low>>>16,h=d*f,i=e*f,j=d*g,k=e*g,l=h,m=k+(j>>>16)+(i>>>16)|0;return j=j<<16|0,l=l+j|0,y.Int64.uicompare(l,j)<0&&(m=m+1|0),i=i<<16|0,l=l+i|0,y.Int64.uicompare(l,i)<0&&(m=m+1|0),m=m+function(){var c,d=a.low,e=b.high;return c=(d*(e>>>16)<<16|0)+d*(65535&e)|0}(this)|0,m=m+function(){var c,d=a.high,e=b.low;return c=(d*(e>>>16)<<16|0)+d*(65535&e)|0}(this)|0,new y.Int64(m,l)},y.Int64.divMod=function(a,b){var c=new y.Int64(0,0),d=0,e=1;for(b=new y.Int64(b.high,b.low);b.high>=0;){var f=y.Int64.ucompare(b,a);if(b.high=b.high<<1|0|b.low>>>31|0,b.low=b.low<<1|0,d=d<<1|0|e>>>31|0,e=e<<1|0,f>=0)break}for(;0!=(e|d|0);)y.Int64.ucompare(a,b)>=0&&(c.high=c.high|d|0,c.low=c.low|e|0,a=y.Int64.sub(a,b)),e=e>>>1|(d<<31|0)|0,d>>>=1,b.low=b.low>>>1|(b.high<<31|0)|0,b.high=b.high>>>1;return{quotient:c,modulus:a}},y.Int64.neg=function(a){var b=0|~a.high,c=0|-a.low;return 0==c&&b++,new y.Int64(b,c)},y.Int64.uicompare=function(a,b){return 0>a?0>b?~b-~a|0:1:0>b?-1:a-b|0},y.Int64.compare=function(a,b){var c=a.high-b.high|0;return 0!=c?c:y.Int64.uicompare(a.low,b.low)},y.Int64.ucompare=function(a,b){var c=y.Int64.uicompare(a.high,b.high);return 0!=c?c:y.Int64.uicompare(a.low,b.low)},y.Int64.prototype={toString:function(){if(0==(this.high|this.low))return"0";var a="",b=!1,c=this;c.high<0&&(b=!0,c=y.Int64.neg(c));for(var d=new y.Int64(0,10);0!=(c.high|c.low);){var e=y.Int64.divMod(c,d);a=e.modulus.low+a,c=e.quotient}return b&&(a="-"+a),a},__class__:y.Int64},y.Json=function(){},e["haxe.Json"]=y.Json,y.Json.__name__=["haxe","Json"],y.Json.stringify=function(a,b,c){return JSON.stringify(a,b,c)},y.Json.parse=function(a){return JSON.parse(a)},y.Timer=function(a){var b=this;this.id=setInterval(function(){b.run()},a)},e["haxe.Timer"]=y.Timer,y.Timer.__name__=["haxe","Timer"],y.Timer.delay=function(a,b){var c=new y.Timer(b);return c.run=function(){c.stop(),a()},c},y.Timer.prototype={stop:function(){null!=this.id&&(clearInterval(this.id),this.id=null)},run:function(){},__class__:y.Timer},y.ds={},y.ds.IntMap=function(){this.h={}},e["haxe.ds.IntMap"]=y.ds.IntMap,y.ds.IntMap.__name__=["haxe","ds","IntMap"],y.ds.IntMap.__interfaces__=[l],y.ds.IntMap.prototype={set:function(a,b){this.h[a]=b},get:function(a){return this.h[a]},remove:function(a){return this.h.hasOwnProperty(a)?(delete this.h[a],!0):!1},keys:function(){var a=[];for(var b in this.h)this.h.hasOwnProperty(b)&&a.push(0|b);return i.iter(a)},__class__:y.ds.IntMap},y.ds.ObjectMap=function(){this.h={},this.h.__keys__={}},e["haxe.ds.ObjectMap"]=y.ds.ObjectMap,y.ds.ObjectMap.__name__=["haxe","ds","ObjectMap"],y.ds.ObjectMap.__interfaces__=[l],y.ds.ObjectMap.prototype={set:function(a,b){var c=a.__id__||(a.__id__=++y.ds.ObjectMap.count);this.h[c]=b,this.h.__keys__[c]=a},__class__:y.ds.ObjectMap},y.ds.StringMap=function(){this.h={}},e["haxe.ds.StringMap"]=y.ds.StringMap,y.ds.StringMap.__name__=["haxe","ds","StringMap"],y.ds.StringMap.__interfaces__=[l],y.ds.StringMap.prototype={set:function(a,b){this.h["$"+a]=b},get:function(a){return this.h["$"+a]},exists:function(a){return this.h.hasOwnProperty("$"+a)},remove:function(a){return a="$"+a,this.h.hasOwnProperty(a)?(delete this.h[a],!0):!1},keys:function(){var a=[];for(var b in this.h)this.h.hasOwnProperty(b)&&a.push(b.substr(1));return i.iter(a)},iterator:function(){return{ref:this.h,it:this.keys(),hasNext:function(){return this.it.hasNext()},next:function(){var a=this.it.next();return this.ref["$"+a]}}},__class__:y.ds.StringMap},y.io={},y.io.Bytes=function(a,b){this.length=a,this.b=b},e["haxe.io.Bytes"]=y.io.Bytes,y.io.Bytes.__name__=["haxe","io","Bytes"],y.io.Bytes.alloc=function(a){return new y.io.Bytes(a,new Buffer(a))},y.io.Bytes.ofString=function(a){var b=new Buffer(a,"utf8");return new y.io.Bytes(b.length,b)},y.io.Bytes.ofData=function(a){return new y.io.Bytes(a.length,a)},y.io.Bytes.prototype={get:function(a){return this.b[a]},set:function(a,b){this.b[a]=b},blit:function(a,b,c,d){if(0>a||0>c||0>d||a+d>this.length||c+d>b.length)throw y.io.Error.OutsideBounds;b.b.copy(this.b,a,c,c+d)},sub:function(a,b){if(0>a||0>b||a+b>this.length)throw y.io.Error.OutsideBounds;var c=new Buffer(b),d=this.b.slice(a,a+b);return d.copy(c,0,0,b),new y.io.Bytes(b,c)},compare:function(a){var b,c=this.b,d=a.b;b=this.length<a.length?this.length:a.length;for(var e=0;b>e;){var f=e++;if(c[f]!=d[f])return c[f]-d[f]}return this.length-a.length},readString:function(a,b){if(0>a||0>b||a+b>this.length)throw y.io.Error.OutsideBounds;for(var c="",d=this.b,e=String.fromCharCode,f=a,g=a+b;g>f;){var h=d[f++];if(128>h){if(0==h)break;c+=e(h)}else if(224>h)c+=e((63&h)<<6|127&d[f++]);else if(240>h){var i=d[f++];c+=e((31&h)<<12|(127&i)<<6|127&d[f++])}else{var j=d[f++],k=d[f++];c+=e((15&h)<<18|(127&j)<<12|k<<6&127|127&d[f++])}}return c},toString:function(){return this.readString(0,this.length)},toHex:function(){for(var a=new p,b=[],c="0123456789abcdef",d=0,e=c.length;e>d;){var f=d++;b.push(i.cca(c,f))}for(var g=0,h=this.length;h>g;){var j=g++,k=this.b[j];a.b+=String.fromCharCode(b[k>>4]),a.b+=String.fromCharCode(b[15&k])}return a.b},getData:function(){return this.b},__class__:y.io.Bytes},y.io.BytesBuffer=function(){this.b=new Array},e["haxe.io.BytesBuffer"]=y.io.BytesBuffer,y.io.BytesBuffer.__name__=["haxe","io","BytesBuffer"],y.io.BytesBuffer.prototype={get_length:function(){return this.b.length},addByte:function(a){this.b.push(a)},add:function(a){for(var b=(this.b,a.b),c=0,d=a.length;d>c;){var e=c++;this.b.push(b[e])}},addBytes:function(a,b,c){if(0>b||0>c||b+c>a.length)throw y.io.Error.OutsideBounds;for(var d=(this.b,a.b),e=b,f=b+c;f>e;){var g=e++;this.b.push(d[g])}},getBytes:function(){var a=new Buffer(this.b),b=new y.io.Bytes(a.length,a);return this.b=null,b},__class__:y.io.BytesBuffer},y.io.Input=function(){},e["haxe.io.Input"]=y.io.Input,y.io.Input.__name__=["haxe","io","Input"],y.io.Input.prototype={readByte:function(){throw"Not implemented"},readBytes:function(a,b,c){var d=c,e=a.b;if(0>b||0>c||b+c>a.length)throw y.io.Error.OutsideBounds;for(;d>0;)e[b]=this.readByte(),b++,d--;return c},set_bigEndian:function(a){return this.bigEndian=a,a},read:function(a){for(var b=y.io.Bytes.alloc(a),c=0;a>0;){var d=this.readBytes(b,c,a);if(0==d)throw y.io.Error.Blocked;c+=d,a-=d}return b},readFloat:function(){var a=[];a.push(this.readByte()),a.push(this.readByte()),a.push(this.readByte()),a.push(this.readByte()),this.bigEndian||a.reverse();var b=1-(a[0]>>7<<1),c=(a[0]<<1&255|a[1]>>7)-127,d=(127&a[1])<<16|a[2]<<8|a[3];return 0==d&&-127==c?0:b*(1+Math.pow(2,-23)*d)*Math.pow(2,c)},readDouble:function(){var a=[];a.push(this.readByte()),a.push(this.readByte()),a.push(this.readByte()),a.push(this.readByte()),a.push(this.readByte()),a.push(this.readByte()),a.push(this.readByte()),a.push(this.readByte()),this.bigEndian||a.reverse();var b=1-(a[0]>>7<<1),c=(a[0]<<4&2047|a[1]>>4)-1023,d=this.getDoubleSig(a);return 0==d&&-1023==c?0:b*(1+Math.pow(2,-52)*d)*Math.pow(2,c)},readInt8:function(){var a=this.readByte();return a>=128?a-256:a},readInt16:function(){var a,b=this.readByte(),c=this.readByte();return a=this.bigEndian?c|b<<8:b|c<<8,0!=(32768&a)?a-65536:a},readUInt16:function(){var a=this.readByte(),b=this.readByte();return this.bigEndian?b|a<<8:a|b<<8},readInt32:function(){var a=this.readByte(),b=this.readByte(),c=this.readByte(),d=this.readByte();return this.bigEndian?d|c<<8|b<<16|a<<24:a|b<<8|c<<16|d<<24},getDoubleSig:function(a){return 4294967296*((15&a[1])<<16|a[2]<<8|a[3])+2147483648*(a[4]>>7)+((127&a[4])<<24|a[5]<<16|a[6]<<8|a[7])},__class__:y.io.Input},y.io.BytesInput=function(a,b,c){if(null==b&&(b=0),null==c&&(c=a.length-b),0>b||0>c||b+c>a.length)throw y.io.Error.OutsideBounds;this.b=a.b,this.pos=b,this.len=c,this.totlen=c},e["haxe.io.BytesInput"]=y.io.BytesInput,y.io.BytesInput.__name__=["haxe","io","BytesInput"],y.io.BytesInput.__super__=y.io.Input,y.io.BytesInput.prototype=b(y.io.Input.prototype,{readByte:function(){if(0==this.len)throw new y.io.Eof;return this.len--,this.b[this.pos++]},readBytes:function(a,b,c){if(0>b||0>c||b+c>a.length)throw y.io.Error.OutsideBounds;if(0==this.len&&c>0)throw new y.io.Eof;this.len<c&&(c=this.len);for(var d=this.b,e=a.b,f=0;c>f;){var g=f++;e[b+g]=d[this.pos+g]}return this.pos+=c,this.len-=c,c},__class__:y.io.BytesInput}),y.io.Output=function(){},e["haxe.io.Output"]=y.io.Output,y.io.Output.__name__=["haxe","io","Output"],y.io.Output.prototype={writeByte:function(){throw"Not implemented"},writeBytes:function(a,b,c){var d=c,e=a.b;if(0>b||0>c||b+c>a.length)throw y.io.Error.OutsideBounds;for(;d>0;)this.writeByte(e[b]),b++,d--;return c},set_bigEndian:function(a){return this.bigEndian=a,a},write:function(a){for(var b=a.length,c=0;b>0;){var d=this.writeBytes(a,c,b);if(0==d)throw y.io.Error.Blocked;c+=d,b-=d}},writeFloat:function(a){if(0==a)return this.writeByte(0),this.writeByte(0),this.writeByte(0),void this.writeByte(0);var b,c=Math.floor(Math.log(Math.abs(a))/y.io.Output.LN2),d=8388607&Math.floor(Math.abs(a)/Math.pow(2,c)*8388608);b=c+127>>1|(c>0?0>a?128:64:0>a?128:0);var e=c+127<<7&255|d>>16&127,f=d>>8&255,g=255&d;this.bigEndian?(this.writeByte(b),this.writeByte(e),this.writeByte(f),this.writeByte(g)):(this.writeByte(g),this.writeByte(f),this.writeByte(e),this.writeByte(b))},writeDouble:function(a){if(0==a)return this.writeByte(0),this.writeByte(0),this.writeByte(0),this.writeByte(0),this.writeByte(0),this.writeByte(0),this.writeByte(0),void this.writeByte(0);var b,c=Math.floor(Math.log(Math.abs(a))/y.io.Output.LN2),d=Math.floor(Math.abs(a)/Math.pow(2,c)*Math.pow(2,52)),e=34359738367&d,f=Math.floor(d/Math.pow(2,32));b=c+1023>>4|(c>0?0>a?128:64:0>a?128:0);var g=c+1023<<4&255|f>>16&15,h=f>>8&255,i=255&f,j=e>>24&255,k=e>>16&255,l=e>>8&255,m=255&e;this.bigEndian?(this.writeByte(b),this.writeByte(g),this.writeByte(h),this.writeByte(i),this.writeByte(j),this.writeByte(k),this.writeByte(l),this.writeByte(m)):(this.writeByte(m),this.writeByte(l),this.writeByte(k),this.writeByte(j),this.writeByte(i),this.writeByte(h),this.writeByte(g),this.writeByte(b))},writeInt8:function(a){if(-128>a||a>=128)throw y.io.Error.Overflow;this.writeByte(255&a)},writeInt16:function(a){if(-32768>a||a>=32768)throw y.io.Error.Overflow;this.writeUInt16(65535&a)},writeUInt16:function(a){if(0>a||a>=65536)throw y.io.Error.Overflow;this.bigEndian?(this.writeByte(a>>8),this.writeByte(255&a)):(this.writeByte(255&a),this.writeByte(a>>8))},writeInt32:function(a){this.bigEndian?(this.writeByte(a>>>24),this.writeByte(a>>16&255),this.writeByte(a>>8&255),this.writeByte(255&a)):(this.writeByte(255&a),this.writeByte(a>>8&255),this.writeByte(a>>16&255),this.writeByte(a>>>24))},__class__:y.io.Output},y.io.BytesOutput=function(){this.b=new y.io.BytesBuffer},e["haxe.io.BytesOutput"]=y.io.BytesOutput,y.io.BytesOutput.__name__=["haxe","io","BytesOutput"],y.io.BytesOutput.__super__=y.io.Output,y.io.BytesOutput.prototype=b(y.io.Output.prototype,{writeByte:function(a){this.b.b.push(a)},writeBytes:function(a,b,c){return this.b.addBytes(a,b,c),c},getBytes:function(){return this.b.getBytes()},__class__:y.io.BytesOutput}),y.io.Eof=function(){},e["haxe.io.Eof"]=y.io.Eof,y.io.Eof.__name__=["haxe","io","Eof"],y.io.Eof.prototype={toString:function(){return"Eof"},__class__:y.io.Eof},y.io.Error={__ename__:!0,__constructs__:["Blocked","Overflow","OutsideBounds","Custom"]},y.io.Error.Blocked=["Blocked",0],y.io.Error.Blocked.toString=f,y.io.Error.Blocked.__enum__=y.io.Error,y.io.Error.Overflow=["Overflow",1],y.io.Error.Overflow.toString=f,y.io.Error.Overflow.__enum__=y.io.Error,y.io.Error.OutsideBounds=["OutsideBounds",2],y.io.Error.OutsideBounds.toString=f,y.io.Error.OutsideBounds.__enum__=y.io.Error,y.io.Error.Custom=function(a){var b=["Custom",3,a];return b.__enum__=y.io.Error,b.toString=f,b},y.rtti={},y.rtti.Meta=function(){},e["haxe.rtti.Meta"]=y.rtti.Meta,y.rtti.Meta.__name__=["haxe","rtti","Meta"],y.rtti.Meta.getFields=function(a){var b=a.__meta__;return null==b||null==b.fields?{}:b.fields};var z={};z.Boot=function(){},e["js.Boot"]=z.Boot,z.Boot.__name__=["js","Boot"],z.Boot.getClass=function(a){return a instanceof Array&&null==a.__enum__?Array:a.__class__},z.Boot.__string_rec=function(a,b){if(null==a)return"null";if(b.length>=5)return"<...>";var c=typeof a;switch("function"==c&&(a.__name__||a.__ename__)&&(c="object"),c){case"object":if(a instanceof Array){if(a.__enum__){if(2==a.length)return a[0];var d=a[0]+"(";b+="	";for(var e=2,f=a.length;f>e;){var g=e++;d+=2!=g?","+z.Boot.__string_rec(a[g],b):z.Boot.__string_rec(a[g],b)}return d+")"}var h=a.length,i="[";b+="	";for(var j=0;h>j;){var k=j++;i+=(k>0?",":"")+z.Boot.__string_rec(a[k],b)}return i+="]"}var l;try{l=a.toString}catch(m){return"???"}if(null!=l&&l!=Object.toString){var n=a.toString();if("[object Object]"!=n)return n}var o=null,p="{\n";b+="	";var q=null!=a.hasOwnProperty;for(var o in a)(!q||a.hasOwnProperty(o))&&"prototype"!=o&&"__class__"!=o&&"__super__"!=o&&"__interfaces__"!=o&&"__properties__"!=o&&(2!=p.length&&(p+=", \n"),p+=b+o+" : "+z.Boot.__string_rec(a[o],b));return b=b.substring(1),p+="\n"+b+"}";case"function":return"<function>";case"string":return a;default:return String(a)}},z.Boot.__interfLoop=function(a,b){if(null==a)return!1;if(a==b)return!0;var c=a.__interfaces__;if(null!=c)for(var d=0,e=c.length;e>d;){var f=d++,g=c[f];if(g==b||z.Boot.__interfLoop(g,b))return!0}return z.Boot.__interfLoop(a.__super__,b)},z.Boot.__instanceof=function(a,b){if(null==b)return!1;switch(b){case E:return(0|a)===a;case G:return"number"==typeof a;case H:return"boolean"==typeof a;case String:return"string"==typeof a;case Array:return a instanceof Array&&null==a.__enum__;case F:return!0;default:if(null==a)return!1;if("function"==typeof b){if(a instanceof b)return!0;if(z.Boot.__interfLoop(z.Boot.getClass(a),b))return!0}return b==I&&null!=a.__name__?!0:b==J&&null!=a.__ename__?!0:a.__enum__==b}},z.Boot.__cast=function(a,b){if(z.Boot.__instanceof(a,b))return a;throw"Cannot cast "+o.string(a)+" to "+o.string(b)},z.Browser=function(){},e["js.Browser"]=z.Browser,z.Browser.__name__=["js","Browser"],z.Browser.getLocalStorage=function(){try{var a=window.localStorage;return a.getItem(""),a}catch(b){return null}},z.NodeC=function(){},e["js.NodeC"]=z.NodeC,z.NodeC.__name__=["js","NodeC"],z.Node=function(){},e["js.Node"]=z.Node,z.Node.__name__=["js","Node"],z.Node.get_assert=function(){return z.Node.require("assert")},z.Node.get_child_process=function(){return z.Node.require("child_process")},z.Node.get_cluster=function(){return z.Node.require("cluster")},z.Node.get_crypto=function(){return z.Node.require("crypto")},z.Node.get_dgram=function(){return z.Node.require("dgram")},z.Node.get_dns=function(){return z.Node.require("dns")},z.Node.get_fs=function(){return z.Node.require("fs")},z.Node.get_http=function(){return z.Node.require("http")},z.Node.get_https=function(){return z.Node.require("https")},z.Node.get_net=function(){return z.Node.require("net")},z.Node.get_os=function(){return z.Node.require("os")},z.Node.get_path=function(){return z.Node.require("path")},z.Node.get_querystring=function(){return z.Node.require("querystring")},z.Node.get_repl=function(){return z.Node.require("repl")},z.Node.get_tls=function(){return z.Node.require("tls")},z.Node.get_url=function(){return z.Node.require("url")},z.Node.get_util=function(){return z.Node.require("util")},z.Node.get_vm=function(){return z.Node.require("vm")},z.Node.get_zlib=function(){return z.Node.require("zlib")},z.Node.get___filename=function(){return __filename},z.Node.get___dirname=function(){return __dirname},z.Node.get_json=function(){return JSON},z.Node.newSocket=function(a){return new z.Node.net.Socket(a)};var A={};A.Decoder=function(a,b){var c=new y.io.BytesInput(a);c.set_bigEndian(!0),this.o=this.decode(c,b)},e["msgpack.Decoder"]=A.Decoder,A.Decoder.__name__=["msgpack","Decoder"],A.Decoder.prototype={decode:function(a,b){try{var c=a.readByte();switch(c){case 192:return null;case 194:return!1;case 195:return!0;case 202:return a.readFloat();case 203:return a.readDouble();case 204:return a.readByte();case 205:return a.readUInt16();case 206:return a.readInt32();case 207:return y.Int64.make(a.readInt32(),a.readInt32());case 208:return a.readInt8();case 209:return a.readInt16();case 210:return a.readInt32();case 211:return y.Int64.make(a.readInt32(),a.readInt32());case 218:case 219:return a.read(218==c?a.readUInt16():a.readInt32()).toString();case 220:case 221:return this.readArray(a,220==c?a.readUInt16():a.readInt32(),b);case 222:case 223:return this.readMap(a,222==c?a.readUInt16():a.readInt32(),b);default:if(128>c)return c;if(144>c)return this.readMap(a,15&c,b);if(160>c)return this.readArray(a,15&c,b);if(192>c)return a.read(31&c).toString();if(c>223)return-256|c}}catch(d){if(!z.Boot.__instanceof(d,y.io.Eof))throw d}return null},readArray:function(a,b,c){for(var d=[],e=0;b>e;){{e++}d.push(this.decode(a,c))}return d},readMap:function(a,b,c){if(c){for(var d={},e=0;b>e;){var f=(e++,this.decode(a,c)),g=this.decode(a,c);d[f]=g}return d}for(var h=new y.ds.ObjectMap,i=0;b>i;){var j=(i++,this.decode(a,c)),k=this.decode(a,c);h.set(j,k)}return h},getResult:function(){return this.o},__class__:A.Decoder},A.Encoder=function(a){this.o=new y.io.BytesOutput,this.o.set_bigEndian(!0),this.encode(a)},e["msgpack.Encoder"]=A.Encoder,A.Encoder.__name__=["msgpack","Encoder"],A.Encoder.prototype={encode:function(a){var b=t["typeof"](a);switch(b[1]){case 0:this.o.writeByte(192);break;case 3:this.o.writeByte(a?195:194);break;case 1:this.writeInt(a);break;case 2:this.writeFloat(a);break;case 6:var c=b[2],d=t.getClassName(c);switch(d){case"String":this.writeRaw(y.io.Bytes.ofString(a));break;case"Array":this.writeArray(a);break;case"Hash":this.writeHashMap(a);break;case"haxe.Int64":this.writeInt64(a)}break;case 4:this.writeObjectMap(a);break;case 7:throw"Error: Enum not supported";case 5:throw"Error: Function not supported";case 8:throw"Error: Unknown Data Type"}},writeInt:function(a){-32>a?-32768>a?(this.o.writeByte(210),this.o.writeInt32(a)):-128>a?(this.o.writeByte(209),this.o.writeInt16(a)):(this.o.writeByte(208),this.o.writeInt8(a)):128>a?this.o.writeByte(255&a):256>a?(this.o.writeByte(204),this.o.writeByte(a)):65536>a?(this.o.writeByte(205),this.o.writeUInt16(a)):(this.o.writeByte(206),this.o.writeInt32(a))},writeInt64:function(a){this.o.writeByte(a.high<0?211:207),this.o.writeInt32(y.Int64.getHigh(a)),this.o.writeInt32(y.Int64.getLow(a))},writeFloat:function(a){var b=Math.abs(a);b>1.401298464324817e-45&&3.4028234663852886e38>b?(this.o.writeByte(202),this.o.writeFloat(a)):(this.o.writeByte(203),this.o.writeDouble(a))},writeRaw:function(a){var b=a.length;32>b?this.o.writeByte(160|b):65536>b?(this.o.writeByte(218),this.o.writeUInt16(b)):(this.o.writeByte(219),this.o.writeInt32(b)),this.o.write(a)},writeArray:function(a){var b=a.length;16>b?this.o.writeByte(144|b):65536>b?(this.o.writeByte(220),this.o.writeUInt16(b)):(this.o.writeByte(221),this.o.writeInt32(b));for(var c=0;c<a.length;){var d=a[c];++c,this.encode(d)}},writeMapLength:function(a){16>a?this.o.writeByte(128|a):65536>a?(this.o.writeByte(222),this.o.writeUInt16(a)):(this.o.writeByte(223),this.o.writeInt32(a))},writeHashMap:function(a){this.writeMapLength(j.count(a));for(var b=a.keys();b.hasNext();){var c=b.next();this.writeRaw(y.io.Bytes.ofString(c)),this.encode(a.get(c))}},writeObjectMap:function(a){var b=n.fields(a);this.writeMapLength(j.count(b));for(var c=0;c<b.length;){var d=b[c];++c,this.writeRaw(y.io.Bytes.ofString(d)),this.encode(n.field(a,d))}},getBytes:function(){return this.o.getBytes()},__class__:A.Encoder},A.MsgPack=function(){},e["msgpack.MsgPack"]=A.MsgPack,A.MsgPack.__name__=["msgpack","MsgPack"],A.MsgPack.encode=function(a){return new A.Encoder(a).getBytes()},A.MsgPack.decode=function(a,b){return null==b&&(b=!0),new A.Decoder(a,b).getResult()},u.interfaces.IController=function(){},e["puremvc.interfaces.IController"]=u.interfaces.IController,u.interfaces.IController.__name__=["puremvc","interfaces","IController"],u.interfaces.IController.prototype={__class__:u.interfaces.IController},u.core={},u.core.Controller=function(){u.core.Controller.instance=this,this.commandMap=new y.ds.StringMap,this.initializeController()},e["puremvc.core.Controller"]=u.core.Controller,u.core.Controller.__name__=["puremvc","core","Controller"],u.core.Controller.__interfaces__=[u.interfaces.IController],u.core.Controller.getInstance=function(){return null==u.core.Controller.instance&&(u.core.Controller.instance=new u.core.Controller),u.core.Controller.instance},u.core.Controller.prototype={initializeController:function(){this.view=u.core.View.getInstance()},executeCommand:function(a){var b=this.commandMap.get(a.getName());if(null!=b){var c=t.createInstance(b,[]);c.execute(a)}},registerCommand:function(a,b){this.commandMap.exists(a)||this.view.registerObserver(a,new u.patterns.observer.Observer(d(this,this.executeCommand),this)),this.commandMap.set(a,b)},hasCommand:function(a){return this.commandMap.exists(a)},removeCommand:function(a){this.hasCommand(a)&&(this.view.removeObserver(a,this),this.commandMap.remove(a))},__class__:u.core.Controller},u.interfaces.IModel=function(){},e["puremvc.interfaces.IModel"]=u.interfaces.IModel,u.interfaces.IModel.__name__=["puremvc","interfaces","IModel"],u.interfaces.IModel.prototype={__class__:u.interfaces.IModel},u.core.Model=function(){u.core.Model.instance=this,this.proxyMap=new y.ds.StringMap,this.initializeModel()},e["puremvc.core.Model"]=u.core.Model,u.core.Model.__name__=["puremvc","core","Model"],u.core.Model.__interfaces__=[u.interfaces.IModel],u.core.Model.getInstance=function(){return null==u.core.Model.instance&&(u.core.Model.instance=new u.core.Model),u.core.Model.instance},u.core.Model.prototype={initializeModel:function(){},registerProxy:function(a){this.proxyMap.set(a.getProxyName(),a),a.onRegister()},retrieveProxy:function(a){return this.proxyMap.get(a)},hasProxy:function(a){return this.proxyMap.exists(a)},removeProxy:function(a){var b=this.proxyMap.get(a);return null!=b&&(this.proxyMap.remove(a),b.onRemove()),b},__class__:u.core.Model},u.interfaces.IView=function(){},e["puremvc.interfaces.IView"]=u.interfaces.IView,u.interfaces.IView.__name__=["puremvc","interfaces","IView"],u.interfaces.IView.prototype={__class__:u.interfaces.IView},u.core.View=function(){u.core.View.instance=this,this.mediatorMap=new y.ds.StringMap,this.observerMap=new y.ds.StringMap,this.initializeView()},e["puremvc.core.View"]=u.core.View,u.core.View.__name__=["puremvc","core","View"],u.core.View.__interfaces__=[u.interfaces.IView],u.core.View.getInstance=function(){return null==u.core.View.instance&&(u.core.View.instance=new u.core.View),u.core.View.instance},u.core.View.prototype={initializeView:function(){},registerObserver:function(a,b){this.observerMap.exists(a)||this.observerMap.set(a,new k),this.observerMap.get(a).add(b)},notifyObservers:function(a){if(this.observerMap.exists(a.getName())){for(var b=this.observerMap.get(a.getName()),c=new k,d=b.iterator();d.hasNext();){var e=d.next();c.add(e)}for(var f=c.iterator();f.hasNext();){var g=f.next();g.notifyObserver(a)}}},removeObserver:function(a,b){for(var c=this.observerMap.get(a),d=c.iterator();d.hasNext();){var e=d.next();if(1==e.compareNotifyContext(b)){c.remove(e);break}}c.isEmpty()&&this.observerMap.remove(a)},registerMediator:function(a){if(!this.mediatorMap.exists(a.getMediatorName())){this.mediatorMap.set(a.getMediatorName(),a);var b=a.listNotificationInterests();if(b.length>0)for(var c=new u.patterns.observer.Observer(d(a,a.handleNotification),a),e=0,f=b.length;f>e;){var g=e++;this.registerObserver(b[g],c)}a.onRegister()}},retrieveMediator:function(a){return this.mediatorMap.get(a)},removeMediator:function(a){var b=this.mediatorMap.get(a);if(null!=b){for(var c=b.listNotificationInterests(),d=0,e=c.length;e>d;){var f=d++;this.removeObserver(c[f],b)}this.mediatorMap.remove(a),b.onRemove()}return b},hasMediator:function(a){return this.mediatorMap.exists(a)},__class__:u.core.View},u.interfaces.INotification=function(){},e["puremvc.interfaces.INotification"]=u.interfaces.INotification,u.interfaces.INotification.__name__=["puremvc","interfaces","INotification"],u.interfaces.INotification.prototype={__class__:u.interfaces.INotification},u.interfaces.IObserver=function(){},e["puremvc.interfaces.IObserver"]=u.interfaces.IObserver,u.interfaces.IObserver.__name__=["puremvc","interfaces","IObserver"],u.interfaces.IObserver.prototype={__class__:u.interfaces.IObserver},u.patterns.observer.Notification=function(a,b,c){this.name=a,null!=b&&(this.body=b),null!=c&&(this.type=c)},e["puremvc.patterns.observer.Notification"]=u.patterns.observer.Notification,u.patterns.observer.Notification.__name__=["puremvc","patterns","observer","Notification"],u.patterns.observer.Notification.__interfaces__=[u.interfaces.INotification],u.patterns.observer.Notification.prototype={getName:function(){return this.name},setBody:function(a){this.body=a},getBody:function(){return this.body},setType:function(a){this.type=a},getType:function(){return this.type},toString:function(){var a="Notification Name: "+this.getName();return a+="\nBody:"+(null==this.body?"null":this.body.toString()),a+="\nType:"+(null==this.type?"null":this.type)},__class__:u.patterns.observer.Notification},u.patterns.observer.Observer=function(a,b){this.setNotifyMethod(a),this.setNotifyContext(b)},e["puremvc.patterns.observer.Observer"]=u.patterns.observer.Observer,u.patterns.observer.Observer.__name__=["puremvc","patterns","observer","Observer"],u.patterns.observer.Observer.__interfaces__=[u.interfaces.IObserver],u.patterns.observer.Observer.prototype={setNotifyMethod:function(a){this.notify=a},setNotifyContext:function(a){this.context=a},getNotifyMethod:function(){return this.notify},getNotifyContext:function(){return this.context},notifyObserver:function(a){this.getNotifyMethod()(a)},compareNotifyContext:function(a){return a==this.context},__class__:u.patterns.observer.Observer};var B=0,C={},D=require("events").EventEmitter;Array.prototype.indexOf&&(i.indexOf=function(a,b,c){return Array.prototype.indexOf.call(a,b,c)}),Math.NaN=Number.NaN,Math.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,Math.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,e.Math=Math,Math.isFinite=function(a){return isFinite(a)},Math.isNaN=function(a){return isNaN(a)},String.prototype.__class__=e.String=String,String.__name__=["String"],e.Array=Array,Array.__name__=["Array"],Date.prototype.__class__=e.Date=Date,Date.__name__=["Date"];var E=e.Int={__name__:["Int"]},F=e.Dynamic={__name__:["Dynamic"]},G=e.Float=Number;G.__name__=["Float"];var H=Boolean;H.__ename__=["Bool"];var I=e.Class={__name__:["Class"]},J={};null==Array.prototype.map&&(Array.prototype.map=function(a){for(var b=[],c=0,d=this.length;d>c;){var e=c++;b[e]=a(this[e])}return b});!function(a){function b(a){var b="POST",c=a.url,d=a.headers,e=a.data,f=a.files,g=a.complete,h=new FormData;for(var i in e)e.hasOwnProperty(i)&&h.append(i,e[i]);for(var i in f)f.hasOwnProperty(i)&&h.append(i,f[i]);var j=new XMLHttpRequest;j.open(b,c,!0);for(var i in d)d.hasOwnProperty(i)&&j.setRequestHeader(i,d[i]);return j.onload=function(){4===j.readyState&&g(200===j.status,j)},j.onerror=function(){g(!1,j)},j.send(h),j}return a.exports=null,a.exports={upload:b},a.exports}({});z.Node.setTimeout=setTimeout,z.Node.clearTimeout=clearTimeout,z.Node.setInterval=setInterval,z.Node.clearInterval=clearInterval,z.Node.global=global,z.Node.process=process,z.Node.require=require,z.Node.console=console,z.Node.module=module,z.Node.stringify=JSON.stringify,z.Node.parse=JSON.parse;var K=i.substr(z.Node.process.version,1,null).split(".").map(o.parseInt);(K[0]>0||K[1]>=9)&&(z.Node.setImmediate=setImmediate,z.Node.clearImmediate=clearImmediate);z.Node.require("websocket").server;v.AppFacade.APP_STATE_CHANGED="app_state_changed",v.AppFacade.ACCESS_TOKEN_CHANGED="access_token_changed",v.AppFacade.CURRENT_USER_CHANGED="current_user_changed",v.AppFacade.CONFIGURATION_CHANGED="configuration_changed",v.AppFacade.DOMAIN_SELECTION_CHANGED="domain_selection_changed",v.AppFacade.TALK_SELECTION_CHANGED="talk_selection_changed",v.AppFacade.USER_SELECTION_NEEDED="user_selection_needed",v.AppFacade.USER_SELECTION_CHANGED="user_selection_changed",v.AppFacade.FRIEND_SELECTION_NEEDED="friend_selection_needed",v.AppFacade.STAMP_SET_CHANGED="stamp_set_changed",v.AppFacade.STAMP_SELECTION_CHANGED="stamp_selection_changed",v.AppFacade.PHONE_CALL_STARTED="phone_call_started",v.AppFacade.PHONE_CALL_ACCEPTED="phone_call_accepted",v.AppFacade.PHONE_CALL_CONNECTED="phone_call_connected",v.AppFacade.PHONE_CALL_HANGED_UP="phone_call_hangued_up",v.AppFacade.ACTION_SELECTION_CHANGED="action_selection_changed",v.AppFacade.CURRENT_PAGE_CHANGED="current_page_changed",v.AppFacade.CURRENT_PAGE_NOT_CHANGED="current_page_not_changed",v.AppFacade.FILEINFO_SELECTION_CHANGED="fileinfo_selection_changed",v.AppFacade.ERROR_OCCURRED="error_occurred",v.AppFacade.UNREAD_COUNT_CHANGED="brand_badge_changed",v.AppFacade.SEND_FORM_TOP_CHANGED="send_form_top_changed",v.AppFacade.DATA_RECOVERED="data_recovered",v.AppFacade.NOTIFY_UPDATE_USER="notify_update_user",v.AppFacade.NOTIFY_ADD_FRIEND="notify_add_friend",v.AppFacade.NOTIFY_ADD_ACQUAINTANCE="notify_add_acquaintance",v.AppFacade.NOTIFY_DELETE_FRIEND="notify_delete_friend",v.AppFacade.NOTIFY_DELETE_ACQUAINTANCE="notify_delete_acquaintance",v.AppFacade.NOTIFY_UPDATE_DOMAIN_USERS="notify_update_domain_users",v.AppFacade.GET_DOMAIN_USERS_RESPONSED="get_domain_users_responsed",v.AppFacade.GET_USERS_RESPONSED="get_users_responsed",v.AppFacade.GET_PROFILE_RESPONSED="get_profile_responsed",v.AppFacade.UPDATE_USER_RESPONSED="update_user_responsed",v.AppFacade.UPDATE_PROFILE_RESPONSED="update_profile_responsed",v.AppFacade.NOTIFY_ADD_DOMAIN_INVITE="notify_add_domain_invite",v.AppFacade.NOTIFY_ACCEPT_DOMAIN_INVITE="notify_accept_domain_invite",v.AppFacade.NOTIFY_DELETE_DOMAIN_INVITE="notify_delete_domain_invite",v.AppFacade.NOTIFY_JOIN_DOMAIN="notify_join_domain",v.AppFacade.NOTIFY_UPDATE_DOMAIN="notify_update_domain",v.AppFacade.NOTIFY_LEAVE_DOMAIN="notify_leave_domain",v.AppFacade.NOTIFY_CREATE_PAIR_TALK="notify_create_pair_talk",v.AppFacade.NOTIFY_CREATE_GROUP_TALK="notify_create_group_talk",v.AppFacade.NOTIFY_UPDATE_GROUP_TALK="notify_update_group_talk",v.AppFacade.NOTIFY_ADD_TALKERS="notify_add_talkers",v.AppFacade.NOTIFY_DELETE_TALKER="notify_delete_talker",v.AppFacade.NOTIFY_ADD_TALK_INVITE="notify_add_talk_invite",v.AppFacade.NOTIFY_ACCEPT_TALK_INVITE="notify_accept_talk_invite",v.AppFacade.NOTIFY_DELETE_TALK_INVITE="notify_delete_talk_invite",v.AppFacade.NOTIFY_DELETE_TALK="notify_delete_talk",v.AppFacade.NOTIFY_CREATE_MESSAGE="notify_create_message",v.AppFacade.NOTIFY_UPDATE_READ_STATUSES="notify_update_read_statuses",v.AppFacade.NOTIFY_UPDATE_TALK_STATUS="notify_update_talk_status",v.AppFacade.NOTIFY_UPDATE_LOCAL_TALK_STATUS="notify_update_local_talk_status",v.AppFacade.NOTIFY_GET_MESSAGES="notify_get_messages",v.AppFacade.NOTIFY_GET_MESSAGE_READ_STATUS="notify_get_message_status",v.AppFacade.CREATE_MESSAGE_START="create_message_start",v.AppFacade.CREATE_MESSAGE_COMPLETE="create_message_complete",v.AppFacade.CREATE_MESSAGE_FAIL="create_message_fail",v.AppFacade.NOTIFY_CREATE_ANNOUNCEMENT="notify_create_announcement",v.AppFacade.NOTIFY_UPDATE_ANNOUNCEMENT_STATUS="notify_update_announcement_status",v.AppFacade.NOTIFY_GET_ANNOUNCEMENTS="notify_get_announcements",v.AppFacade.NOTIFY_UPDATE_QUESTION="notify_update_question",v.AppFacade.NOTIFY_GET_QUESTIONS="get_questions_responsed",v.AppFacade.NOTIFY_CREATE_ATTACHMENT="notify_create_attachment",v.AppFacade.NOTIFY_DELETE_ATTACHMENT="notify_delete_attachment",v.AppFacade.GET_FILE_RESPONSED="get_file_responsed",v.command.DomainCommand.__meta__={fields:{api:{inject:null}}},v.command.DomainCommand.NAME="Domain",v.command.FileCommand.__meta__={fields:{api:{inject:null},dataStore:{inject:null},fileService:{inject:null}}},v.command.FileCommand.NAME="File",v.command.LoadStampSetCommand.NAME="LoadStampSet",v.command.LoadStampSetCommand.TAB_URL="./json/app_ja.json",v.command.LoadStampSetCommand.TAB_PANE_URL="./json/illust_category_ja.json",v.command.ManageFriendsCommand.__meta__={fields:{api:{inject:null}}},v.command.ManageFriendsCommand.NAME="ManageFriends",v.command.ReadCommand.__meta__={fields:{api:{inject:null}}},v.command.ReadCommand.NAME="Read",v.command.ReloadDataCommand.__meta__={fields:{api:{inject:null}}},v.command.ReloadDataCommand.NAME="ReloadData",v.command.SelectTalkCommand.__meta__={fields:{dataStore:{inject:null},settings:{inject:null}}},v.command.SelectTalkCommand.NAME="SelectTalk",v.command.SendCommand.__meta__={fields:{api:{inject:null}}},v.command.SendCommand.NAME="Send",v.command.SignInCommand.__meta__={fields:{api:{inject:null},settings:{inject:null},accountLoader:{inject:null}}},v.command.SignInCommand.NAME="SignIn",v.command.SignOutCommand.__meta__={fields:{api:{inject:null},settings:{inject:null}}},v.command.SignOutCommand.NAME="SignOut",v.command.TalkCommand.__meta__={fields:{api:{inject:null},dataStore:{inject:null}}},v.command.TalkCommand.NAME="Talk",v.command.UpdateProfileCommand.__meta__={fields:{api:{inject:null},dataStore:{inject:null}}},v.command.UpdateProfileCommand.NAME="UpdateProfile",v.command.UpdateUserCommand.__meta__={fields:{api:{inject:null}}},v.command.UpdateUserCommand.NAME="UpdateUser",v.command.UrlCommand.__meta__={fields:{routing:{inject:null}}},v.command.UrlCommand.NAME="Url",v.entity.Message.MAX_READ_USER_IDS_COUNT=16,w.DEBUG=!1,v.js.TextCanonicalizer.HIRAGANA_SMALL_A=12353,v.js.TextCanonicalizer.HIRAGANA_NN=12435,v.js.TextCanonicalizer.KATAKANA_SMALL_A=12449,v.proxy.AccountLoaderProxyFactory.NAME="accountLoader",u.patterns.proxy.Proxy.NAME="Proxy",v.proxy.AlberoBroadcastProxy.__meta__={fields:{api:{inject:null},dataStore:{inject:null},settings:{inject:null}}},v.proxy.AlberoBroadcastProxy.NAME="broadcast",v.proxy.AlberoServiceProxy.__meta__={fields:{rpc:{inject:null},settings:{inject:null},dataStore:{inject:null},fileService:{inject:null}}},v.proxy.AlberoServiceProxy.NAME="api",v.proxy.AlberoServiceProxy.API_VERSION="1.35",v.proxy.AppStateProxy.NAME="appState",v.proxy.DataStoreProxy.NAME="dataStore",v.proxy.DataStoreProxy.TYPE_FRIEND=0,v.proxy.DataStoreProxy.TYPE_ACQUAINSTANCE=1,v.proxy.DataStoreProxy.TYPE_NONE=2,v.proxy.FileServiceProxy.__meta__={fields:{settings:{inject:null}}},v.proxy.FileServiceProxy.NAME="fileService",v.proxy.FormatterProxy.__meta__={fields:{dataStore:{inject:null},fileService:{inject:null},settings:{inject:null}}},v.proxy.FormatterProxy.NAME="formatter",v.proxy.MsgPackRpcProxy.__meta__={fields:{broadcast:{inject:null}}},v.proxy.MsgPackRpcProxy.NAME="rpc",v.proxy.MsgPackRpcProxy.lastMsgId=0,v.proxy._MsgPackRpcProxy.ConnectionKeeper.PING_INTERVAL_ON_CONNECTED=45e3,v.proxy.RoutingProxy.__meta__={fields:{settings:{inject:null},dataStore:{inject:null}}},v.proxy.RoutingProxy.NAME="routing",v.proxy.SettingsProxy.NAME="settings",v.proxy.SettingsProxy.KEY_ACCESS_TOKEN="access_token",v.proxy.SettingsProxy.KEY_SELECTED_DOMAIN_ID_H="selected_domain_id_h",v.proxy.SettingsProxy.KEY_SELECTED_DOMAIN_ID_L="selected_domain_id_l",v.proxy.SettingsProxy.COOKIE_KEY_SEND_BY_ENTER="send-by-enter",v.proxy.SettingsProxy.COOKIE_EXPIRES_SEND_BY_ENTER=31536e3,v.proxy.SettingsProxy.KEY_SELECTED_STAMP_TAB_ID="selected_stamp_tab_id",v.proxy.SettingsProxy.KEY_INPUT_TEXT="input_text",v.proxy.SettingsProxy.KEY_COPY_PROFILE_TO_ALL_DOMAINS="copy_profile_to_all_domains",u.patterns.mediator.Mediator.NAME="Mediator",x.mediator.CommandLineMediator.__meta__={fields:{dataStore:{inject:null},api:{inject:null},hubotObject:{inject:null},messageEvent:{inject:null}}},x.mediator.CommandLineMediator.NAME="commandline",x.proxy.HubotObjectProxy.__meta__={fields:{dataStore:{inject:null}}},x.proxy.HubotObjectProxy.NAME="hubotObject",x.proxy.MessageEventProxy.__meta__={fields:{dataStore:{inject:null},hubotObject:{inject:null}}},x.proxy.MessageEventProxy.NAME="messageEvent",x.proxy.SendQueueProxy.__meta__={fields:{messageEvent:{inject:null}}},x.proxy.SendQueueProxy.NAME="sendQueue",x.proxy.SendQueueProxy.MIN_SEND_SPAN=500,y.ds.ObjectMap.count=0,y.io.Output.LN2=Math.log(2),z.NodeC.UTF8="utf8",z.NodeC.ASCII="ascii",z.NodeC.BINARY="binary",z.NodeC.BASE64="base64",z.NodeC.HEX="hex",z.NodeC.EVENT_EVENTEMITTER_NEWLISTENER="newListener",z.NodeC.EVENT_EVENTEMITTER_ERROR="error",z.NodeC.EVENT_STREAM_DATA="data",z.NodeC.EVENT_STREAM_END="end",z.NodeC.EVENT_STREAM_ERROR="error",z.NodeC.EVENT_STREAM_CLOSE="close",z.NodeC.EVENT_STREAM_DRAIN="drain",z.NodeC.EVENT_STREAM_CONNECT="connect",z.NodeC.EVENT_STREAM_SECURE="secure",z.NodeC.EVENT_STREAM_TIMEOUT="timeout",z.NodeC.EVENT_STREAM_PIPE="pipe",z.NodeC.EVENT_PROCESS_EXIT="exit",z.NodeC.EVENT_PROCESS_UNCAUGHTEXCEPTION="uncaughtException",z.NodeC.EVENT_PROCESS_SIGINT="SIGINT",z.NodeC.EVENT_PROCESS_SIGUSR1="SIGUSR1",z.NodeC.EVENT_CHILDPROCESS_EXIT="exit",z.NodeC.EVENT_HTTPSERVER_REQUEST="request",z.NodeC.EVENT_HTTPSERVER_CONNECTION="connection",z.NodeC.EVENT_HTTPSERVER_CLOSE="close",z.NodeC.EVENT_HTTPSERVER_UPGRADE="upgrade",z.NodeC.EVENT_HTTPSERVER_CLIENTERROR="clientError",z.NodeC.EVENT_HTTPSERVERREQUEST_DATA="data",z.NodeC.EVENT_HTTPSERVERREQUEST_END="end",z.NodeC.EVENT_CLIENTREQUEST_RESPONSE="response",z.NodeC.EVENT_CLIENTRESPONSE_DATA="data",z.NodeC.EVENT_CLIENTRESPONSE_END="end",z.NodeC.EVENT_NETSERVER_CONNECTION="connection",z.NodeC.EVENT_NETSERVER_CLOSE="close",z.NodeC.FILE_READ="r",z.NodeC.FILE_READ_APPEND="r+",z.NodeC.FILE_WRITE="w",z.NodeC.FILE_WRITE_APPEND="a+",z.NodeC.FILE_READWRITE="a",z.NodeC.FILE_READWRITE_APPEND="a+",A.Encoder.FLOAT_SINGLE_MIN=1.401298464324817e-45,A.Encoder.FLOAT_SINGLE_MAX=3.4028234663852886e38,A.Encoder.FLOAT_DOUBLE_MIN=5e-324,A.Encoder.FLOAT_DOUBLE_MAX=1.7976931348623157e308,g.main()
}("undefined"!=typeof window?window:exports);